<!doctype html><html lang=en-us><head><script async src="https://www.googletagmanager.com/gtag/js?id=G-D022F6NT2P"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','G-D022F6NT2P')</script><script>(function(b,d,e,a,g){b[a]=b[a]||[],b[a].push({'gtm.start':(new Date).getTime(),event:'gtm.js'});var f=d.getElementsByTagName(e)[0],c=d.createElement(e),h=a!='dataLayer'?'&l='+a:'';c.async=!0,c.src='https://www.googletagmanager.com/gtm.js?id='+g+h,f.parentNode.insertBefore(c,f)})(window,document,'script','dataLayer','GTM-P72R45W')</script><meta charset=utf-8><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><link rel=preload as=font href=https://koktlzz.github.io/fonts/vendor/jost/jost-v4-latin-regular.woff2 type=font/woff2 crossorigin><link rel=preload as=font href=https://koktlzz.github.io/fonts/vendor/jost/jost-v4-latin-700.woff2 type=font/woff2 crossorigin><link rel=preload as=font href=https://koktlzz.github.io/fonts/KaTeX_Main-Regular.woff2 type=font/woff2 crossorigin><link rel=preload as=font href=https://koktlzz.github.io/fonts/KaTeX_Math-Italic.woff2 type=font/woff2 crossorigin><link rel=stylesheet href=https://koktlzz.github.io/main.0ae7165cfeda76c765ab05aa408a696be65779f1e277afd078efecc543cc00bb72be873f087e148ccf7ac1016b22c2d2586f058c7ee5d92dcca60206eae2dd99.css integrity="sha512-CucWXP7adsdlqwWqQIppa+ZXefHid6/QeO/sxUPMALtyvoc/CH4UjM96wQFrIsLSWG8FjH7l2S3MpgIG6uLdmQ==" crossorigin=anonymous><noscript><style>img.lazyload{display:none}</style></noscript><meta name=robots content="index, follow"><meta name=googlebot content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1"><meta name=bingbot content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1"><title>文件权限 | Inspire Hub</title><meta name=description content><link rel=canonical href=https://koktlzz.github.io/infra/linux/filepermission/><meta property="og:locale" content="en_US"><meta property="og:type" content="article"><meta property="og:title" content="文件权限"><meta property="og:description" content="默认权限 [root@koktlzz ~]# mkdir test [root@koktlzz ~]# ll -d test/ drwxr-xr-x 2 root root 6 4 月 8 10:06 test/ [root@koktlzz ~]# umask  0022 新创建目录的默认权限并非 777，这是因为一些权限被 umask 清除了。由于当前 umask 值为 022，因此 test 目录默认被取消了所属组和其他用户的写权限（777-022=755）。
特殊权限 除了常见的读、写和执行权限 rwx 外，目录/文件还可能会被赋予一些特殊权限。比如 passwd 命令执行的二进制文件：
[root@koktlzz ~]# ls -l /usr/bin/passwd  -rwsr-xr-x. 1 root root 33600 4 月 7 2020 /usr/bin/passwd 该可执行文件所属用户的权限为 rws，s 即 setuid/setgid，意为该文件会以其所属的用户/组的身份执行，而非运行命令的用户/组。即使普通用户无法修改 /etc/shadow 文件，但 passwd 命令依然会以 root 用户的身份执行，因此普通用户可以使用该命令修改其密码：
[root@koktlzz ~]# su kokt [kokt@koktlzz root]$ passwd Changing password for user kokt."><meta property="og:url" content="https://koktlzz.github.io/infra/linux/filepermission/"><meta property="og:site_name" content="Inspire Hub"><meta property="article:published_time" content="2021-02-24T22:05:45+08:00"><meta property="article:modified_time" content="2021-02-24T22:05:45+08:00"><meta property="og:image" content="https://koktlzz.github.io/doks.png"><meta property="og:image:alt" content="Inspire Hub"><meta name=twitter:card content="summary_large_image"><meta name=twitter:site content="@getdoks"><meta name=twitter:creator content="@henkverlinde"><meta name=twitter:title content="文件权限"><meta name=twitter:description content><meta name=twitter:image content="https://koktlzz.github.io/doks.png"><meta name=twitter:image:alt content="文件权限"><script type=application/ld+json>{"@context":"https://schema.org","@graph":[{"@type":"Organization","@id":"https://koktlzz.github.io/#/schema/organization/1","name":"Doks","url":"https://koktlzz.github.io/","sameAs":["https://twitter.com/getdoks","https://github.com/h-enk/doks"],"logo":{"@type":"ImageObject","@id":"https://koktlzz.github.io/#/schema/image/1","url":"https://koktlzz.github.io/logo-doks.png","width":512,"height":512,"caption":"Doks"},"image":{"@id":"https://koktlzz.github.io/#/schema/image/1"}},{"@type":"WebSite","@id":"https://koktlzz.github.io/#/schema/website/1","url":"https://koktlzz.github.io/","name":"Inspire Hub","description":"","publisher":{"@id":"https://koktlzz.github.io/#/schema/organization/1"}},{"@type":"WebPage","@id":"https://koktlzz.github.io/infra/linux/filepermission/","url":"https://koktlzz.github.io/infra/linux/filepermission/","name":"文件权限","description":"","isPartOf":{"@id":"https://koktlzz.github.io/#/schema/website/1"},"about":{"@id":"https://koktlzz.github.io/#/schema/organization/1"},"datePublished":"2021-02-24T22:05:45CET","dateModified":"2021-02-24T22:05:45CET","breadcrumb":{"@id":"https://koktlzz.github.io/infra/linux/filepermission/#/schema/breadcrumb/1"},"primaryImageOfPage":{"@id":"https://koktlzz.github.io/infra/linux/filepermission/#/schema/image/2"},"inLanguage":"en-US","potentialAction":[{"@type":"ReadAction","target":["https://koktlzz.github.io/infra/linux/filepermission/"]}]},{"@type":"BreadcrumbList","@id":"https://koktlzz.github.io/infra/linux/filepermission/#/schema/breadcrumb/1","name":"Breadcrumbs","itemListElement":[{"@type":"ListItem","position":1,"item":{"@type":"WebPage","@id":"https://koktlzz.github.io/","url":"https://koktlzz.github.io/","name":"Home"}},{"@type":"ListItem","position":2,"item":{"@type":"WebPage","@id":"https://koktlzz.github.io/infra/","url":"https://koktlzz.github.io/infra/","name":"Infra"}},{"@type":"ListItem","position":3,"item":{"@type":"WebPage","@id":"https://koktlzz.github.io/infra/linux/","url":"https://koktlzz.github.io/infra/linux/","name":"Linux"}},{"@type":"ListItem","position":4,"item":{"@id":"https://koktlzz.github.io/infra/linux/filepermission/"}}]},{"@context":"https://schema.org","@graph":[{"@type":"ImageObject","@id":"https://koktlzz.github.io/infra/linux/filepermission/#/schema/image/2","url":"https://koktlzz.github.io/doks.png","contentUrl":"https://koktlzz.github.io/doks.png","caption":"文件权限"}]}]}</script><meta name=theme-color content="#fff"><link rel=apple-touch-icon sizes=180x180 href=https://koktlzz.github.io/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=https://koktlzz.github.io/favicon-32x32.ico><link rel=icon type=image/png sizes=16x16 href=https://koktlzz.github.io/favicon-16x16.ico><link rel=manifest crossorigin=use-credentials href=https://koktlzz.github.io/site.webmanifest></head><body class="Infra single dark"><noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-P72R45W" height=0 width=0 style=display:none;visibility:hidden></iframe></noscript><div class="header-bar fixed-top"></div><header class="navbar fixed-top navbar-expand-md navbar-light"><div class=container-fluid><input class="menu-btn order-0" type=checkbox id=menu-btn>
<label class="menu-icon d-md-none" for=menu-btn><span class=navicon></span></label><a class="navbar-brand order-1 order-md-0 me-auto" href=https://koktlzz.github.io/>Inspire Hub</a>
<button id=mode class="btn btn-link order-2 order-md-4" type=button aria-label="Toggle mode">
<span class=toggle-dark><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-moon"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg></span><span class=toggle-light><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-sun"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></span></button><ul class="navbar-nav social-nav order-3 order-md-5"><li class=nav-item><a class=nav-link href=https://github.com/koktlzz><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-github"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77 5.44 5.44.0 003.5 8.55c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg><span class="ms-2 visually-hidden">GitHub</span></a></li></ul><div class="collapse navbar-collapse order-4 order-md-1"><ul class="navbar-nav main-nav me-auto order-5 order-md-2"><li class=nav-item><a class=nav-link href=https://koktlzz.github.io/docker/docker%E5%9F%BA%E7%A1%80/intro>Docker</a></li><li class=nav-item><a class=nav-link href=https://koktlzz.github.io/kubernetes/kubernetes%E5%9F%BA%E7%A1%80/intro>Kubernetes</a></li><li class=nav-item><a class=nav-link href=https://koktlzz.github.io/elastic/elasticstack/intro>Elastic</a></li><li class=nav-item><a class=nav-link href=https://koktlzz.github.io/go/go%E5%9F%BA%E7%A1%80/intro>Go</a></li><li class=nav-item><a class=nav-link href=https://koktlzz.github.io/infra/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80/tcpip%E7%BD%91%E7%BB%9C%E6%A8%A1%E5%9E%8B>Infra</a></li></ul><div class="break order-6 d-md-none"></div></div></div></header><div class="wrap container-fluid" role=document><div class=content><div class="row flex-xl-nowrap"><div class="col-lg-3 col-xl-2 d-none d-xl-block"><nav class=docs-links aria-label="Main navigation"><h3>计算机网络</h3><ul class=list-unstyled><li><a class=docs-link href=https://koktlzz.github.io/infra/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80/tcpip%E7%BD%91%E7%BB%9C%E6%A8%A1%E5%9E%8B/>TCP/IP 网络模型</a></li><li><a class=docs-link href=https://koktlzz.github.io/infra/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80/dnshttps/>DNS、UDP 与 HTTPS</a></li><li><a class=docs-link href=https://koktlzz.github.io/infra/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80/%E8%99%9A%E6%8B%9F%E6%9C%BA%E7%BD%91%E7%BB%9C/>虚拟机网络</a></li><li><a class=docs-link href=https://koktlzz.github.io/infra/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80/vlan/>VLAN</a></li></ul><h3>CSAPP</h3><ul class=list-unstyled><li><a class=docs-link href=https://koktlzz.github.io/infra/csapp/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F%E4%B9%8B%E6%97%85/>计算机系统之旅</a></li><li><a class=docs-link href=https://koktlzz.github.io/infra/csapp/%E4%BF%A1%E6%81%AF%E7%9A%84%E8%A1%A8%E7%A4%BA%E5%92%8C%E5%A4%84%E7%90%86/>信息的表示和处理</a></li><li><a class=docs-link href=https://koktlzz.github.io/infra/csapp/%E7%A8%8B%E5%BA%8F%E7%9A%84%E6%9C%BA%E5%99%A8%E7%BA%A7%E8%A1%A8%E7%A4%BA/>程序的机器级表示</a></li></ul><h3>Linux</h3><ul class=list-unstyled><li><a class=docs-link href=https://koktlzz.github.io/infra/linux/filepermission/>文件权限</a></li></ul></nav></div><main class="docs-content col-lg-13 col-xl-11"><h1>文件权限</h1><p class=lead></p><h2 id=默认权限>默认权限<a href=#默认权限 class=anchor aria-hidden=true>#</a></h2><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#ff79c6>[</span>root@koktlzz ~<span style=color:#ff79c6>]</span><span style=color:#6272a4># mkdir test</span>
<span style=color:#ff79c6>[</span>root@koktlzz ~<span style=color:#ff79c6>]</span><span style=color:#6272a4># ll -d test/</span>
drwxr-xr-x <span style=color:#bd93f9>2</span> root root <span style=color:#bd93f9>6</span> <span style=color:#bd93f9>4</span> 月   <span style=color:#bd93f9>8</span> 10:06 test/
<span style=color:#ff79c6>[</span>root@koktlzz ~<span style=color:#ff79c6>]</span><span style=color:#6272a4># umask </span>
<span style=color:#bd93f9>0022</span>
</code></pre></div><p>新创建目录的默认权限并非 777，这是因为一些权限被 <strong>umask</strong> 清除了。由于当前 umask 值为 022，因此 test 目录默认被取消了所属组和其他用户的写权限（777-022=755）。</p><h2 id=特殊权限>特殊权限<a href=#特殊权限 class=anchor aria-hidden=true>#</a></h2><p>除了常见的读、写和执行权限 rwx 外，目录/文件还可能会被赋予一些特殊权限。比如 <strong>passwd</strong> 命令执行的二进制文件：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#ff79c6>[</span>root@koktlzz ~<span style=color:#ff79c6>]</span><span style=color:#6272a4># ls -l /usr/bin/passwd </span>
-rwsr-xr-x. <span style=color:#bd93f9>1</span> root root <span style=color:#bd93f9>33600</span> <span style=color:#bd93f9>4</span> 月   <span style=color:#bd93f9>7</span> <span style=color:#bd93f9>2020</span> /usr/bin/passwd
</code></pre></div><p>该可执行文件所属用户的权限为 rws，s 即 setuid/setgid，意为该文件会以其所属的用户/组的身份执行，而非运行命令的用户/组。即使普通用户无法修改 <strong>/etc/shadow</strong> 文件，但 <strong>passwd</strong> 命令依然会以 root 用户的身份执行，因此普通用户可以使用该命令修改其密码：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#ff79c6>[</span>root@koktlzz ~<span style=color:#ff79c6>]</span><span style=color:#6272a4># su kokt</span>
<span style=color:#ff79c6>[</span>kokt@koktlzz root<span style=color:#ff79c6>]</span>$ passwd
Changing password <span style=color:#ff79c6>for</span> user kokt.
Current password: 
</code></pre></div><p>setgid 权限也可以应用于目录，使目录中新创建的文件加入目录的所属组，而非创建文件用户的所属组。</p><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#ff79c6>[</span>root@koktlzz ~<span style=color:#ff79c6>]</span><span style=color:#6272a4># usermod -G zz kokt &amp;&amp; su kokt</span>
<span style=color:#ff79c6>[</span>kokt@koktlzz root<span style=color:#ff79c6>]</span>$ <span style=color:#8be9fd;font-style:italic>umask</span> 
<span style=color:#bd93f9>0002</span>
<span style=color:#ff79c6>[</span>kokt@koktlzz root<span style=color:#ff79c6>]</span>$ mkdir /tmp/shared <span style=color:#ff79c6>&amp;&amp;</span> chown :zz /tmp/shared/ <span style=color:#ff79c6>&amp;&amp;</span>touch /tmp/shared/defaults
<span style=color:#ff79c6>[</span>kokt@koktlzz root<span style=color:#ff79c6>]</span>$ ll -d /tmp/shared
drwxrwxr-x <span style=color:#bd93f9>2</span> kokt zz <span style=color:#bd93f9>22</span> Apr  <span style=color:#bd93f9>8</span> 15:12 /tmp/shared
<span style=color:#ff79c6>[</span>kokt@koktlzz root<span style=color:#ff79c6>]</span>$ ll /tmp/shared/defaults 
-rw-rw-r-- <span style=color:#bd93f9>1</span> kokt kokt <span style=color:#bd93f9>0</span> Apr  <span style=color:#bd93f9>8</span> 14:50 /tmp/shared/defaults
</code></pre></div><p>在默认情况下，即使修改目录 shared 的所属组为 zz，用户 kokt 在该目录中创建的文件 defaults 的所属组依然为 kokt。赋予 shared 目录 setgid 权限后，新创建的文件 new 便继承了上级目录的所属组：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#ff79c6>[</span>kokt@koktlzz root<span style=color:#ff79c6>]</span>$ chmod g+s /tmp/shared/ <span style=color:#ff79c6>&amp;&amp;</span> touch /tmp/shared/new 
<span style=color:#ff79c6>[</span>kokt@koktlzz root<span style=color:#ff79c6>]</span>$ ll /tmp/shared/
total <span style=color:#bd93f9>0</span>
-rw-rw-r-- <span style=color:#bd93f9>1</span> kokt kokt <span style=color:#bd93f9>0</span> Apr  <span style=color:#bd93f9>8</span> 14:50 defaults
-rw-rw-r-- <span style=color:#bd93f9>1</span> kokt zz   <span style=color:#bd93f9>0</span> Apr  <span style=color:#bd93f9>8</span> 15:05 new
</code></pre></div><p>还有一种特殊权限名为粘滞位（sticky bit），它可以限制目录内文件的删除。其他用户（Others）有对该目录的读写权限，但只有该目录的所属用户或 root 用户才能删除目录中的文件。例如 tmp 目录权限中的 rwt：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#ff79c6>[</span>root@koktlzz ~<span style=color:#ff79c6>]</span><span style=color:#6272a4># ll -d /tmp/</span>
drwxrwxrwt. <span style=color:#bd93f9>13</span> root root <span style=color:#bd93f9>4096</span> Apr  <span style=color:#bd93f9>8</span> 13:49 /tmp/
</code></pre></div><p>为文件赋予 setuid/setgid 权限的方式与普通权限相同，不过 setuid 仅对可执行文件有效：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#ff79c6>[</span>root@koktlzz ~<span style=color:#ff79c6>]</span><span style=color:#6272a4># touch test</span>
<span style=color:#ff79c6>[</span>root@koktlzz ~<span style=color:#ff79c6>]</span><span style=color:#6272a4># chmod u+s test </span>
<span style=color:#ff79c6>[</span>root@koktlzz ~<span style=color:#ff79c6>]</span><span style=color:#6272a4># ll test </span>
-rwSr--r-- <span style=color:#bd93f9>1</span> root root <span style=color:#bd93f9>0</span> Apr  <span style=color:#bd93f9>8</span> 13:34 <span style=color:#8be9fd;font-style:italic>test</span>
<span style=color:#ff79c6>[</span>root@koktlzz ~<span style=color:#ff79c6>]</span><span style=color:#6272a4># chmod u+x test </span>
<span style=color:#ff79c6>[</span>root@koktlzz ~<span style=color:#ff79c6>]</span><span style=color:#6272a4># ll test </span>
-rwsr--r-- <span style=color:#bd93f9>1</span> root root <span style=color:#bd93f9>0</span> Apr  <span style=color:#bd93f9>8</span> 13:34 <span style=color:#8be9fd;font-style:italic>test</span>
</code></pre></div><p>为 test 文件添加执行权限后，s 由大写变为小写，这时 setuid 权限才真正生效。同样也可以用数字的方式赋予特殊权限：<code>setuid = 4, setgid = 2, sticky bit = 1, none = 0</code></p><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#ff79c6>[</span>root@koktlzz ~<span style=color:#ff79c6>]</span><span style=color:#6272a4># chmod u-s test </span>
<span style=color:#ff79c6>[</span>root@koktlzz ~<span style=color:#ff79c6>]</span><span style=color:#6272a4># ll test </span>
-rwxr--r-- <span style=color:#bd93f9>1</span> root root <span style=color:#bd93f9>0</span> Apr  <span style=color:#bd93f9>8</span> 13:34 <span style=color:#8be9fd;font-style:italic>test</span>
<span style=color:#ff79c6>[</span>root@koktlzz ~<span style=color:#ff79c6>]</span><span style=color:#6272a4># chmod 4744 test </span>
<span style=color:#ff79c6>[</span>root@koktlzz ~<span style=color:#ff79c6>]</span><span style=color:#6272a4># ll test </span>
-rwsr--r-- <span style=color:#bd93f9>1</span> root root <span style=color:#bd93f9>0</span> Apr  <span style=color:#bd93f9>8</span> 13:34 <span style=color:#8be9fd;font-style:italic>test</span>
</code></pre></div><p><strong>chmod</strong> 命令中 4744 的第一位数字便代表为文件赋予 setuid 权限，后三位则分别代表 user、group 和 others 的读、写和执行权限。这也解释了为什么给文件赋予普通权限时的数字常为三位，但 <strong>umask</strong> 命令输出的数字却为四位。</p><p>上述三种特殊权限总结如下：</p><table><thead><tr><th>特殊权限名称</th><th>赋予方式</th><th>赋予文件的效果</th><th>赋予目录的效果</th></tr></thead><tbody><tr><td>setuid</td><td>u+s</td><td>文件以其所属用户的身份执行而非运行命令的用户</td><td>无效果</td></tr><tr><td>seigid</td><td>g+s</td><td>文件以其所属组的身份执行而非运行命令用户的所属组</td><td>目录中新创建文件的所属组与目录的所属组相同</td></tr><tr><td>sticky bit</td><td>o+t</td><td>无效果</td><td>拥有目录写权限的用户也无法删除或强制保存目录中属于其他用户的文件</td></tr></tbody></table><h2 id=acl-权限access-control-list>ACL 权限（Access Control List）<a href=#acl-权限access-control-list class=anchor aria-hidden=true>#</a></h2><p>标准的文件权限只可以对文件所属用户/组和其他用户（user、group 和 others）的使用进行限制。而 ACL 权限则能够对文件权限进行更加细粒度（fine-grained）的划分，它允许为任何用户或用户组设置任何文件的使用权限。</p><p>如果使用 <strong>ll</strong> 命令查看文件时发现其权限字符串中末尾有"+&ldquo;号，那便说明文件被赋予了 ACL 权限：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#ff79c6>[</span>root@koktlzz ~<span style=color:#ff79c6>]</span><span style=color:#6272a4># ll test </span>
-rwxrw-r--+ <span style=color:#bd93f9>1</span> root root <span style=color:#bd93f9>0</span> Apr <span style=color:#bd93f9>10</span> 10:54 <span style=color:#8be9fd;font-style:italic>test</span>
</code></pre></div><p>使用 <strong>getfacl</strong> 命令可以查看其 ACL 权限：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#ff79c6>[</span>root@koktlzz ~<span style=color:#ff79c6>]</span><span style=color:#6272a4># getfacl test </span>
<span style=color:#6272a4># file: test</span>
<span style=color:#6272a4># owner: root</span>
<span style=color:#6272a4># group: root</span>
user::rwx
user:kokt:rw-
group::r--
group:zz:rw-
mask::rw-
other::r--
</code></pre></div><p>每行输出结果的含义如下：</p><ul><li>file/owner/group：文件名/文件所属用户/文件所属组，和标准文件权限相同；</li><li>user::rwx：文件所属用户拥有对该文件的读、写和执行权限；</li><li>user:kokt:rw-：用户 kokt 对该文件拥有读写权限，无法执行；</li><li>group::r&ndash;: 文件所属组只拥有对该文件的读权限；</li><li>group:zz:rw-：用户 zz 对该文件拥有读写权限，无法执行；</li><li>mask::rw-：除文件拥有者外，所有的用户/组所能拥有的最大权限为读和写。因此即使将用户 kokt 的权限设置为"rwx&rdquo;，也无法执行该文件；</li><li>other::r&ndash;：其他用户对该文件只拥有读权限。</li></ul><p>我们发现上述两条命令的输出结果在文件所属组的权限上出现了偏差：前者为"rw-"，后者则为"r&ndash;"。这是因为对于已经赋予了 ACL 权限的文件，其 <strong>ll</strong> 命令输出的权限字符串中的 4～6 位不再是文件所属组的权限了，而是其 ACL 权限中 mask 的值，即"rw-"。1～3 位和 7～9 位的字符串则和标准文件权限一致，分别表示文件所属用户和其他用户的权限。</p><p>目录的 ACL 权限和文件相比也有着一些不同，以被赋予了特殊权限 setgid 以及 ACL 权限的 testdir 目录为例：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#ff79c6>[</span>root@koktlzz ~<span style=color:#ff79c6>]</span><span style=color:#6272a4># ll -d testdir/</span>
drwxrwsr-x+ <span style=color:#bd93f9>2</span> root root <span style=color:#bd93f9>6</span> Apr <span style=color:#bd93f9>10</span> 17:12 testdir/
<span style=color:#ff79c6>[</span>root@koktlzz ~<span style=color:#ff79c6>]</span><span style=color:#6272a4># getfacl testdir/</span>
<span style=color:#6272a4># file: testdir/</span>
<span style=color:#6272a4># owner: root</span>
<span style=color:#6272a4># group: root</span>
<span style=color:#6272a4># flags: -s-</span>
user::rwx
user:kokt:rwx
group::r-x
group:zz:rw-
mask::rwx
other::r-x
default:user::rwx
default:user:kokt:rwx
default:group::r-x
default:group:zz:rw-
default: mask::rwx
default:other::r-x
</code></pre></div><p>每行输出结果的含义如下：</p><ul><li>file/owner/group：目录名/目录所属用户/目录所属组，和标准文件权限相同；</li><li>flags: -s-：该目录被赋予了 setgid 权限；</li><li>user::rwx/user:kokt:rwx/group::r-x/group:zz:rw-/mask::rwx/other::r-x：与文件的 ACL 权限相同；</li><li>以 default 开头的各项：目录中的新文件以及子目录将继承的 ACL 权限。</li></ul><p>切换到用户 kokt 并在该目录下新建一个文件 test：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#ff79c6>[</span>root@koktlzz ~<span style=color:#ff79c6>]</span><span style=color:#6272a4># su kokt</span>
<span style=color:#ff79c6>[</span>kokt@koktlzz root<span style=color:#ff79c6>]</span>$ touch testdir/test <span style=color:#ff79c6>&amp;&amp;</span> getfacl testdir/test
<span style=color:#6272a4># file: testdir/test</span>
<span style=color:#6272a4># owner: kokt</span>
<span style=color:#6272a4># group: root</span>
user::rw-
user:kokt:rwx                   <span style=color:#6272a4>#effective:rw-</span>
group::r-x                      <span style=color:#6272a4>#effective:r--</span>
group:zz:rw-
mask::rw-
other::r--
</code></pre></div><p>该文件由用户 kokt 创建，所属者为 kokt。由于上级目录 testdir 被赋予了 setgid 权限，因此 test 文件的所属组为 testdir 的所属组 root 而非创建者的所属组 kokt。虽然用户 kokt 继承了上级目录的 rwx 权限，但受 mask::rw-的限制，实际上只能拥有对该文件的读写权限（#effective:rw-）。</p><p>为什么 testdir 目录的 default mask 为 rwx，新文件 test 的 mask 就只有 rw 了呢？这是因为标准的文件权限规定，新创建的文件无法直接获得执行权限，必须手动赋予。因此文件继承的 ACL 权限必须去掉执行权限 x。这也解释了为什么文件所属组的权限为 r-x，但实际生效的只有读权限（#effective:r&ndash;）。</p><p>如果在 testdir 目录下创建一个子目录 dir，那么该目录的 ACL 权限就和上级目录完全相同了：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#ff79c6>[</span>kokt@koktlzz root<span style=color:#ff79c6>]</span>$ mkdir testdir/dir <span style=color:#ff79c6>&amp;&amp;</span> getfacl testdir/dir
<span style=color:#6272a4># file: testdir/dir</span>
<span style=color:#6272a4># owner: kokt</span>
<span style=color:#6272a4># group: root</span>
<span style=color:#6272a4># flags: -s-</span>
user::rwx
user:kokt:rwx
group::r-x
group:zz:rw-
mask::rwx
other::r-x
default:user::rwx
default:user:kokt:rwx
default:group::r-x
default:group:zz:rw-
default: mask::rwx
default:other::r-x
</code></pre></div><p>文件/目录的 ACL 权限赋予基于 <strong>setfacl</strong> 命令，它的主要用法如下：</p><p>为某一用户/组赋予某一文件/目录的 ACL 权限：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>setfacl -m u:&lt;username&gt;:&lt;permission rwx&gt; &lt;file/dirname&gt;
setfacl -m g:&lt;groupname&gt;:&lt;permission rwx&gt; &lt;file/dirname&gt;
</code></pre></div><p>若要同时为目录以及目录中的文件和子目录赋予 ACL 权限，只需添加标识位-R：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>setfacl -R -m u:&lt;username&gt;:rX &lt;dirname&gt;
</code></pre></div><p>大写 X 是标准文件权限中的一种特殊用法，即只为目录而非文件赋予执行权限。在此处应用可以防止将目录中的一些普通文件被 <strong>setfacl -R</strong> 赋予执行权限，而目录中本来就拥有执行权限的文件则不会受到影响。</p><p>给目录的 ACL 权限添加 default 条目，以使目录中的新文件和子目录能够继承目录的 ACL 权限：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>setfacl -m d:u:&lt;username&gt;:&lt;permission rwx&gt; &lt;dirname&gt;
setfacl -m d:g:&lt;groupname&gt;:&lt;permission rwx&gt; &lt;dirname&gt;
</code></pre></div><p>指定 ACL 权限的 mask：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>setfacl -m m::&lt;permission rwx&gt; &lt;file/dirname&gt;
</code></pre></div><p>删除文件/目录的 ACL 权限：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#6272a4># 删除某一用户/组的 ACL 权限</span>
setfacl -x u:&lt;username&gt; &lt;file/dirname&gt;
setfacl -x g:&lt;groupname&gt; &lt;file/dirname&gt;
<span style=color:#6272a4># 删除全部 ACL 权限</span>
setfacl -b &lt;file/dirname&gt;
</code></pre></div><p>将 <strong>getfacl</strong> 命令的输出结果作为输入：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#6272a4># fileA 和 fileB 将会拥有相同的 ACL 权限</span>
<span style=color:#6272a4># --set-file 标识符可以接受来自于文件和 stdin 的输入，此处的-便代表 stdin</span>
getfacl fileA | setfacl --set-file<span style=color:#ff79c6>=</span>- fileB
</code></pre></div><p class=edit-page><a href=https://github.com/koktlzz/koktlzz.github.io/blob/master/content/Infra/Linux/FilePermission.md><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-edit-2"><path d="M17 3a2.828 2.828.0 114 4L7.5 20.5 2 22l1.5-5.5L17 3z"/></svg>Edit this page on GitHub</a></p><div class="docs-navigation d-flex justify-content-between"><a href=https://koktlzz.github.io/infra/csapp/%E7%A8%8B%E5%BA%8F%E7%9A%84%E6%9C%BA%E5%99%A8%E7%BA%A7%E8%A1%A8%E7%A4%BA/><div class="card my-1"><div class="card-body py-2">&larr; 程序的机器级表示</div></div></a></div><script src=https://utteranc.es/client.js repo=koktlzz/koktlzz.github.io issue-term=pathname theme=photon-dark crossorigin=anonymous async></script></main><nav class="docs-toc d-none d-xl-block col-lg-3 col-xl-2" aria-label="Secondary navigation"><div class=page-links><h3>On this page</h3><nav id=TableOfContents><ul><li><a href=#默认权限>默认权限</a></li><li><a href=#特殊权限>特殊权限</a></li><li><a href=#acl-权限access-control-list>ACL 权限（Access Control List）</a></li></ul></nav></div></nav></div></div></div><footer class="footer text-muted"><div class=container><div class=row><div class="col-lg-8 order-last order-lg-first"><ul class=list-inline><li class=list-inline-item></li></ul></div><div class="col-lg-8 order-first order-lg-last text-lg-end"><ul class=list-inline></ul></div></div></div></footer><script src=https://koktlzz.github.io/js/bootstrap.min.d67050adf5d370668aede4201f82af781b16970934804995a1ca37c1ee9222c2fc530972aa6d5d2b6124caf1fe318f139aac99df2c1e89af65504fc1185c7972.js integrity="sha512-1nBQrfXTcGaK7eQgH4KveBsWlwk0gEmVoco3we6SIsL8Uwlyqm1dK2EkyvH+MY8TmqyZ3yweia9lUE/BGFx5cg==" crossorigin=anonymous defer></script><script src=https://koktlzz.github.io/js/vendor/katex/dist/katex.min.b334e5b00c45f572e7f38a543046f36854bf4cbb543880480c09271a0efedc694d6905f719934f6ede2f26f52e80411c05b90121d722cbf8be2fa8fc51bc6b81.js integrity="sha512-szTlsAxF9XLn84pUMEbzaFS/TLtUOIBIDAknGg7+3GlNaQX3GZNPbt4vJvUugEEcBbkBIdciy/i+L6j8UbxrgQ==" crossorigin=anonymous defer></script><script src=https://koktlzz.github.io/js/vendor/katex/dist/contrib/auto-render.min.916823ec103cf367b71e28a6f01513cb9c3ac6708ccb5229402ec46b8e30a8b25003db694df35d80e9dd666a371f327c6152790617b6256390c164109a90bd4c.js integrity="sha512-kWgj7BA882e3Hiim8BUTy5w6xnCMy1IpQC7Ea44wqLJQA9tpTfNdgOndZmo3HzJ8YVJ5Bhe2JWOQwWQQmpC9TA==" crossorigin=anonymous defer></script><script src=https://koktlzz.github.io/main.min.1febbf2f6fd6a36fc2f57dd50d7935fbb640743329baeb4ef7cefcf2e7630e413371fbba976e103656b82808ee227dc4a84237edb0f8433648bef3a56900661a.js integrity="sha512-H+u/L2/Wo2/C9X3VDXk1+7ZAdDMpuutO98788udjDkEzcfu6l24QNla4KAjuIn3EqEI37bD4QzZIvvOlaQBmGg==" crossorigin=anonymous defer></script></body></html>