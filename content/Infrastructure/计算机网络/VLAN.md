---
title: "VLAN"
description: ""
date: 2021-02-24T22:05:45+08:00
lastmod: 2021-02-24T22:05:45+08:00
draft: false
images: []
menu:
  infrastructure:
    parent: "计算机网络"
weight: 400
---

## 交换的基本概念

- 共享式以太网：当一台主机发送数据的时候，其他主机只能接收此数据，此时其他网上主机都不能发送数据；
- 冲突域：域内的不同设备同时发出的以太网帧会互相冲突，连接在同一集线器（Hub）的设备构成一个冲突域；
- 广播域：当广播域中的一台主机发出一个广播时，所有其他的设备都能接收到这个广播帧。未配置 VLAN 的二层交换机的每个端口构成一个冲突域，但同属于一个广播域。

## VLAN 的特点

- 每个 VLAN 都是一个逻辑上的子网，相同 VLAN 中的主机可以跨越多个交换机进行通信，而不同 VLAN 间的主机则需要通过路由器或三层交换机；
- 每个 VLAN 中的所有设备都处于同一广播域内。广播无法跨 VLAN 传播，因此抑制了广播风暴的产生；
- 划分 VLAN 通常就是对交换机的端口进行划分，每个端口对应一个 VLAN ID；
- VLAN 工作于 OSI 参考模型的第二层。

## 实现方式

VLAN 的实现方式有静态和动态两种：

- 静态 VLAN：我们已经知道每个 VLAN 就是一个逻辑子网，那么每个 VLAN ID 自然就拥有其对应的子网号。管理员配置交换机端口和 VLAN ID 的对应关系后，主机便只能通过其所在子网对应的交换机端口加入 VLAN 中；
- 动态 VLAN（基于 MAC 地址）：将所有主机的 MAC 地址都加入到 VLAN 的管理数据库中。当主机连接到交换机的一个端口时，管理数据库将根据主机的 MAC 地址查询其要加入的 VLAN ID。随后自动设置该端口对应主机的 VLAN ID，主机便可以通过该端口加入到 VLAN 中。

## 端口分类

VLAN 交换机拥有两种端口，分别为 Access 端口和 Trunk 端口。其中，每个 Access 端口都会被分配一个 VLAN ID，标识它所连接的设备属于哪一个 VLAN。当数据帧通过 Access 端口进入交换机时，它将为数据帧打上 tag（tag 中包含 VLAN ID）；当数据帧从交换机内部通过 Access 端口向外发送时，若数据帧的 VLAN ID 和 Access 端口一致，则会被其接收。随后 Access 端口将数据帧中的 tag 信息去掉，再发送出去。

Trunk 端口不属于某个特定 VLAN，而是构成了交换机之间多个 VLAN 的中继链路。不考虑默认 VLAN 的情况下，从 Trunk 端口进出的数据帧都是带有 tag 信息的。

## 数据帧的传输流程

![202106162041](https://cdn.jsdelivr.net/gh/koktlzz/ImgBed@master/202106162041.jpeg)

1. 主机 A 以主机 E 的 MAC 地址为目的 MAC 地址发送一个数据帧；
2. 数据帧通过 Access 端口 1 进入交换机 A。将其打上 VLAN tag 后，再根据目的 MAC 地址，通过 Trunk 端口 1 转发给交换机 B ；
3. 交换机 B 中的 Access 端口 3 的 VLAN ID 与数据帧相同，连接设备的 MAC 地址也匹配。因此 Access 端口 3 去掉数据帧的 VLAN 标签，将其转发给对应的主机 E ；
4. 交换机 A 中的 Access 端口 2 和交换机 B 中的 Access 端口 4 与数据帧的 VLAN ID 不同，因此均无法收到数据帧。
