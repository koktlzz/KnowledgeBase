<!doctype html><html lang=en-us><head><script async src="https://www.googletagmanager.com/gtag/js?id=G-D022F6NT2P"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','G-D022F6NT2P')</script><script>(function(b,d,e,a,g){b[a]=b[a]||[],b[a].push({'gtm.start':(new Date).getTime(),event:'gtm.js'});var f=d.getElementsByTagName(e)[0],c=d.createElement(e),h=a!='dataLayer'?'&l='+a:'';c.async=!0,c.src='https://www.googletagmanager.com/gtm.js?id='+g+h,f.parentNode.insertBefore(c,f)})(window,document,'script','dataLayer','GTM-P72R45W')</script><meta charset=utf-8><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><link rel=preload as=font href=https://koktlzz.github.io/fonts/vendor/jost/jost-v4-latin-regular.woff2 type=font/woff2 crossorigin><link rel=preload as=font href=https://koktlzz.github.io/fonts/vendor/jost/jost-v4-latin-700.woff2 type=font/woff2 crossorigin><link rel=preload as=font href=https://koktlzz.github.io/fonts/KaTeX_Main-Regular.woff2 type=font/woff2 crossorigin><link rel=preload as=font href=https://koktlzz.github.io/fonts/KaTeX_Math-Italic.woff2 type=font/woff2 crossorigin><link rel=stylesheet href=https://koktlzz.github.io/main.27967119d9bfd1f18848f648c47494cdf9c8666df2bb5d54d01736bacd6e74dc5f8b9b2cbc827df0fc8e4cef4f4bae41b13b93c84017caf5272a107d6f2af5cc.css integrity="sha512-J5ZxGdm/0fGISPZIxHSUzfnIZm3yu11U0Bc2us1udNxfi5ssvIJ98PyOTO9PS65BsTuTyEAXyvUnKhB9byr1zA==" crossorigin=anonymous><noscript><style>img.lazyload{display:none}</style></noscript><meta name=robots content="index, follow"><meta name=googlebot content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1"><meta name=bingbot content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1"><title>单节点部署流程 | KnowledgeBase</title><meta name=description content><link rel=canonical href=https://koktlzz.github.io/observability/elasticstack/%E5%8D%95%E8%8A%82%E7%82%B9%E9%83%A8%E7%BD%B2%E6%B5%81%E7%A8%8B/><meta property="og:locale" content="en_US"><meta property="og:type" content="article"><meta property="og:title" content="单节点部署流程"><meta property="og:description" content="部署 ElasticSearch 下载安装包 下载地址： https://www.elastic.co/cn/downloads/elasticsearch
解压 tar -xzf tar -xzf elasticsearch-7.10.1-linux-x86_64.tar.gz 添加用户 root 用户默认无法启动 ElasticSearch，因此需要添加一个普通用户并修改文件夹的拥有者：
useradd elasticsearch chown -R elasticsearch:elasticsearch elasticsearch-7.10.1 su elasticsearch 启动应用 cd elasticsearch-7.10.1 ./bin/elasticsearch 检查应用 访问本机的 9200 端口后返回：
[elasticsearch@GWR1 elasticsearch-7.10.1]$ curl localhost:9200 { &#34;name&#34; : &#34;GWR1&#34;, &#34;cluster_name&#34; : &#34;elasticsearch&#34;, &#34;cluster_uuid&#34; : &#34;0zZo-UItRjmbKkfHwqObnw&#34;, &#34;version&#34; : { &#34;number&#34; : &#34;7.10.1&#34;, &#34;build_flavor&#34; : &#34;default&#34;, &#34;build_type&#34; : &#34;tar&#34;, &#34;build_hash&#34; : &#34;1c34507e66d7db1211f66f3513706fdf548736aa&#34;, &#34;build_date&#34; : &#34;2020-12-05T01:00:33.671820Z&#34;, &#34;build_snapshot&#34; : false, &#34;lucene_version&#34; : &#34;8.7.0&#34;, &#34;minimum_wire_compatibility_version&#34; : &#34;6."><meta property="og:url" content="https://koktlzz.github.io/observability/elasticstack/%E5%8D%95%E8%8A%82%E7%82%B9%E9%83%A8%E7%BD%B2%E6%B5%81%E7%A8%8B/"><meta property="og:site_name" content="KnowledgeBase"><meta property="article:published_time" content="2020-11-04T09:19:42+01:00"><meta property="article:modified_time" content="2020-11-04T09:19:42+01:00"><meta property="og:image" content="https://koktlzz.github.io/doks.png"><meta property="og:image:alt" content="KnowledgeBase"><meta name=twitter:card content="summary_large_image"><meta name=twitter:site content="@getdoks"><meta name=twitter:creator content="@henkverlinde"><meta name=twitter:title content="单节点部署流程"><meta name=twitter:description content><meta name=twitter:image content="https://koktlzz.github.io/doks.png"><meta name=twitter:image:alt content="单节点部署流程"><script type=application/ld+json>{"@context":"https://schema.org","@graph":[{"@type":"Organization","@id":"https://koktlzz.github.io/#/schema/organization/1","name":"Doks","url":"https://koktlzz.github.io/","sameAs":["https://twitter.com/getdoks","https://github.com/h-enk/doks"],"logo":{"@type":"ImageObject","@id":"https://koktlzz.github.io/#/schema/image/1","url":"https://koktlzz.github.io/logo-doks.png","width":512,"height":512,"caption":"Doks"},"image":{"@id":"https://koktlzz.github.io/#/schema/image/1"}},{"@type":"WebSite","@id":"https://koktlzz.github.io/#/schema/website/1","url":"https://koktlzz.github.io/","name":"KnowledgeBase","description":"","publisher":{"@id":"https://koktlzz.github.io/#/schema/organization/1"}},{"@type":"WebPage","@id":"https://koktlzz.github.io/observability/elasticstack/%E5%8D%95%E8%8A%82%E7%82%B9%E9%83%A8%E7%BD%B2%E6%B5%81%E7%A8%8B/","url":"https://koktlzz.github.io/observability/elasticstack/%E5%8D%95%E8%8A%82%E7%82%B9%E9%83%A8%E7%BD%B2%E6%B5%81%E7%A8%8B/","name":"单节点部署流程","description":"","isPartOf":{"@id":"https://koktlzz.github.io/#/schema/website/1"},"about":{"@id":"https://koktlzz.github.io/#/schema/organization/1"},"datePublished":"2020-11-04T09:19:42CET","dateModified":"2020-11-04T09:19:42CET","breadcrumb":{"@id":"https://koktlzz.github.io/observability/elasticstack/%E5%8D%95%E8%8A%82%E7%82%B9%E9%83%A8%E7%BD%B2%E6%B5%81%E7%A8%8B/#/schema/breadcrumb/1"},"primaryImageOfPage":{"@id":"https://koktlzz.github.io/observability/elasticstack/%E5%8D%95%E8%8A%82%E7%82%B9%E9%83%A8%E7%BD%B2%E6%B5%81%E7%A8%8B/#/schema/image/2"},"inLanguage":"en-US","potentialAction":[{"@type":"ReadAction","target":["https://koktlzz.github.io/observability/elasticstack/%E5%8D%95%E8%8A%82%E7%82%B9%E9%83%A8%E7%BD%B2%E6%B5%81%E7%A8%8B/"]}]},{"@type":"BreadcrumbList","@id":"https://koktlzz.github.io/observability/elasticstack/%E5%8D%95%E8%8A%82%E7%82%B9%E9%83%A8%E7%BD%B2%E6%B5%81%E7%A8%8B/#/schema/breadcrumb/1","name":"Breadcrumbs","itemListElement":[{"@type":"ListItem","position":1,"item":{"@type":"WebPage","@id":"https://koktlzz.github.io/","url":"https://koktlzz.github.io/","name":"Home"}},{"@type":"ListItem","position":2,"item":{"@type":"WebPage","@id":"https://koktlzz.github.io/observability/","url":"https://koktlzz.github.io/observability/","name":"Observability"}},{"@type":"ListItem","position":3,"item":{"@type":"WebPage","@id":"https://koktlzz.github.io/observability/elasticstack/","url":"https://koktlzz.github.io/observability/elasticstack/","name":"Elasticstack"}},{"@type":"ListItem","position":4,"item":{"@id":"https://koktlzz.github.io/observability/elasticstack/%E5%8D%95%E8%8A%82%E7%82%B9%E9%83%A8%E7%BD%B2%E6%B5%81%E7%A8%8B/"}}]},{"@context":"https://schema.org","@graph":[{"@type":"ImageObject","@id":"https://koktlzz.github.io/observability/elasticstack/%E5%8D%95%E8%8A%82%E7%82%B9%E9%83%A8%E7%BD%B2%E6%B5%81%E7%A8%8B/#/schema/image/2","url":"https://koktlzz.github.io/doks.png","contentUrl":"https://koktlzz.github.io/doks.png","caption":"单节点部署流程"}]}]}</script><meta name=theme-color content="#fff"><link rel=apple-touch-icon sizes=180x180 href=https://koktlzz.github.io/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=https://koktlzz.github.io/favicon-32x32.ico><link rel=icon type=image/png sizes=16x16 href=https://koktlzz.github.io/favicon-16x16.ico><link rel=manifest crossorigin=use-credentials href=https://koktlzz.github.io/site.webmanifest></head><body class="Observability single dark"><noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-P72R45W" height=0 width=0 style=display:none;visibility:hidden></iframe></noscript><div class="header-bar fixed-top"></div><header class="navbar fixed-top navbar-expand-md navbar-light"><div class=container-fluid><input class="menu-btn order-0" type=checkbox id=menu-btn>
<label class="menu-icon d-md-none" for=menu-btn><span class=navicon></span></label><a class="navbar-brand order-1 order-md-0 me-auto" href=https://koktlzz.github.io/>KnowledgeBase</a>
<button id=mode class="btn btn-link order-2 order-md-4" type=button aria-label="Toggle mode">
<span class=toggle-dark><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-moon"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg></span><span class=toggle-light><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-sun"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></span></button><ul class="navbar-nav social-nav order-3 order-md-5"><li class=nav-item><a class=nav-link href=https://github.com/koktlzz><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-github"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77 5.44 5.44.0 003.5 8.55c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg><span class="ms-2 visually-hidden">GitHub</span></a></li></ul><div class="collapse navbar-collapse order-4 order-md-1"><ul class="navbar-nav main-nav me-auto order-5 order-md-2"><li class=nav-item><a class=nav-link href=https://koktlzz.github.io/container/docker/intro>Container</a></li><li class=nav-item><a class=nav-link href=https://koktlzz.github.io/observability/elasticstack/intro>Observability</a></li><li class=nav-item><a class=nav-link href=https://koktlzz.github.io/programming/go/intro>Programming</a></li><li class=nav-item><a class=nav-link href=https://koktlzz.github.io/infrastructure/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/tcpip%E7%BD%91%E7%BB%9C%E6%A8%A1%E5%9E%8B>Infrastructure</a></li></ul><div class="break order-6 d-md-none"></div></div></div></header><div class="wrap container-fluid" role=document><div class=content><div class="row flex-xl-nowrap"><div class="col-lg-4 col-xl-3 d-none d-xl-block"><nav class=docs-links aria-label="Main navigation"><h3>ElasticStack</h3><ul class=list-unstyled><li><a class=docs-link href=https://koktlzz.github.io/observability/elasticstack/intro/>Getting Started</a></li><li><a class=docs-link href=https://koktlzz.github.io/observability/elasticstack/%E5%8D%95%E8%8A%82%E7%82%B9%E9%83%A8%E7%BD%B2%E6%B5%81%E7%A8%8B/>单节点部署流程</a></li><li><a class=docs-link href=https://koktlzz.github.io/observability/elasticstack/elasticsearchintro/>ElasticSearch 简介</a></li><li><a class=docs-link href=https://koktlzz.github.io/observability/elasticstack/mapping/>Mapping</a></li><li><a class=docs-link href=https://koktlzz.github.io/observability/elasticstack/textanalysis/>Text analysis</a></li><li><a class=docs-link href=https://koktlzz.github.io/observability/elasticstack/template/>Template</a></li><li><a class=docs-link href=https://koktlzz.github.io/observability/elasticstack/ilm/>ILM</a></li><li><a class=docs-link href=https://koktlzz.github.io/observability/elasticstack/snapshot/>Snapshot</a></li><li><a class=docs-link href=https://koktlzz.github.io/observability/elasticstack/%E6%80%A7%E8%83%BD%E8%B0%83%E4%BC%98/>Elasticsearch 性能调优</a></li><li><a class=docs-link href=https://koktlzz.github.io/observability/elasticstack/kafkaintro/>Kafka 简介</a></li><li><a class=docs-link href=https://koktlzz.github.io/observability/elasticstack/hw/>Kafka 副本备份</a></li><li><a class=docs-link href=https://koktlzz.github.io/observability/elasticstack/transaction/>Kafka 事务</a></li></ul><h3>Prometheus</h3><ul class=list-unstyled><li><a class=docs-link href=https://koktlzz.github.io/observability/prometheus/intro/>Getting Started</a></li><li><a class=docs-link href=https://koktlzz.github.io/observability/prometheus/operator%E8%87%AA%E5%AE%9A%E4%B9%89%E9%85%8D%E7%BD%AE/>Operator 自定义配置</a></li></ul><h3>Opentelemetry</h3><ul class=list-unstyled><li><a class=docs-link href=https://koktlzz.github.io/observability/opentelemetry/intro/>Getting Started</a></li><li><a class=docs-link href=https://koktlzz.github.io/observability/opentelemetry/collectorexample/>Collector Example</a></li></ul></nav></div><main class="docs-content col-lg-12 col-xl-10"><h1>单节点部署流程</h1><p class=lead></p><h2 id=部署-elasticsearch>部署 ElasticSearch<a href=#部署-elasticsearch class=anchor aria-hidden=true>#</a></h2><h3 id=下载安装包>下载安装包<a href=#下载安装包 class=anchor aria-hidden=true>#</a></h3><p>下载地址： <a href=https://www.elastic.co/cn/downloads/elasticsearch>https://www.elastic.co/cn/downloads/elasticsearch</a></p><h3 id=解压>解压<a href=#解压 class=anchor aria-hidden=true>#</a></h3><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>tar -xzf tar -xzf elasticsearch-7.10.1-linux-x86_64.tar.gz
</code></pre></div><h3 id=添加用户>添加用户<a href=#添加用户 class=anchor aria-hidden=true>#</a></h3><p>root 用户默认无法启动 ElasticSearch，因此需要添加一个普通用户并修改文件夹的拥有者：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>useradd elasticsearch
chown -R elasticsearch:elasticsearch elasticsearch-7.10.1
su elasticsearch
</code></pre></div><h3 id=启动应用>启动应用<a href=#启动应用 class=anchor aria-hidden=true>#</a></h3><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#8be9fd;font-style:italic>cd</span> elasticsearch-7.10.1
./bin/elasticsearch
</code></pre></div><h3 id=检查应用>检查应用<a href=#检查应用 class=anchor aria-hidden=true>#</a></h3><p>访问本机的 9200 端口后返回：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#ff79c6>[</span>elasticsearch@GWR1 elasticsearch-7.10.1<span style=color:#ff79c6>]</span>$ curl localhost:9200
<span style=color:#ff79c6>{</span>
  <span style=color:#f1fa8c>&#34;name&#34;</span> : <span style=color:#f1fa8c>&#34;GWR1&#34;</span>,
  <span style=color:#f1fa8c>&#34;cluster_name&#34;</span> : <span style=color:#f1fa8c>&#34;elasticsearch&#34;</span>,
  <span style=color:#f1fa8c>&#34;cluster_uuid&#34;</span> : <span style=color:#f1fa8c>&#34;0zZo-UItRjmbKkfHwqObnw&#34;</span>,
  <span style=color:#f1fa8c>&#34;version&#34;</span> : <span style=color:#ff79c6>{</span>
    <span style=color:#f1fa8c>&#34;number&#34;</span> : <span style=color:#f1fa8c>&#34;7.10.1&#34;</span>,
    <span style=color:#f1fa8c>&#34;build_flavor&#34;</span> : <span style=color:#f1fa8c>&#34;default&#34;</span>,
    <span style=color:#f1fa8c>&#34;build_type&#34;</span> : <span style=color:#f1fa8c>&#34;tar&#34;</span>,
    <span style=color:#f1fa8c>&#34;build_hash&#34;</span> : <span style=color:#f1fa8c>&#34;1c34507e66d7db1211f66f3513706fdf548736aa&#34;</span>,
    <span style=color:#f1fa8c>&#34;build_date&#34;</span> : <span style=color:#f1fa8c>&#34;2020-12-05T01:00:33.671820Z&#34;</span>,
    <span style=color:#f1fa8c>&#34;build_snapshot&#34;</span> : false,
    <span style=color:#f1fa8c>&#34;lucene_version&#34;</span> : <span style=color:#f1fa8c>&#34;8.7.0&#34;</span>,
    <span style=color:#f1fa8c>&#34;minimum_wire_compatibility_version&#34;</span> : <span style=color:#f1fa8c>&#34;6.8.0&#34;</span>,
    <span style=color:#f1fa8c>&#34;minimum_index_compatibility_version&#34;</span> : <span style=color:#f1fa8c>&#34;6.0.0-beta1&#34;</span>
  <span style=color:#ff79c6>}</span>,
  <span style=color:#f1fa8c>&#34;tagline&#34;</span> : <span style=color:#f1fa8c>&#34;You Know, for Search&#34;</span>
<span style=color:#ff79c6>}</span>
</code></pre></div><h3 id=终止应用>终止应用<a href=#终止应用 class=anchor aria-hidden=true>#</a></h3><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>ps aux | grep elasticsearch
<span style=color:#8be9fd;font-style:italic>kill</span> -9 PID
</code></pre></div><h3 id=外部访问>外部访问<a href=#外部访问 class=anchor aria-hidden=true>#</a></h3><p>由于 ElasticSearch 默认配置，只能闭环访问。想要使用外部机器访问必须修改配置文件：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>vim config/elasticsearch.yml
</code></pre></div><p>修改 network.host，设置其监听 0.0.0.0，即所有未知的主机和目的网络的集合。并添加 discovery.type 配置（ElasticSearch 默认为生产环境，启动时会对环境进行各项检查。而单节点服务器无法通过检查，配置此项以跳过检查）。</p><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#6272a4># 注意 yaml 文件中的：后面的空格不能省略</span>
<span style=color:#ff79c6>network.host</span>: <span style=color:#bd93f9>0.0.0.0</span>
<span style=color:#ff79c6>discovery.type</span>: single-node
</code></pre></div><p>重启应用后即可通过外部机器访问：</p><p><img src=https://cdn.jsdelivr.net/gh/koktlzz/NoteImg@main/20210113143739.png alt=20210113143739></p><h2 id=部署-kibana>部署 Kibana<a href=#部署-kibana class=anchor aria-hidden=true>#</a></h2><h3 id=下载安装包-1>下载安装包<a href=#下载安装包-1 class=anchor aria-hidden=true>#</a></h3><p>下载地址：<a href=https://www.elastic.co/cn/downloads/kibana>https://www.elastic.co/cn/downloads/kibana</a></p><h3 id=解压-1>解压<a href=#解压-1 class=anchor aria-hidden=true>#</a></h3><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>tar -xzf kibana-7.10.1-linux-x86_64.tar.gz
</code></pre></div><h3 id=启动应用-1>启动应用<a href=#启动应用-1 class=anchor aria-hidden=true>#</a></h3><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#8be9fd;font-style:italic>cd</span> kibana-7.10.1-linux-x86_64
./bin/kibana --allow-root &amp;
<span style=color:#8be9fd;font-style:italic>exit</span>
</code></pre></div><h3 id=检查应用-1>检查应用<a href=#检查应用-1 class=anchor aria-hidden=true>#</a></h3><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>curl localhost:5601
</code></pre></div><h3 id=外部访问-1>外部访问<a href=#外部访问-1 class=anchor aria-hidden=true>#</a></h3><p>与 ElasticSearch 类似，修改配置文件：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>vim config/kibana.yml
</code></pre></div><p>修改 server.host:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#ff79c6>server.host</span>: <span style=color:#f1fa8c>&#34;0.0.0.0&#34;</span>
</code></pre></div><p>重启应用后即可通过外部机器访问：</p><p><img src=https://cdn.jsdelivr.net/gh/koktlzz/NoteImg@main/20210113161042.png alt=20210113161042></p><h2 id=部署-logstash>部署 Logstash<a href=#部署-logstash class=anchor aria-hidden=true>#</a></h2><h3 id=下载安装包-2>下载安装包<a href=#下载安装包-2 class=anchor aria-hidden=true>#</a></h3><p>下载地址：<a href=https://www.elastic.co/cn/downloads/logstash>https://www.elastic.co/cn/downloads/logstash</a></p><h3 id=解压-2>解压<a href=#解压-2 class=anchor aria-hidden=true>#</a></h3><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>tar -xzf logstash-7.10.1-linux-x86_64.tar.gz
</code></pre></div><h3 id=启动应用-2>启动应用<a href=#启动应用-2 class=anchor aria-hidden=true>#</a></h3><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#8be9fd;font-style:italic>cd</span> logstash-7.10.1
./bin/logstash -option
</code></pre></div><h3 id=测试应用>测试应用<a href=#测试应用 class=anchor aria-hidden=true>#</a></h3><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#6272a4># 将 stdin 作为输入经过 logstash 管道输出到 stdout</span>
./bin/logstash -e <span style=color:#f1fa8c>&#39;input { stdin {} } output { stdout {} }&#39;</span>
</code></pre></div><p>在终端中输入 hello world 后回车，可以得到结果：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#ff79c6>[</span>2021-01-13T03:44:00,145<span style=color:#ff79c6>][</span>INFO <span style=color:#ff79c6>][</span>logstash.javapipeline    <span style=color:#ff79c6>][</span>main<span style=color:#ff79c6>]</span> Pipeline started <span style=color:#ff79c6>{</span><span style=color:#f1fa8c>&#34;pipeline.id&#34;</span><span style=color:#ff79c6>=</span>&gt;<span style=color:#f1fa8c>&#34;main&#34;</span><span style=color:#ff79c6>}</span>
The stdin plugin is now waiting <span style=color:#ff79c6>for</span> input:
<span style=color:#ff79c6>[</span>2021-01-13T03:44:00,201<span style=color:#ff79c6>][</span>INFO <span style=color:#ff79c6>][</span>logstash.agent           <span style=color:#ff79c6>]</span> Pipelines running <span style=color:#ff79c6>{</span>:count<span style=color:#ff79c6>=</span>&gt;1, :running_pipelines<span style=color:#ff79c6>=</span>&gt;<span style=color:#ff79c6>[</span>:main<span style=color:#ff79c6>]</span>, :non_running_pipelines<span style=color:#ff79c6>=</span>&gt;<span style=color:#ff79c6>[]}</span>
<span style=color:#ff79c6>[</span>2021-01-13T03:44:00,441<span style=color:#ff79c6>][</span>INFO <span style=color:#ff79c6>][</span>logstash.agent           <span style=color:#ff79c6>]</span> Successfully started Logstash API endpoint <span style=color:#ff79c6>{</span>:port<span style=color:#ff79c6>=</span>&gt;9600<span style=color:#ff79c6>}</span>
hello world
<span style=color:#ff79c6>{</span>
       <span style=color:#f1fa8c>&#34;message&#34;</span> <span style=color:#ff79c6>=</span>&gt; <span style=color:#f1fa8c>&#34;hello world&#34;</span>,
          <span style=color:#f1fa8c>&#34;host&#34;</span> <span style=color:#ff79c6>=</span>&gt; <span style=color:#f1fa8c>&#34;GWR1&#34;</span>,
      <span style=color:#f1fa8c>&#34;@version&#34;</span> <span style=color:#ff79c6>=</span>&gt; <span style=color:#f1fa8c>&#34;1&#34;</span>,
    <span style=color:#f1fa8c>&#34;@timestamp&#34;</span> <span style=color:#ff79c6>=</span>&gt; 2021-01-13T08:44:43.028Z
<span style=color:#ff79c6>}</span>
</code></pre></div><h3 id=配置输入和输出>配置输入和输出<a href=#配置输入和输出 class=anchor aria-hidden=true>#</a></h3><p>新建配置文件 logstash.conf：接收来自 Filebeat 的输出结果，并将结果处理后输出到 Elasticsearch 中。此处的 IP 地址需要填写本机的内网或外网 IP，不可以写"localhost"。</p><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json>input{
  beats {
    port =&gt; <span style=color:#ff79c6>&#34;5044&#34;</span>
  }
}
filter {
    # 可以对 Filebeat 的输出结果进行处理
}
output {
  elasticsearch {
    hosts =&gt; [<span style=color:#ff79c6>&#34;YOUR_IP:9200&#34;</span>]
  }
}
</code></pre></div><p>启动 logstash 时添加 flag:"-f"即可使配置文件生效，同时可以使用 nohup 命令配合"&&ldquo;实现后台运行：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>nohup ./bin/logstash -f logstash.conf &amp;
</code></pre></div><h2 id=部署-filebeat>部署 Filebeat<a href=#部署-filebeat class=anchor aria-hidden=true>#</a></h2><h3 id=下载安装包-3>下载安装包<a href=#下载安装包-3 class=anchor aria-hidden=true>#</a></h3><p>下载地址：<a href=https://www.elastic.co/cn/downloads/beats/filebeat>https://www.elastic.co/cn/downloads/beats/filebeat</a></p><h3 id=解压-3>解压<a href=#解压-3 class=anchor aria-hidden=true>#</a></h3><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>tar -xzf filebeat-7.10.1-linux-x86_64.tar.gz
</code></pre></div><h3 id=修改配置文件>修改配置文件<a href=#修改配置文件 class=anchor aria-hidden=true>#</a></h3><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#8be9fd;font-style:italic>cd</span> filebeat-7.10.1
vim filebeat.yml
</code></pre></div><p>首先将 Filebeat 关联到 ElasticSearch 中：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#ff79c6>output.elasticsearch</span>:
  <span style=color:#ff79c6>hosts</span>: [<span style=color:#f1fa8c>&#34;myEShost:9200&#34;</span>]
  <span style=color:#ff79c6>username</span>: <span style=color:#f1fa8c>&#34;filebeat_internal&#34;</span>
  <span style=color:#ff79c6>password</span>: <span style=color:#f1fa8c>&#34;YOUR_PASSWORD&#34;</span> 
</code></pre></div><p>然后关联 Kibana：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#ff79c6>setup.kibana</span>:
    <span style=color:#ff79c6>host</span>: <span style=color:#f1fa8c>&#34;mykibanahost:5601&#34;</span> 
    <span style=color:#ff79c6>username</span>: <span style=color:#f1fa8c>&#34;my_kibana_user&#34;</span>  
    <span style=color:#ff79c6>password</span>: <span style=color:#f1fa8c>&#34;{pwd}&#34;</span>
</code></pre></div><p>如果 ElasticSearch 和 Kibana 运行在同一台主机上，则无需进行这一步的配置。</p><h3 id=添加-filebeat-收集日志的模块>添加 Filebeat 收集日志的模块<a href=#添加-filebeat-收集日志的模块 class=anchor aria-hidden=true>#</a></h3><p>首先查看模块列表：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>./filebeat modules list
</code></pre></div><p>然后添加需要的模块（以 nginx 和 mysql 为例）</p><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>./filebeat modules <span style=color:#8be9fd;font-style:italic>enable</span> system nginx mysql
</code></pre></div><p>每个模块的配置文件存放在 modules.d 文件夹下：</p><p><img src=https://cdn.jsdelivr.net/gh/koktlzz/NoteImg@main/20210114102459.png alt=20210114102459></p><h3 id=将-filebeat-的输出结果送往-logstash-处理>将 Filebeat 的输出结果送往 Logstash 处理<a href=#将-filebeat-的输出结果送往-logstash-处理 class=anchor aria-hidden=true>#</a></h3><p>新建一个 yaml 文件 filebeat_config.yml：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#ff79c6>filebeat.inputs</span>:
- <span style=color:#ff79c6>type</span>: log
  <span style=color:#ff79c6>enabled</span>: <span style=color:#ff79c6>true</span>
  <span style=color:#ff79c6>paths</span>:
    - /var/log/*.log
<span style=color:#ff79c6>output.logstash</span>:
  <span style=color:#ff79c6>hosts</span>: [<span style=color:#f1fa8c>&#34;YOUR_IP:5044&#34;</span>]
</code></pre></div><p>上述配置文件规定了 Filebeat 的输入来自于/var/log 文件夹下的所有日志文件，结果输出到 Logstash 暴露的 5044 端口中。此处的 IP 地址需要填写本机的内网或外网 IP，不可以写"localhost&rdquo;。</p><h3 id=启动-filebeat>启动 Filebeat<a href=#启动-filebeat class=anchor aria-hidden=true>#</a></h3><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>./filebeat setup -e
./filebeat -e -c filebeat_config.yml
</code></pre></div><p class=edit-page><a href=https://github.com/koktlzz/koktlzz.github.io/blob/master/content/Observability/ElasticStack/%e5%8d%95%e8%8a%82%e7%82%b9%e9%83%a8%e7%bd%b2%e6%b5%81%e7%a8%8b.md><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-edit-2"><path d="M17 3a2.828 2.828.0 114 4L7.5 20.5 2 22l1.5-5.5L17 3z"/></svg>Edit this page on GitHub</a></p><div class="docs-navigation d-flex justify-content-between"><a href=https://koktlzz.github.io/observability/elasticstack/intro/><div class="card my-1"><div class="card-body py-2">&larr; Getting Started</div></div></a><a class=ms-auto href=https://koktlzz.github.io/observability/elasticstack/elasticsearchintro/><div class="card my-1"><div class="card-body py-2">ElasticSearch 简介 &rarr;</div></div></a></div><script src=https://utteranc.es/client.js repo=koktlzz/koktlzz.github.io issue-term=pathname theme=photon-dark crossorigin=anonymous async></script></main><nav class="docs-toc d-none d-xl-block col-lg-3 col-xl-2" aria-label="Secondary navigation"><div class=page-links><h3>On this page</h3><nav id=TableOfContents><ul><li><a href=#部署-elasticsearch>部署 ElasticSearch</a><ul><li><a href=#下载安装包>下载安装包</a></li><li><a href=#解压>解压</a></li><li><a href=#添加用户>添加用户</a></li><li><a href=#启动应用>启动应用</a></li><li><a href=#检查应用>检查应用</a></li><li><a href=#终止应用>终止应用</a></li><li><a href=#外部访问>外部访问</a></li></ul></li><li><a href=#部署-kibana>部署 Kibana</a><ul><li><a href=#下载安装包-1>下载安装包</a></li><li><a href=#解压-1>解压</a></li><li><a href=#启动应用-1>启动应用</a></li><li><a href=#检查应用-1>检查应用</a></li><li><a href=#外部访问-1>外部访问</a></li></ul></li><li><a href=#部署-logstash>部署 Logstash</a><ul><li><a href=#下载安装包-2>下载安装包</a></li><li><a href=#解压-2>解压</a></li><li><a href=#启动应用-2>启动应用</a></li><li><a href=#测试应用>测试应用</a></li><li><a href=#配置输入和输出>配置输入和输出</a></li></ul></li><li><a href=#部署-filebeat>部署 Filebeat</a><ul><li><a href=#下载安装包-3>下载安装包</a></li><li><a href=#解压-3>解压</a></li><li><a href=#修改配置文件>修改配置文件</a></li><li><a href=#添加-filebeat-收集日志的模块>添加 Filebeat 收集日志的模块</a></li><li><a href=#将-filebeat-的输出结果送往-logstash-处理>将 Filebeat 的输出结果送往 Logstash 处理</a></li><li><a href=#启动-filebeat>启动 Filebeat</a></li></ul></li></ul></nav></div></nav></div></div></div><script src=https://koktlzz.github.io/js/bootstrap.min.d67050adf5d370668aede4201f82af781b16970934804995a1ca37c1ee9222c2fc530972aa6d5d2b6124caf1fe318f139aac99df2c1e89af65504fc1185c7972.js integrity="sha512-1nBQrfXTcGaK7eQgH4KveBsWlwk0gEmVoco3we6SIsL8Uwlyqm1dK2EkyvH+MY8TmqyZ3yweia9lUE/BGFx5cg==" crossorigin=anonymous defer></script><script src=https://koktlzz.github.io/js/vendor/katex/dist/katex.min.b334e5b00c45f572e7f38a543046f36854bf4cbb543880480c09271a0efedc694d6905f719934f6ede2f26f52e80411c05b90121d722cbf8be2fa8fc51bc6b81.js integrity="sha512-szTlsAxF9XLn84pUMEbzaFS/TLtUOIBIDAknGg7+3GlNaQX3GZNPbt4vJvUugEEcBbkBIdciy/i+L6j8UbxrgQ==" crossorigin=anonymous defer></script><script src=https://koktlzz.github.io/js/vendor/katex/dist/contrib/auto-render.min.916823ec103cf367b71e28a6f01513cb9c3ac6708ccb5229402ec46b8e30a8b25003db694df35d80e9dd666a371f327c6152790617b6256390c164109a90bd4c.js integrity="sha512-kWgj7BA882e3Hiim8BUTy5w6xnCMy1IpQC7Ea44wqLJQA9tpTfNdgOndZmo3HzJ8YVJ5Bhe2JWOQwWQQmpC9TA==" crossorigin=anonymous defer></script><script src=https://koktlzz.github.io/main.min.1febbf2f6fd6a36fc2f57dd50d7935fbb640743329baeb4ef7cefcf2e7630e413371fbba976e103656b82808ee227dc4a84237edb0f8433648bef3a56900661a.js integrity="sha512-H+u/L2/Wo2/C9X3VDXk1+7ZAdDMpuutO98788udjDkEzcfu6l24QNla4KAjuIn3EqEI37bD4QzZIvvOlaQBmGg==" crossorigin=anonymous defer></script></body></html>