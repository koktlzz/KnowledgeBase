<!doctype html><html lang=en-us><head><script async src="https://www.googletagmanager.com/gtag/js?id=G-D022F6NT2P"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','G-D022F6NT2P')</script><script>(function(b,d,e,a,g){b[a]=b[a]||[],b[a].push({'gtm.start':(new Date).getTime(),event:'gtm.js'});var f=d.getElementsByTagName(e)[0],c=d.createElement(e),h=a!='dataLayer'?'&l='+a:'';c.async=!0,c.src='https://www.googletagmanager.com/gtm.js?id='+g+h,f.parentNode.insertBefore(c,f)})(window,document,'script','dataLayer','GTM-P72R45W')</script><meta charset=utf-8><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><link rel=preload as=font href=https://koktlzz.github.io/fonts/vendor/jost/jost-v4-latin-regular.woff2 type=font/woff2 crossorigin><link rel=preload as=font href=https://koktlzz.github.io/fonts/vendor/jost/jost-v4-latin-700.woff2 type=font/woff2 crossorigin><link rel=preload as=font href=https://koktlzz.github.io/fonts/KaTeX_Main-Regular.woff2 type=font/woff2 crossorigin><link rel=preload as=font href=https://koktlzz.github.io/fonts/KaTeX_Math-Italic.woff2 type=font/woff2 crossorigin><link rel=stylesheet href=https://koktlzz.github.io/main.0ae7165cfeda76c765ab05aa408a696be65779f1e277afd078efecc543cc00bb72be873f087e148ccf7ac1016b22c2d2586f058c7ee5d92dcca60206eae2dd99.css integrity="sha512-CucWXP7adsdlqwWqQIppa+ZXefHid6/QeO/sxUPMALtyvoc/CH4UjM96wQFrIsLSWG8FjH7l2S3MpgIG6uLdmQ==" crossorigin=anonymous><noscript><style>img.lazyload{display:none}</style></noscript><meta name=robots content="index, follow"><meta name=googlebot content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1"><meta name=bingbot content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1"><title>DNS、UDP 与 HTTPS | Inspire Hub</title><meta name=description content><link rel=canonical href=https://koktlzz.github.io/infra/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80/dnshttps/><meta property="og:locale" content="en_US"><meta property="og:type" content="article"><meta property="og:title" content="DNS、UDP 与 HTTPS"><meta property="og:description" content="DNS 概述 DNS(Domain Name System) 是“域名系统”的英文缩写，是一种组织成域层次结构的计算机和网络服务命名系统。它在大多数情况下运行在 UDP 协议之上，从事将主机名或域名转换为实际 IP 地址的工作。
当你访问本网站的域名 koktlzz.github.io，操作系统会先检查自己本地的 hosts 文件是否有这个网址映射关系，如果有，就先调用这个 IP 地址映射，完成域名解析。
[root@koktlzz ~]# cat /etc/hosts ::1 localhost localhost.localdomain localhost6 localhost6.localdomain6 127.0.0.1 localhost localhost.localdomain localhost4 localhost4.localdomain4 172.30.33.166 koktlzz.github.io koktlzz [root@koktlzz ~]# ping koktlzz PING koktlzz.github.io (172.30.33.166) 56(84) bytes of data. 如果本地配置里没有这个域名的映射，则查找本地 DNS 解析器缓存中是否有这个网址映射关系，若有则直接返回目标 IP 地址。而如果 hosts 文件与本地 DNS 解析器缓存都没有相应的网址映射关系，操作系统会向首选 DNS 服务器（在此我们叫它本地 DNS 服务器）发起请求。DNS 配置保存在 resolv.conf 文件中，其中的nameserver字段对应的便是本地 DNS 服务器地址：
[root@koktlzz ~]# cat /etc/resolv.conf  # Generated by NetworkManager nameserver 100."><meta property="og:url" content="https://koktlzz.github.io/infra/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80/dnshttps/"><meta property="og:site_name" content="Inspire Hub"><meta property="article:published_time" content="2021-02-24T22:05:45+08:00"><meta property="article:modified_time" content="2021-02-24T22:05:45+08:00"><meta property="og:image" content="https://koktlzz.github.io/doks.png"><meta property="og:image:alt" content="Inspire Hub"><meta name=twitter:card content="summary_large_image"><meta name=twitter:site content="@getdoks"><meta name=twitter:creator content="@henkverlinde"><meta name=twitter:title content="DNS、UDP 与 HTTPS"><meta name=twitter:description content><meta name=twitter:image content="https://koktlzz.github.io/doks.png"><meta name=twitter:image:alt content="DNS、UDP 与 HTTPS"><script type=application/ld+json>{"@context":"https://schema.org","@graph":[{"@type":"Organization","@id":"https://koktlzz.github.io/#/schema/organization/1","name":"Doks","url":"https://koktlzz.github.io/","sameAs":["https://twitter.com/getdoks","https://github.com/h-enk/doks"],"logo":{"@type":"ImageObject","@id":"https://koktlzz.github.io/#/schema/image/1","url":"https://koktlzz.github.io/logo-doks.png","width":512,"height":512,"caption":"Doks"},"image":{"@id":"https://koktlzz.github.io/#/schema/image/1"}},{"@type":"WebSite","@id":"https://koktlzz.github.io/#/schema/website/1","url":"https://koktlzz.github.io/","name":"Inspire Hub","description":"","publisher":{"@id":"https://koktlzz.github.io/#/schema/organization/1"}},{"@type":"WebPage","@id":"https://koktlzz.github.io/infra/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80/dnshttps/","url":"https://koktlzz.github.io/infra/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80/dnshttps/","name":"DNS、UDP 与 HTTPS","description":"","isPartOf":{"@id":"https://koktlzz.github.io/#/schema/website/1"},"about":{"@id":"https://koktlzz.github.io/#/schema/organization/1"},"datePublished":"2021-02-24T22:05:45CET","dateModified":"2021-02-24T22:05:45CET","breadcrumb":{"@id":"https://koktlzz.github.io/infra/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80/dnshttps/#/schema/breadcrumb/1"},"primaryImageOfPage":{"@id":"https://koktlzz.github.io/infra/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80/dnshttps/#/schema/image/2"},"inLanguage":"en-US","potentialAction":[{"@type":"ReadAction","target":["https://koktlzz.github.io/infra/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80/dnshttps/"]}]},{"@type":"BreadcrumbList","@id":"https://koktlzz.github.io/infra/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80/dnshttps/#/schema/breadcrumb/1","name":"Breadcrumbs","itemListElement":[{"@type":"ListItem","position":1,"item":{"@type":"WebPage","@id":"https://koktlzz.github.io/","url":"https://koktlzz.github.io/","name":"Home"}},{"@type":"ListItem","position":2,"item":{"@type":"WebPage","@id":"https://koktlzz.github.io/infra/","url":"https://koktlzz.github.io/infra/","name":"Infra"}},{"@type":"ListItem","position":3,"item":{"@type":"WebPage","@id":"https://koktlzz.github.io/infra/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80/","url":"https://koktlzz.github.io/infra/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80/","name":"% E8% Ae% A1% E7% Ae%97% E6%9 C% Ba% E7% Bd%91% E7% Bb%9 C% E5%9 F% Ba% E7% A1%80"}},{"@type":"ListItem","position":4,"item":{"@id":"https://koktlzz.github.io/infra/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80/dnshttps/"}}]},{"@context":"https://schema.org","@graph":[{"@type":"ImageObject","@id":"https://koktlzz.github.io/infra/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80/dnshttps/#/schema/image/2","url":"https://koktlzz.github.io/doks.png","contentUrl":"https://koktlzz.github.io/doks.png","caption":"DNS、UDP 与 HTTPS"}]}]}</script><meta name=theme-color content="#fff"><link rel=apple-touch-icon sizes=180x180 href=https://koktlzz.github.io/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=https://koktlzz.github.io/favicon-32x32.ico><link rel=icon type=image/png sizes=16x16 href=https://koktlzz.github.io/favicon-16x16.ico><link rel=manifest crossorigin=use-credentials href=https://koktlzz.github.io/site.webmanifest></head><body class="Infra single dark"><noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-P72R45W" height=0 width=0 style=display:none;visibility:hidden></iframe></noscript><div class="header-bar fixed-top"></div><header class="navbar fixed-top navbar-expand-md navbar-light"><div class=container-fluid><input class="menu-btn order-0" type=checkbox id=menu-btn>
<label class="menu-icon d-md-none" for=menu-btn><span class=navicon></span></label><a class="navbar-brand order-1 order-md-0 me-auto" href=https://koktlzz.github.io/>Inspire Hub</a>
<button id=mode class="btn btn-link order-2 order-md-4" type=button aria-label="Toggle mode">
<span class=toggle-dark><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-moon"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg></span><span class=toggle-light><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-sun"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></span></button><ul class="navbar-nav social-nav order-3 order-md-5"><li class=nav-item><a class=nav-link href=https://github.com/koktlzz><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-github"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77 5.44 5.44.0 003.5 8.55c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg><span class="ms-2 visually-hidden">GitHub</span></a></li></ul><div class="collapse navbar-collapse order-4 order-md-1"><ul class="navbar-nav main-nav me-auto order-5 order-md-2"><li class=nav-item><a class=nav-link href=https://koktlzz.github.io/docker/docker%E5%9F%BA%E7%A1%80/intro>Docker</a></li><li class=nav-item><a class=nav-link href=https://koktlzz.github.io/kubernetes/kubernetes%E5%9F%BA%E7%A1%80/intro>Kubernetes</a></li><li class=nav-item><a class=nav-link href=https://koktlzz.github.io/elastic/elasticstack/intro>Elastic</a></li><li class=nav-item><a class=nav-link href=https://koktlzz.github.io/go/go%E5%9F%BA%E7%A1%80/intro>Go</a></li><li class=nav-item><a class=nav-link href=https://koktlzz.github.io/infra/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80/tcpip%E7%BD%91%E7%BB%9C%E6%A8%A1%E5%9E%8B>Infra</a></li><li class=nav-item><a class=nav-link href=https://koktlzz.github.io/prometheus/prometheus/intro>Prometheus</a></li></ul><div class="break order-6 d-md-none"></div></div></div></header><div class="wrap container-fluid" role=document><div class=content><div class="row flex-xl-nowrap"><div class="col-lg-3 col-xl-2 d-none d-xl-block"><nav class=docs-links aria-label="Main navigation"><h3>计算机网络</h3><ul class=list-unstyled><li><a class=docs-link href=https://koktlzz.github.io/infra/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80/tcpip%E7%BD%91%E7%BB%9C%E6%A8%A1%E5%9E%8B/>TCP/IP 网络模型</a></li><li><a class=docs-link href=https://koktlzz.github.io/infra/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80/dnshttps/>DNS、UDP 与 HTTPS</a></li><li><a class=docs-link href=https://koktlzz.github.io/infra/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80/%E8%99%9A%E6%8B%9F%E6%9C%BA%E7%BD%91%E7%BB%9C/>虚拟机网络</a></li><li><a class=docs-link href=https://koktlzz.github.io/infra/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80/vlan/>VLAN</a></li></ul><h3>CSAPP</h3><ul class=list-unstyled><li><a class=docs-link href=https://koktlzz.github.io/infra/csapp/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F%E4%B9%8B%E6%97%85/>计算机系统之旅</a></li><li><a class=docs-link href=https://koktlzz.github.io/infra/csapp/%E4%BF%A1%E6%81%AF%E7%9A%84%E8%A1%A8%E7%A4%BA%E5%92%8C%E5%A4%84%E7%90%86/>信息的表示和处理</a></li><li><a class=docs-link href=https://koktlzz.github.io/infra/csapp/%E7%A8%8B%E5%BA%8F%E7%9A%84%E6%9C%BA%E5%99%A8%E7%BA%A7%E8%A1%A8%E7%A4%BA/>程序的机器级表示</a></li></ul><h3>Linux</h3><ul class=list-unstyled><li><a class=docs-link href=https://koktlzz.github.io/infra/linux/filepermission/>文件权限</a></li></ul></nav></div><main class="docs-content col-lg-13 col-xl-11"><h1>DNS、UDP 与 HTTPS</h1><p class=lead></p><h2 id=dns>DNS<a href=#dns class=anchor aria-hidden=true>#</a></h2><h3 id=概述>概述<a href=#概述 class=anchor aria-hidden=true>#</a></h3><p>DNS(Domain Name System) 是“域名系统”的英文缩写，是一种组织成域层次结构的计算机和网络服务命名系统。它在大多数情况下运行在 UDP 协议之上，从事将<strong>主机名或域名转换为实际 IP 地址</strong>的工作。</p><p>当你访问本网站的域名 koktlzz.github.io，操作系统会先检查自己本地的 hosts 文件是否有这个网址映射关系，如果有，就先调用这个 IP 地址映射，完成域名解析。</p><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#ff79c6>[</span>root@koktlzz ~<span style=color:#ff79c6>]</span><span style=color:#6272a4># cat /etc/hosts</span>
::1     localhost       localhost.localdomain   localhost6      localhost6.localdomain6
127.0.0.1       localhost       localhost.localdomain   localhost4      localhost4.localdomain4

172.30.33.166   koktlzz.github.io koktlzz
<span style=color:#ff79c6>[</span>root@koktlzz ~<span style=color:#ff79c6>]</span><span style=color:#6272a4># ping koktlzz</span>
PING koktlzz.github.io <span style=color:#ff79c6>(</span>172.30.33.166<span style=color:#ff79c6>)</span> 56<span style=color:#ff79c6>(</span>84<span style=color:#ff79c6>)</span> bytes of data.
</code></pre></div><p>如果本地配置里没有这个域名的映射，则查找本地 DNS 解析器缓存中是否有这个网址映射关系，若有则直接返回目标 IP 地址。而如果 hosts 文件与本地 DNS 解析器缓存都没有相应的网址映射关系，操作系统会向首选 DNS 服务器（在此我们叫它本地 DNS 服务器）发起请求。DNS 配置保存在 resolv.conf 文件中，其中的<code>nameserver</code>字段对应的便是本地 DNS 服务器地址：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#ff79c6>[</span>root@koktlzz ~<span style=color:#ff79c6>]</span><span style=color:#6272a4># cat /etc/resolv.conf </span>
<span style=color:#6272a4># Generated by NetworkManager</span>
nameserver 100.100.2.136
nameserver 100.100.2.138
</code></pre></div><p>由于本站网址 koktlzz.github.io 的全称域名（FQDN）为 koktlzz.github.io.，因此本地 DNS 服务器首先将请求转发至根域名服务器（.），根域名服务器返回一个负责管理。io 域的顶级域名服务器的 IP 地址。本地 DNS 服务器收到信息后，将会再次请求该顶级域名服务器。该服务器收到请求后，如果自己无法解析，它就会返回负责管理 github.io 的次级域名服务器地址给本地 DNS 服务器。本地 DNS 服务器重复上面的步骤，直至找到 koktlzz.github.io 的主机 IP 地址。域名的层级结构如下：</p><p><img src=https://cdn.jsdelivr.net/gh/koktlzz/ImgBed@master/20210420.jpeg alt=20210420></p><p>使用 <strong>dig</strong> 命令可以看到寻找给定域名的 IP 地址的全部过程：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#ff79c6>[</span>root@koktlzz ~<span style=color:#ff79c6>]</span><span style=color:#6272a4># dig +trace -t A koktlzz.github.io </span>

; &lt;&lt;&gt;&gt; DiG 9.11.20-RedHat-9.11.20-5.el8_3.1 &lt;&lt;&gt;&gt; +trace -t A koktlzz.github.io
;; global options: +cmd
.                       <span style=color:#bd93f9>232352</span>  IN      NS      h.root-servers.net.
.                       <span style=color:#bd93f9>232352</span>  IN      NS      a.root-servers.net.
.                       <span style=color:#bd93f9>232352</span>  IN      NS      m.root-servers.net.
.                       <span style=color:#bd93f9>232352</span>  IN      NS      k.root-servers.net.
.                       <span style=color:#bd93f9>232352</span>  IN      NS      b.root-servers.net.
.                       <span style=color:#bd93f9>232352</span>  IN      NS      l.root-servers.net.
.                       <span style=color:#bd93f9>232352</span>  IN      NS      j.root-servers.net.
.                       <span style=color:#bd93f9>232352</span>  IN      NS      g.root-servers.net.
.                       <span style=color:#bd93f9>232352</span>  IN      NS      i.root-servers.net.
.                       <span style=color:#bd93f9>232352</span>  IN      NS      e.root-servers.net.
.                       <span style=color:#bd93f9>232352</span>  IN      NS      c.root-servers.net.
.                       <span style=color:#bd93f9>232352</span>  IN      NS      d.root-servers.net.
.                       <span style=color:#bd93f9>232352</span>  IN      NS      f.root-servers.net.
;; Received <span style=color:#bd93f9>228</span> bytes from 100.100.2.136#53<span style=color:#ff79c6>(</span>100.100.2.136<span style=color:#ff79c6>)</span> in <span style=color:#bd93f9>0</span> ms

io.                     <span style=color:#bd93f9>172800</span>  IN      NS      a2.nic.io.
io.                     <span style=color:#bd93f9>172800</span>  IN      NS      b0.nic.io.
io.                     <span style=color:#bd93f9>172800</span>  IN      NS      c0.nic.io.
io.                     <span style=color:#bd93f9>172800</span>  IN      NS      a0.nic.io.
;; Received <span style=color:#bd93f9>629</span> bytes from 202.12.27.33#53<span style=color:#ff79c6>(</span>m.root-servers.net<span style=color:#ff79c6>)</span> in <span style=color:#bd93f9>33</span> ms

github.io.              <span style=color:#bd93f9>86400</span>   IN      NS      dns2.p05.nsone.net.
github.io.              <span style=color:#bd93f9>86400</span>   IN      NS      ns-1622.awsdns-10.co.uk.
github.io.              <span style=color:#bd93f9>86400</span>   IN      NS      dns1.p05.nsone.net.
github.io.              <span style=color:#bd93f9>86400</span>   IN      NS      dns3.p05.nsone.net.
github.io.              <span style=color:#bd93f9>86400</span>   IN      NS      ns-692.awsdns-22.net.
;; Received <span style=color:#bd93f9>688</span> bytes from 65.22.163.17#53<span style=color:#ff79c6>(</span>a2.nic.io<span style=color:#ff79c6>)</span> in <span style=color:#bd93f9>141</span> ms

koktlzz.github.io.      <span style=color:#bd93f9>3600</span>    IN      A       185.199.108.153
koktlzz.github.io.      <span style=color:#bd93f9>3600</span>    IN      A       185.199.109.153
koktlzz.github.io.      <span style=color:#bd93f9>3600</span>    IN      A       185.199.110.153
koktlzz.github.io.      <span style=color:#bd93f9>3600</span>    IN      A       185.199.111.153
;; Received <span style=color:#bd93f9>110</span> bytes from 198.51.45.5#53<span style=color:#ff79c6>(</span>dns2.p05.nsone.net<span style=color:#ff79c6>)</span> in <span style=color:#bd93f9>62</span> ms
</code></pre></div><p>每行输出结果共有 5 个字段，第一个字段是请求，最后一个字段是响应。第二个字段是 DNS 响应的有效时间 TimetoLive（以秒为单位），一小时内有效，而第四个字段代表 DNS 响应/请求的类型。从输出结果的 Recieve from 信息中我们可以看到此次 DNS 解析共经过了：本地 DNS 服务器 100.100.2.136、根域名服务器 m.root-servers.net、顶级域名服务器 a2.nic.io 和权威域名服务器 dns2.p05.nsone.net。这个权威域名服务器实际上是由次级域名服务器 github.io. 的域名注册商维护的，它可以根据已有配置（就像 hosts 文件那样）直接返回 koktlzz.github.io. 域名的 IP 地址。</p><p>上述过程用图片说明可能更加直观：</p><p><img src=https://cdn.jsdelivr.net/gh/koktlzz/NoteImg@main/20201223142840.png alt=20201223142840></p><blockquote><p>所谓递归查询过程就是“查询的递交者”更替，而迭代查询过程则是“查询的递交者”不变。
举个例子来说，你想知道某个一起上法律课的女孩的电话，并且你偷偷拍了她的照片，回到寝室告诉一个很仗义的哥们儿，这个哥们儿二话没说，拍着胸脯告诉你，甭急，我替你查（此处完成了一次递归查询，即，问询者的角色更替）。然后他拿着照片问了学院大四学长，学长告诉他，这姑娘是 xx 系的；然后这哥们儿马不停蹄又问了 xx 系的办公室主任助理同学，助理同学说是 xx 系 yy 班的，然后很仗义的哥们儿去 xx 系 yy 班的班长那里取到了该女孩儿电话。（此处完成若干次迭代查询，即，问询者角色不变，但反复更替问询对象）最后，他把号码交到了你手里。完成整个查询过程。</p></blockquote><h3 id=记录类型>记录类型<a href=#记录类型 class=anchor aria-hidden=true>#</a></h3><ul><li>A 记录（Address）：指定主机名（或域名）对应的 IPv4 地址的记录；</li><li>AAAA 记录：指定主机名（或域名）对应的 IPv6 地址的记录；</li><li>NS（Name Server）记录：指定主机名（或域名）由哪个 DNS 服务器来进行解析；</li><li>CNAME 记录 (Canonical Name)：将一个或多个主机名（域名）映射到一个域名记录上。例如可以将 ftp.example.com 和 www.example.com 指向 CNAME 记录 example.com，这样访问 ftp.example.com 时便会解析 example.com 对应的 IP 地址（A 记录）；</li><li>SRV 记录：标识某台主机暴露的某个服务，其格式为<code>_Service._Proto.Name TTL Class SRV Priority Weight Port Target</code>。其中，Service 是目标主机提供的服务名称，Proto 是协议类型（_TCP/<em>UDP），Port 是服务暴露的端口（前加、</em>），Target 是目标主机的域名。</li></ul><h2 id=udp-协议>UDP 协议<a href=#udp-协议 class=anchor aria-hidden=true>#</a></h2><p>只实现多路复用（将来自应用层的多个应用程序的数据包组合到同一网络层）和多路分离（将来自单个网络层的数据包分发到多个应用程序）。DNS 通常使用 UDP 协议传输数据。</p><p>虽然 UDP 协议位于传输控制层，但数据包在主机间的传递是由其底层的 IP 协议完成的，UDP 协议只是根据端口号定位处理数据的具体进程。</p><blockquote><p>IP 协议是 TCP/IP 协议栈的核心成员，它不保证端到端数据的可靠性和顺序，也不包含流控制等机制，其作用就是从来源向目的地传输数据包。『UDP 协议只能尽力送达数据』这一说法『继承』自 UDP 的下层协议，也就是 IP 协议。只包含了两个端口号的 UDP 协议本身是无法提供路由和寻址功能的，它还是需要下层的协议来解决这个问题。</p></blockquote><h3 id=udp-的主要特点>UDP 的主要特点<a href=#udp-的主要特点 class=anchor aria-hidden=true>#</a></h3><ol><li>UDP 是无连接的，可以减少建立连接的开销和发送数据之前的延时；</li><li>UDP 使用最大努力交付，不保证可靠交付；</li><li>UDP 是面向报文的，一次发送一个完整的报文（对应用层报文不做任何处理，仅增加一个 UDP 首部）；</li><li>适合一次性传输少量数据的网络应用；</li><li>UDP 无阻塞控制，适合很多实时应用；</li><li>UDP 首部开销小，仅有 8B（TCP 首部 20B）；</li><li>有单播、多播和广播的功能；</li><li>相对于 TCP 套接字的四元组，UDP 套接字只包含了目的 IP+目的端口号。</li></ol><h3 id=udp-首部格式>UDP 首部格式<a href=#udp-首部格式 class=anchor aria-hidden=true>#</a></h3><ol><li>16 位源端口号：2B</li><li>16 位目标端口号：2B</li><li>16 位 UDP 长度（UDP 首部+数据字段总长度）：2B</li><li>16 位 UDP 检验码（利用伪首部检验首部和数据字段是否有错，如有错则丢弃或附上错误警告交给应用层）：2B</li></ol><h2 id=https-协议>HTTPS 协议<a href=#https-协议 class=anchor aria-hidden=true>#</a></h2><p><img src=https://cdn.jsdelivr.net/gh/koktlzz/ImgBed@master/20210109125505.png alt=20210109125505></p><ol><li>Client 发起一个 HTTPS（https:/demo.linianhui.dev）的请求，根据 RFC2818 的规定，Client 知道需要连接 Server 的 443（默认）端口。</li><li>Server 把事先配置好的公钥证书（public key certificate）返回给客户端。</li><li>Client 验证公钥证书：比如是否在有效期内，证书的用途是不是匹配 Client 请求的站点，是不是在 CRL 吊销列表里面，它的上一级证书是否有效，这是一个递归的过程，直到验证到根证书（操作系统内置的 Root 证书或者 Client 内置的 Root 证书）。如果验证通过则继续，不通过则显示警告信息。</li><li>Client 使用伪随机数生成器生成加密所使用的会话密钥，然后用证书的公钥加密这个会话密钥，发给 Server。</li><li>Server 使用自己的私钥（private key）解密这个消息，得到会话密钥。至此，Client 和 Server 双方都持有了相同的会话密钥。</li><li>Server 使用会话密钥加密“明文内容 A”，发送给 Client。Client 使用会话密钥解密响应的密文，得到“明文内容 A”。</li><li>Client 再次发起 HTTPS 的请求，使用会话密钥加密请求的“明文内容 B”，然后 Server 使用会话密钥解密密文，得到“明文内容 B”。</li></ol><p>在 Linux 系统中使用命令：<strong>curl https://www.baidu.com -v</strong>，可以观察到上述加密流程：</p><p><img src=https://cdn.jsdelivr.net/gh/koktlzz/ImgBed@master/20210109124816.png alt=20210109124816></p><p class=edit-page><a href=https://github.com/koktlzz/koktlzz.github.io/blob/master/content/Infra/%e8%ae%a1%e7%ae%97%e6%9c%ba%e7%bd%91%e7%bb%9c%e5%9f%ba%e7%a1%80/DNS&HTTPS.md><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-edit-2"><path d="M17 3a2.828 2.828.0 114 4L7.5 20.5 2 22l1.5-5.5L17 3z"/></svg>Edit this page on GitHub</a></p><div class="docs-navigation d-flex justify-content-between"><a href=https://koktlzz.github.io/infra/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80/tcpip%E7%BD%91%E7%BB%9C%E6%A8%A1%E5%9E%8B/><div class="card my-1"><div class="card-body py-2">&larr; TCP/IP 网络模型</div></div></a><a class=ms-auto href=https://koktlzz.github.io/infra/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80/%E8%99%9A%E6%8B%9F%E6%9C%BA%E7%BD%91%E7%BB%9C/><div class="card my-1"><div class="card-body py-2">虚拟机网络 &rarr;</div></div></a></div><script src=https://utteranc.es/client.js repo=koktlzz/koktlzz.github.io issue-term=pathname theme=photon-dark crossorigin=anonymous async></script></main><nav class="docs-toc d-none d-xl-block col-lg-3 col-xl-2" aria-label="Secondary navigation"><div class=page-links><h3>On this page</h3><nav id=TableOfContents><ul><li><a href=#dns>DNS</a><ul><li><a href=#概述>概述</a></li><li><a href=#记录类型>记录类型</a></li></ul></li><li><a href=#udp-协议>UDP 协议</a><ul><li><a href=#udp-的主要特点>UDP 的主要特点</a></li><li><a href=#udp-首部格式>UDP 首部格式</a></li></ul></li><li><a href=#https-协议>HTTPS 协议</a></li></ul></nav></div></nav></div></div></div><footer class="footer text-muted"><div class=container><div class=row><div class="col-lg-8 order-last order-lg-first"><ul class=list-inline><li class=list-inline-item></li></ul></div><div class="col-lg-8 order-first order-lg-last text-lg-end"><ul class=list-inline></ul></div></div></div></footer><script src=https://koktlzz.github.io/js/bootstrap.min.d67050adf5d370668aede4201f82af781b16970934804995a1ca37c1ee9222c2fc530972aa6d5d2b6124caf1fe318f139aac99df2c1e89af65504fc1185c7972.js integrity="sha512-1nBQrfXTcGaK7eQgH4KveBsWlwk0gEmVoco3we6SIsL8Uwlyqm1dK2EkyvH+MY8TmqyZ3yweia9lUE/BGFx5cg==" crossorigin=anonymous defer></script><script src=https://koktlzz.github.io/js/vendor/katex/dist/katex.min.b334e5b00c45f572e7f38a543046f36854bf4cbb543880480c09271a0efedc694d6905f719934f6ede2f26f52e80411c05b90121d722cbf8be2fa8fc51bc6b81.js integrity="sha512-szTlsAxF9XLn84pUMEbzaFS/TLtUOIBIDAknGg7+3GlNaQX3GZNPbt4vJvUugEEcBbkBIdciy/i+L6j8UbxrgQ==" crossorigin=anonymous defer></script><script src=https://koktlzz.github.io/js/vendor/katex/dist/contrib/auto-render.min.916823ec103cf367b71e28a6f01513cb9c3ac6708ccb5229402ec46b8e30a8b25003db694df35d80e9dd666a371f327c6152790617b6256390c164109a90bd4c.js integrity="sha512-kWgj7BA882e3Hiim8BUTy5w6xnCMy1IpQC7Ea44wqLJQA9tpTfNdgOndZmo3HzJ8YVJ5Bhe2JWOQwWQQmpC9TA==" crossorigin=anonymous defer></script><script src=https://koktlzz.github.io/main.min.1febbf2f6fd6a36fc2f57dd50d7935fbb640743329baeb4ef7cefcf2e7630e413371fbba976e103656b82808ee227dc4a84237edb0f8433648bef3a56900661a.js integrity="sha512-H+u/L2/Wo2/C9X3VDXk1+7ZAdDMpuutO98788udjDkEzcfu6l24QNla4KAjuIn3EqEI37bD4QzZIvvOlaQBmGg==" crossorigin=anonymous defer></script></body></html>