<!doctype html><html lang=en-us><head><script async src="https://www.googletagmanager.com/gtag/js?id=G-D022F6NT2P"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','G-D022F6NT2P')</script><script>(function(b,d,e,a,g){b[a]=b[a]||[],b[a].push({'gtm.start':(new Date).getTime(),event:'gtm.js'});var f=d.getElementsByTagName(e)[0],c=d.createElement(e),h=a!='dataLayer'?'&l='+a:'';c.async=!0,c.src='https://www.googletagmanager.com/gtm.js?id='+g+h,f.parentNode.insertBefore(c,f)})(window,document,'script','dataLayer','GTM-P72R45W')</script><meta charset=utf-8><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><link rel=preload as=font href=https://koktlzz.github.io/fonts/vendor/jost/jost-v4-latin-regular.woff2 type=font/woff2 crossorigin><link rel=preload as=font href=https://koktlzz.github.io/fonts/vendor/jost/jost-v4-latin-700.woff2 type=font/woff2 crossorigin><link rel=preload as=font href=https://koktlzz.github.io/fonts/KaTeX_Main-Regular.woff2 type=font/woff2 crossorigin><link rel=preload as=font href=https://koktlzz.github.io/fonts/KaTeX_Math-Italic.woff2 type=font/woff2 crossorigin><link rel=stylesheet href=https://koktlzz.github.io/main.ebca557cf3c32b5d7383007b1d6530ae70a1c5514b328a864833775693332c3b061b5d3b53c07da94226d83ae7e1b1154ae602c9af23bf774333c01006692c0e.css integrity="sha512-68pVfPPDK11zgwB7HWUwrnChxVFLMoqGSDN3VpMzLDsGG107U8B9qUIm2Drn4bEVSuYCya8jv3dDM8AQBmksDg==" crossorigin=anonymous><noscript><style>img.lazyload{display:none}</style></noscript><meta name=robots content="index, follow"><meta name=googlebot content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1"><meta name=bingbot content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1"><title>ElasticSearch 简介 | KnowledgeBase</title><meta name=description content><link rel=canonical href=https://koktlzz.github.io/observability/elasticstack/elasticsearchintro/><meta property="og:locale" content="en_US"><meta property="og:type" content="article"><meta property="og:title" content="ElasticSearch 简介"><meta property="og:description" content="基本概念与 MySQL 的对比    ElasticSearch MySQL     Index Database   Type （未来将删除） Table   Document Row   Field Column   Mapping Schema   Everything is indexed Index   Query DSL SQL   GET HTTP SELECT   PUT HTTP UPDATE    倒排索引 为了实现倒排索引，Elasticsearch 中的每个文档（document）中不仅保存了其自身数据，还包括了以下内容：
 _id 字段：每个文档在索引中的唯一标识； 词频 TF：每个 token 在文档中出现的次数，用于相关性评分； 位置 Position：token 在文档中分词的位置，用于 match_phrase 类型的查询； 偏移量 Offset：记录 token 开始和结束的位置，实现高亮显示。  创建倒排索引 对文档内容进行分词，形成一个个 token（可以理解为单词），保存 token 和文档_id 之间的映射关系。详见 Text Analysis。"><meta property="og:url" content="https://koktlzz.github.io/observability/elasticstack/elasticsearchintro/"><meta property="og:site_name" content="KnowledgeBase"><meta property="article:published_time" content="2020-11-04T09:19:42+01:00"><meta property="article:modified_time" content="2020-11-04T09:19:42+01:00"><meta property="og:image" content="https://koktlzz.github.io/doks.png"><meta property="og:image:alt" content="KnowledgeBase"><meta name=twitter:card content="summary_large_image"><meta name=twitter:site content="@getdoks"><meta name=twitter:creator content="@henkverlinde"><meta name=twitter:title content="ElasticSearch 简介"><meta name=twitter:description content><meta name=twitter:image content="https://koktlzz.github.io/doks.png"><meta name=twitter:image:alt content="ElasticSearch 简介"><script type=application/ld+json>{"@context":"https://schema.org","@graph":[{"@type":"Organization","@id":"https://koktlzz.github.io/#/schema/organization/1","name":"Doks","url":"https://koktlzz.github.io/","sameAs":["https://twitter.com/getdoks","https://github.com/h-enk/doks"],"logo":{"@type":"ImageObject","@id":"https://koktlzz.github.io/#/schema/image/1","url":"https://koktlzz.github.io/logo-doks.png","width":512,"height":512,"caption":"Doks"},"image":{"@id":"https://koktlzz.github.io/#/schema/image/1"}},{"@type":"WebSite","@id":"https://koktlzz.github.io/#/schema/website/1","url":"https://koktlzz.github.io/","name":"KnowledgeBase","description":"","publisher":{"@id":"https://koktlzz.github.io/#/schema/organization/1"}},{"@type":"WebPage","@id":"https://koktlzz.github.io/observability/elasticstack/elasticsearchintro/","url":"https://koktlzz.github.io/observability/elasticstack/elasticsearchintro/","name":"ElasticSearch 简介","description":"","isPartOf":{"@id":"https://koktlzz.github.io/#/schema/website/1"},"about":{"@id":"https://koktlzz.github.io/#/schema/organization/1"},"datePublished":"2020-11-04T09:19:42CET","dateModified":"2020-11-04T09:19:42CET","breadcrumb":{"@id":"https://koktlzz.github.io/observability/elasticstack/elasticsearchintro/#/schema/breadcrumb/1"},"primaryImageOfPage":{"@id":"https://koktlzz.github.io/observability/elasticstack/elasticsearchintro/#/schema/image/2"},"inLanguage":"en-US","potentialAction":[{"@type":"ReadAction","target":["https://koktlzz.github.io/observability/elasticstack/elasticsearchintro/"]}]},{"@type":"BreadcrumbList","@id":"https://koktlzz.github.io/observability/elasticstack/elasticsearchintro/#/schema/breadcrumb/1","name":"Breadcrumbs","itemListElement":[{"@type":"ListItem","position":1,"item":{"@type":"WebPage","@id":"https://koktlzz.github.io/","url":"https://koktlzz.github.io/","name":"Home"}},{"@type":"ListItem","position":2,"item":{"@type":"WebPage","@id":"https://koktlzz.github.io/observability/","url":"https://koktlzz.github.io/observability/","name":"Observability"}},{"@type":"ListItem","position":3,"item":{"@type":"WebPage","@id":"https://koktlzz.github.io/observability/elasticstack/","url":"https://koktlzz.github.io/observability/elasticstack/","name":"Elasticstack"}},{"@type":"ListItem","position":4,"item":{"@id":"https://koktlzz.github.io/observability/elasticstack/elasticsearchintro/"}}]},{"@context":"https://schema.org","@graph":[{"@type":"ImageObject","@id":"https://koktlzz.github.io/observability/elasticstack/elasticsearchintro/#/schema/image/2","url":"https://koktlzz.github.io/doks.png","contentUrl":"https://koktlzz.github.io/doks.png","caption":"ElasticSearch 简介"}]}]}</script><meta name=theme-color content="#fff"><link rel=apple-touch-icon sizes=180x180 href=https://koktlzz.github.io/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=https://koktlzz.github.io/favicon-32x32.ico><link rel=icon type=image/png sizes=16x16 href=https://koktlzz.github.io/favicon-16x16.ico><link rel=manifest crossorigin=use-credentials href=https://koktlzz.github.io/site.webmanifest></head><body class="Observability single dark"><noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-P72R45W" height=0 width=0 style=display:none;visibility:hidden></iframe></noscript><div class="header-bar fixed-top"></div><header class="navbar fixed-top navbar-expand-md navbar-light"><div class=container-fluid><input class="menu-btn order-0" type=checkbox id=menu-btn>
<label class="menu-icon d-md-none" for=menu-btn><span class=navicon></span></label><a class="navbar-brand order-1 order-md-0 me-auto" href=https://koktlzz.github.io/>KnowledgeBase</a>
<button id=mode class="btn btn-link order-2 order-md-4" type=button aria-label="Toggle mode">
<span class=toggle-dark><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-moon"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg></span><span class=toggle-light><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-sun"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></span></button><ul class="navbar-nav social-nav order-3 order-md-5"><li class=nav-item><a class=nav-link href=https://github.com/koktlzz><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-github"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77 5.44 5.44.0 003.5 8.55c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg><span class="ms-2 visually-hidden">GitHub</span></a></li></ul><div class="collapse navbar-collapse order-4 order-md-1"><ul class="navbar-nav main-nav me-auto order-5 order-md-2"><li class=nav-item><a class=nav-link href=https://koktlzz.github.io/container/docker/intro>Container</a></li><li class=nav-item><a class=nav-link href=https://koktlzz.github.io/observability/elasticstack/intro>Observability</a></li><li class=nav-item><a class=nav-link href=https://koktlzz.github.io/programming/go/intro>Programming</a></li><li class=nav-item><a class=nav-link href=https://koktlzz.github.io/infrastructure/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/tcpip%E7%BD%91%E7%BB%9C%E6%A8%A1%E5%9E%8B>Infrastructure</a></li></ul><div class="break order-6 d-md-none"></div></div></div></header><div class="wrap container-fluid" role=document><div class=content><div class="row flex-xl-nowrap"><div class="col-lg-4 col-xl-3 d-none d-xl-block"><nav class=docs-links aria-label="Main navigation"><h3>ElasticStack</h3><ul class=list-unstyled><li><a class=docs-link href=https://koktlzz.github.io/observability/elasticstack/intro/>Getting Started</a></li><li><a class=docs-link href=https://koktlzz.github.io/observability/elasticstack/%E5%8D%95%E8%8A%82%E7%82%B9%E9%83%A8%E7%BD%B2%E6%B5%81%E7%A8%8B/>单节点部署流程</a></li><li><a class=docs-link href=https://koktlzz.github.io/observability/elasticstack/elasticsearchintro/>ElasticSearch 简介</a></li><li><a class=docs-link href=https://koktlzz.github.io/observability/elasticstack/mapping/>Mapping</a></li><li><a class=docs-link href=https://koktlzz.github.io/observability/elasticstack/textanalysis/>Text analysis</a></li><li><a class=docs-link href=https://koktlzz.github.io/observability/elasticstack/template/>Template</a></li><li><a class=docs-link href=https://koktlzz.github.io/observability/elasticstack/ilm/>ILM</a></li><li><a class=docs-link href=https://koktlzz.github.io/observability/elasticstack/snapshot/>Snapshot</a></li><li><a class=docs-link href=https://koktlzz.github.io/observability/elasticstack/%E6%80%A7%E8%83%BD%E8%B0%83%E4%BC%98/>Elasticsearch 性能调优</a></li><li><a class=docs-link href=https://koktlzz.github.io/observability/elasticstack/kafkaintro/>Kafka 简介</a></li><li><a class=docs-link href=https://koktlzz.github.io/observability/elasticstack/hw/>Kafka 副本备份</a></li><li><a class=docs-link href=https://koktlzz.github.io/observability/elasticstack/transaction/>Kafka 事务</a></li></ul><h3>Prometheus</h3><ul class=list-unstyled><li><a class=docs-link href=https://koktlzz.github.io/observability/prometheus/intro/>Getting Started</a></li><li><a class=docs-link href=https://koktlzz.github.io/observability/prometheus/operator%E8%87%AA%E5%AE%9A%E4%B9%89%E9%85%8D%E7%BD%AE/>Operator 自定义配置</a></li></ul><h3>Opentelemetry</h3><ul class=list-unstyled><li><a class=docs-link href=https://koktlzz.github.io/observability/opentelemetry/intro/>Getting Started</a></li><li><a class=docs-link href=https://koktlzz.github.io/observability/opentelemetry/opentelemetry/>Collector Example</a></li></ul></nav></div><main class="docs-content col-lg-12 col-xl-10"><h1>ElasticSearch 简介</h1><p class=lead></p><h2 id=基本概念与-mysql-的对比>基本概念与 MySQL 的对比<a href=#基本概念与-mysql-的对比 class=anchor aria-hidden=true>#</a></h2><table><thead><tr><th>ElasticSearch</th><th>MySQL</th></tr></thead><tbody><tr><td>Index</td><td>Database</td></tr><tr><td>Type （未来将删除）</td><td>Table</td></tr><tr><td>Document</td><td>Row</td></tr><tr><td>Field</td><td>Column</td></tr><tr><td>Mapping</td><td>Schema</td></tr><tr><td>Everything is indexed</td><td>Index</td></tr><tr><td>Query DSL</td><td>SQL</td></tr><tr><td>GET HTTP</td><td>SELECT</td></tr><tr><td>PUT HTTP</td><td>UPDATE</td></tr></tbody></table><h2 id=倒排索引>倒排索引<a href=#倒排索引 class=anchor aria-hidden=true>#</a></h2><p>为了实现倒排索引，Elasticsearch 中的每个文档（document）中不仅保存了其自身数据，还包括了以下内容：</p><ul><li>_id 字段：每个文档在索引中的唯一标识；</li><li>词频 TF：每个 token 在文档中出现的次数，用于相关性评分；</li><li>位置 Position：token 在文档中分词的位置，用于 match_phrase 类型的查询；</li><li>偏移量 Offset：记录 token 开始和结束的位置，实现高亮显示。</li></ul><h3 id=创建倒排索引>创建倒排索引<a href=#创建倒排索引 class=anchor aria-hidden=true>#</a></h3><p>对文档内容进行分词，形成一个个 token（可以理解为单词），保存 token 和文档_id 之间的映射关系。详见 <a href=https://koktlzz.github.io/elastic/elasticsearch/textanalysis>Text Analysis</a>。</p><h3 id=检索倒排索引>检索倒排索引<a href=#检索倒排索引 class=anchor aria-hidden=true>#</a></h3><p>先对检索内容进行分词（适用于 match 查询方法，term/terms 查询不分词），然后在倒排索引中寻找匹配的 token，最后返回 token 对应的文档_id 以及根据文档中 token 匹配情况给出的评分 score。</p><h2 id=建立索引流程>建立索引流程<a href=#建立索引流程 class=anchor aria-hidden=true>#</a></h2><ul><li>在 Elasticsearch 集群中，节点是对等的。节点间会通过自己的一些规则选取集群的 Master，Master 节点会负责集群状态信息的改变，并同步给其他节点。</li><li>建立索引的请求先发送到 Master 节点，Master 建立完索引后，将集群状态同步至 Slave 节点。</li><li>只有建立索引需要经过 Master 节点，而文档可以根据路由规则写入到集群中的任意节点，因此数据的写入压力是分散到整个集群的。</li></ul><h2 id=分片内文档写入流程>分片内文档写入流程<a href=#分片内文档写入流程 class=anchor aria-hidden=true>#</a></h2><p>分片（shard）是 Elasticsearch 的最小工作单元，向单一分片内写入文档的流程如下图所示：</p><p><img src=https://cdn.jsdelivr.net/gh/koktlzz/ImgBed@master/demo.001.png alt=demo.001></p><h3 id=in-memory-buffer>In-memory Buffer<a href=#in-memory-buffer class=anchor aria-hidden=true>#</a></h3><p>在主分片节点上，文档会先被写入到内存（In-memory Buffer）中，此时数据还不能被搜索到。</p><h3 id=refresh>Refresh<a href=#refresh class=anchor aria-hidden=true>#</a></h3><p>经过一段时间（由<code>refresh_interval</code>参数控制）或者内存缓冲满了，Elasticsearch 会将内存中的文档 Refresh 到文件系统缓存（Filesystem Cache）中，并清除内存中的对应文档。</p><h3 id=filesystem-cache>Filesystem Cache<a href=#filesystem-cache class=anchor aria-hidden=true>#</a></h3><p>Lucene 把每次生成的倒排索引，叫做一个段 (Segment)，它无法被修改，只能被合并和删除。另外使用一个 Commit point 文件，记录索引内所有的 Segment。文档在文件系统缓存中被解析为一个个 Segment，同时建立倒排索引。这个时候文档是可以被搜索到的，因此减少了后续写入磁盘的大量时间，体现了 Elasticsearch 搜索的近实时性（下图中的绿色和灰色图标分别代表已写入和未写入磁盘的文档）。</p><p><img src=https://cdn.jsdelivr.net/gh/koktlzz/NoteImg@main/20210120134908.png alt=1></p><p>Segment 会消耗文件句柄、内存和 CPU 资源，并且每次搜索请求都必须轮流检查每一个 Segment。因此随着 Segment 越来越多，将导致查询性能越来越差。这时，ElasticSearch 后台会有一个单独线程专门合并 Segment，将零碎的小的 Segment 合并成一个大的 Segment。</p><p><img src=https://cdn.jsdelivr.net/gh/koktlzz/NoteImg@main/20210120134633.png alt=2>
<img src=https://cdn.jsdelivr.net/gh/koktlzz/NoteImg@main/20210120134642.png alt=3></p><h3 id=flush>Flush<a href=#flush class=anchor aria-hidden=true>#</a></h3><p>执行 Lucene 的 Commit 操作，将 Segment 写入磁盘中。更新 Commit point 文件并删除文档对应的 Translog 文件。</p><h3 id=translog>Translog<a href=#translog class=anchor aria-hidden=true>#</a></h3><p>Elasticsearch 在把数据写入到 Index Buffer 的同时，其实还另外记录了一个 Translog 日志。它是以顺序写文件的形式写入到磁盘中的，速度较快。如果发生异常，Elasticsearch 会从 Commit 位置开始，恢复整个 Translog 文件中的记录，保证数据一致性。</p><h2 id=多个分片的文档写入>多个分片的文档写入<a href=#多个分片的文档写入 class=anchor aria-hidden=true>#</a></h2><p>计算方式：</p><blockquote><p>shard = hash(routing) % number_of_primary_shards</p></blockquote><p>每个文档都有一个 routing 参数，默认情况下就使用其_id 值。将其_id 值计算哈希后，对索引的主分片数取余，就得到了文档实际应该存储到的分片。因此索引的主分片数不可以随意修改，一旦主分片数改变，所有文档的存储位置计算结果都会发生改变，索引数据就完全不可读了。</p><h3 id=同步副本>同步副本<a href=#同步副本 class=anchor aria-hidden=true>#</a></h3><p><img src=https://cdn.jsdelivr.net/gh/koktlzz/NoteImg@main/1611125606(1).jpg alt=1611125606(1)></p><ol><li>客户端请求发送给 Node 1 节点，注意图中 Node 1 是 Master 节点，实际完全可以不是；</li><li>Node 1 用文档的 _id 取余计算得到应该将数据存储到 shard 0 上。通过 Cluster State 信息发现 shard 0 的主分片已经分配到了 Node 3 上。Node 1 转发请求数据给 Node 3；</li><li>Node 3 完成请求数据的索引过程，存入主分片 0。然后并行转发数据给分配有 shard 0 的副本分片的 Node 1 和 Node 2。当收到任一节点汇报副本分片数据写入成功，Node 3 即返回给初始的接收节点 Node 1，宣布数据写入成功。Node 1 返回成功响应给客户端；</li><li>当集群中某个节点宕机，该节点上所有分片中的数据全部丢失（既有主分片，又有副分片）。丢失的副分片对数据的完整性没有影响，丢失的主分片在其他节点上的副分片会被选举成主分片；所以整个索引的数据完整性没有被破坏。</li></ol><p>注：图中 P 代表主分片（Primary Shard），R 代表副本（Replica Shard）。</p><h2 id=根据_id-查询文档>根据_id 查询文档<a href=#根据_id-查询文档 class=anchor aria-hidden=true>#</a></h2><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-http data-lang=http>GET /[index]/_doc/[_id]
</code></pre></div><p><img src=https://cdn.jsdelivr.net/gh/koktlzz/NoteImg@main/20210120150752.png alt=4></p><ol><li>Elasticsearch 集群中的任意节点都可以作为协调（Coordinating）节点接受请求，每个节点都知道集群中任一文档位置；</li><li>协调节点对文档的_id 进行路由，从而判断该数据在哪个 Shard，然后将请求转发给对应的节点，此时会使用随机轮询算法，在 Primary Shard 和 Replica Shard 中随机选择一个，从而对请求负载均衡；</li><li>处理请求的节点返回文档给协调节点；</li><li>协调节点返回文档给客户端。</li></ol><h2 id=根据字段值检索数据>根据字段值检索数据<a href=#根据字段值检索数据 class=anchor aria-hidden=true>#</a></h2><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-http data-lang=http>GET /[index]/_search?q=[field]: [value]
</code></pre></div><p><img src=https://cdn.jsdelivr.net/gh/koktlzz/NoteImg@main/20210120154900.png alt=5></p><ol><li>Elasticsearch 集群中的任意节点都可以作为协调（Coordinating）节点接受请求，每个节点都知道集群中任一文档位置；</li><li>协调节点进行分词等操作后，向所有的 shard 节点发送检索请求；</li><li>ElasticSearch 已建立字段的倒排索引，即可通过字段值检索到所在文档的_id。随后 Shard 将满足条件的数据（_id、排序字段等）信息返回给协调节点；</li><li>协调节点将数据重新进行排序，获取到真正需要返回的文档的_id。协调节点再次向对应的 Shard 发起请求（此时已经有_id 了，可以直接定位到对应的 Shard）;</li><li>Shard 将_id 对应的文档的完整内容返回给协调节点；</li><li>协调节点获取到全部检索结果，返回给客户端。</li></ol><p>上述流程和根据_id 查询文档相比，只是多了一个从倒排索引中根据字段值寻找文档_id 的过程，其中的 4~6 步与其完全相同。</p><p class=edit-page><a href=https://github.com/koktlzz/koktlzz.github.io/blob/master/content/Observability/ElasticStack/ELasticsearchIntro.md><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-edit-2"><path d="M17 3a2.828 2.828.0 114 4L7.5 20.5 2 22l1.5-5.5L17 3z"/></svg>Edit this page on GitHub</a></p><div class="docs-navigation d-flex justify-content-between"><a href=https://koktlzz.github.io/observability/elasticstack/%E5%8D%95%E8%8A%82%E7%82%B9%E9%83%A8%E7%BD%B2%E6%B5%81%E7%A8%8B/><div class="card my-1"><div class="card-body py-2">&larr; 单节点部署流程</div></div></a><a class=ms-auto href=https://koktlzz.github.io/observability/elasticstack/mapping/><div class="card my-1"><div class="card-body py-2">Mapping &rarr;</div></div></a></div><script src=https://utteranc.es/client.js repo=koktlzz/koktlzz.github.io issue-term=pathname theme=photon-dark crossorigin=anonymous async></script></main><nav class="docs-toc d-none d-xl-block col-lg-3 col-xl-2" aria-label="Secondary navigation"><div class=page-links><h3>On this page</h3><nav id=TableOfContents><ul><li><a href=#基本概念与-mysql-的对比>基本概念与 MySQL 的对比</a></li><li><a href=#倒排索引>倒排索引</a><ul><li><a href=#创建倒排索引>创建倒排索引</a></li><li><a href=#检索倒排索引>检索倒排索引</a></li></ul></li><li><a href=#建立索引流程>建立索引流程</a></li><li><a href=#分片内文档写入流程>分片内文档写入流程</a><ul><li><a href=#in-memory-buffer>In-memory Buffer</a></li><li><a href=#refresh>Refresh</a></li><li><a href=#filesystem-cache>Filesystem Cache</a></li><li><a href=#flush>Flush</a></li><li><a href=#translog>Translog</a></li></ul></li><li><a href=#多个分片的文档写入>多个分片的文档写入</a><ul><li><a href=#同步副本>同步副本</a></li></ul></li><li><a href=#根据_id-查询文档>根据_id 查询文档</a></li><li><a href=#根据字段值检索数据>根据字段值检索数据</a></li></ul></nav></div></nav></div></div></div><script src=https://koktlzz.github.io/js/bootstrap.min.d67050adf5d370668aede4201f82af781b16970934804995a1ca37c1ee9222c2fc530972aa6d5d2b6124caf1fe318f139aac99df2c1e89af65504fc1185c7972.js integrity="sha512-1nBQrfXTcGaK7eQgH4KveBsWlwk0gEmVoco3we6SIsL8Uwlyqm1dK2EkyvH+MY8TmqyZ3yweia9lUE/BGFx5cg==" crossorigin=anonymous defer></script><script src=https://koktlzz.github.io/js/vendor/katex/dist/katex.min.b334e5b00c45f572e7f38a543046f36854bf4cbb543880480c09271a0efedc694d6905f719934f6ede2f26f52e80411c05b90121d722cbf8be2fa8fc51bc6b81.js integrity="sha512-szTlsAxF9XLn84pUMEbzaFS/TLtUOIBIDAknGg7+3GlNaQX3GZNPbt4vJvUugEEcBbkBIdciy/i+L6j8UbxrgQ==" crossorigin=anonymous defer></script><script src=https://koktlzz.github.io/js/vendor/katex/dist/contrib/auto-render.min.916823ec103cf367b71e28a6f01513cb9c3ac6708ccb5229402ec46b8e30a8b25003db694df35d80e9dd666a371f327c6152790617b6256390c164109a90bd4c.js integrity="sha512-kWgj7BA882e3Hiim8BUTy5w6xnCMy1IpQC7Ea44wqLJQA9tpTfNdgOndZmo3HzJ8YVJ5Bhe2JWOQwWQQmpC9TA==" crossorigin=anonymous defer></script><script src=https://koktlzz.github.io/main.min.1febbf2f6fd6a36fc2f57dd50d7935fbb640743329baeb4ef7cefcf2e7630e413371fbba976e103656b82808ee227dc4a84237edb0f8433648bef3a56900661a.js integrity="sha512-H+u/L2/Wo2/C9X3VDXk1+7ZAdDMpuutO98788udjDkEzcfu6l24QNla4KAjuIn3EqEI37bD4QzZIvvOlaQBmGg==" crossorigin=anonymous defer></script></body></html>