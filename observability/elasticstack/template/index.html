<!doctype html><html lang=en-us><head><script async src="https://www.googletagmanager.com/gtag/js?id=G-D022F6NT2P"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','G-D022F6NT2P')</script><script>(function(b,d,e,a,g){b[a]=b[a]||[],b[a].push({'gtm.start':(new Date).getTime(),event:'gtm.js'});var f=d.getElementsByTagName(e)[0],c=d.createElement(e),h=a!='dataLayer'?'&l='+a:'';c.async=!0,c.src='https://www.googletagmanager.com/gtm.js?id='+g+h,f.parentNode.insertBefore(c,f)})(window,document,'script','dataLayer','GTM-P72R45W')</script><meta charset=utf-8><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><link rel=preload as=font href=https://koktlzz.github.io/fonts/vendor/jost/jost-v4-latin-regular.woff2 type=font/woff2 crossorigin><link rel=preload as=font href=https://koktlzz.github.io/fonts/vendor/jost/jost-v4-latin-700.woff2 type=font/woff2 crossorigin><link rel=preload as=font href=https://koktlzz.github.io/fonts/KaTeX_Main-Regular.woff2 type=font/woff2 crossorigin><link rel=preload as=font href=https://koktlzz.github.io/fonts/KaTeX_Math-Italic.woff2 type=font/woff2 crossorigin><link rel=stylesheet href=https://koktlzz.github.io/main.27967119d9bfd1f18848f648c47494cdf9c8666df2bb5d54d01736bacd6e74dc5f8b9b2cbc827df0fc8e4cef4f4bae41b13b93c84017caf5272a107d6f2af5cc.css integrity="sha512-J5ZxGdm/0fGISPZIxHSUzfnIZm3yu11U0Bc2us1udNxfi5ssvIJ98PyOTO9PS65BsTuTyEAXyvUnKhB9byr1zA==" crossorigin=anonymous><noscript><style>img.lazyload{display:none}</style></noscript><meta name=robots content="index, follow"><meta name=googlebot content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1"><meta name=bingbot content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1"><title>Template | KnowledgeBase</title><meta name=description content><link rel=canonical href=https://koktlzz.github.io/observability/elasticstack/template/><meta property="og:locale" content="en_US"><meta property="og:type" content="article"><meta property="og:title" content="Template"><meta property="og:description" content="概述   Template（模板）规定了 Elasticsearch 在创建索引时是如何对其进行配置的；
  如果索引与多个索引模板匹配，则使用优先级最高的索引模板。 模板的priority（旧版本中为order) 字段定义了模板的优先级。
  索引在创建时显式声明的配置优先级高于其匹配的模板中的配置。
  分类 模板有两种类型：Index template（索引模板）和 Component templates（组件模板）。
 组件模板是可以重用的构建组件，用于配置索引的 Mappings、Settings 和 Aliases（别名）。 组件模板还可以用来构造索引模板，但它们不会直接应用于一组索引。 索引模板既可以是一个包含组件模板的集合，也可以直接指定索引的 Mappings、Settings 和 Aliases。  应用 首先使用 Elasticsearch API 创建两个组件模板，它们分别对@timestamp和ip_address字段的 Mapping 方式进行了配置：
PUT _component_template/component_template1 { &#34;template&#34;: { &#34;mappings&#34;: { &#34;properties&#34;: { &#34;@timestamp&#34;: { &#34;type&#34;: &#34;date&#34; } } } } } PUT _component_template/other_component_template { &#34;template&#34;: { &#34;mappings&#34;: { &#34;properties&#34;: { &#34;ip_address&#34;: { &#34;type&#34;: &#34;ip&#34; } } } } } 然后我们创建一个索引模板，它是上述两个组件模板的集合，同时还对索引的分片数、别名以及host_name字段的 Mapping 方式进行了相关配置："><meta property="og:url" content="https://koktlzz.github.io/observability/elasticstack/template/"><meta property="og:site_name" content="KnowledgeBase"><meta property="article:published_time" content="2020-11-04T09:19:42+01:00"><meta property="article:modified_time" content="2020-11-04T09:19:42+01:00"><meta property="og:image" content="https://koktlzz.github.io/doks.png"><meta property="og:image:alt" content="KnowledgeBase"><meta name=twitter:card content="summary_large_image"><meta name=twitter:site content="@getdoks"><meta name=twitter:creator content="@henkverlinde"><meta name=twitter:title content="Template"><meta name=twitter:description content><meta name=twitter:image content="https://koktlzz.github.io/doks.png"><meta name=twitter:image:alt content="Template"><script type=application/ld+json>{"@context":"https://schema.org","@graph":[{"@type":"Organization","@id":"https://koktlzz.github.io/#/schema/organization/1","name":"Doks","url":"https://koktlzz.github.io/","sameAs":["https://twitter.com/getdoks","https://github.com/h-enk/doks"],"logo":{"@type":"ImageObject","@id":"https://koktlzz.github.io/#/schema/image/1","url":"https://koktlzz.github.io/logo-doks.png","width":512,"height":512,"caption":"Doks"},"image":{"@id":"https://koktlzz.github.io/#/schema/image/1"}},{"@type":"WebSite","@id":"https://koktlzz.github.io/#/schema/website/1","url":"https://koktlzz.github.io/","name":"KnowledgeBase","description":"","publisher":{"@id":"https://koktlzz.github.io/#/schema/organization/1"}},{"@type":"WebPage","@id":"https://koktlzz.github.io/observability/elasticstack/template/","url":"https://koktlzz.github.io/observability/elasticstack/template/","name":"Template","description":"","isPartOf":{"@id":"https://koktlzz.github.io/#/schema/website/1"},"about":{"@id":"https://koktlzz.github.io/#/schema/organization/1"},"datePublished":"2020-11-04T09:19:42CET","dateModified":"2020-11-04T09:19:42CET","breadcrumb":{"@id":"https://koktlzz.github.io/observability/elasticstack/template/#/schema/breadcrumb/1"},"primaryImageOfPage":{"@id":"https://koktlzz.github.io/observability/elasticstack/template/#/schema/image/2"},"inLanguage":"en-US","potentialAction":[{"@type":"ReadAction","target":["https://koktlzz.github.io/observability/elasticstack/template/"]}]},{"@type":"BreadcrumbList","@id":"https://koktlzz.github.io/observability/elasticstack/template/#/schema/breadcrumb/1","name":"Breadcrumbs","itemListElement":[{"@type":"ListItem","position":1,"item":{"@type":"WebPage","@id":"https://koktlzz.github.io/","url":"https://koktlzz.github.io/","name":"Home"}},{"@type":"ListItem","position":2,"item":{"@type":"WebPage","@id":"https://koktlzz.github.io/observability/","url":"https://koktlzz.github.io/observability/","name":"Observability"}},{"@type":"ListItem","position":3,"item":{"@type":"WebPage","@id":"https://koktlzz.github.io/observability/elasticstack/","url":"https://koktlzz.github.io/observability/elasticstack/","name":"Elasticstack"}},{"@type":"ListItem","position":4,"item":{"@id":"https://koktlzz.github.io/observability/elasticstack/template/"}}]},{"@context":"https://schema.org","@graph":[{"@type":"ImageObject","@id":"https://koktlzz.github.io/observability/elasticstack/template/#/schema/image/2","url":"https://koktlzz.github.io/doks.png","contentUrl":"https://koktlzz.github.io/doks.png","caption":"Template"}]}]}</script><meta name=theme-color content="#fff"><link rel=apple-touch-icon sizes=180x180 href=https://koktlzz.github.io/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=https://koktlzz.github.io/favicon-32x32.ico><link rel=icon type=image/png sizes=16x16 href=https://koktlzz.github.io/favicon-16x16.ico><link rel=manifest crossorigin=use-credentials href=https://koktlzz.github.io/site.webmanifest></head><body class="Observability single dark"><noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-P72R45W" height=0 width=0 style=display:none;visibility:hidden></iframe></noscript><div class="header-bar fixed-top"></div><header class="navbar fixed-top navbar-expand-md navbar-light"><div class=container-fluid><input class="menu-btn order-0" type=checkbox id=menu-btn>
<label class="menu-icon d-md-none" for=menu-btn><span class=navicon></span></label><a class="navbar-brand order-1 order-md-0 me-auto" href=https://koktlzz.github.io/>KnowledgeBase</a>
<button id=mode class="btn btn-link order-2 order-md-4" type=button aria-label="Toggle mode">
<span class=toggle-dark><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-moon"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg></span><span class=toggle-light><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-sun"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></span></button><ul class="navbar-nav social-nav order-3 order-md-5"><li class=nav-item><a class=nav-link href=https://github.com/koktlzz><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-github"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77 5.44 5.44.0 003.5 8.55c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg><span class="ms-2 visually-hidden">GitHub</span></a></li></ul><div class="collapse navbar-collapse order-4 order-md-1"><ul class="navbar-nav main-nav me-auto order-5 order-md-2"><li class=nav-item><a class=nav-link href=https://koktlzz.github.io/container/docker/intro>Container</a></li><li class=nav-item><a class=nav-link href=https://koktlzz.github.io/observability/elasticstack/intro>Observability</a></li><li class=nav-item><a class=nav-link href=https://koktlzz.github.io/programming/go/intro>Programming</a></li><li class=nav-item><a class=nav-link href=https://koktlzz.github.io/infrastructure/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/tcpip%E7%BD%91%E7%BB%9C%E6%A8%A1%E5%9E%8B>Infrastructure</a></li></ul><div class="break order-6 d-md-none"></div></div></div></header><div class="wrap container-fluid" role=document><div class=content><div class="row flex-xl-nowrap"><div class="col-lg-4 col-xl-3 d-none d-xl-block"><nav class=docs-links aria-label="Main navigation"><h3>ElasticStack</h3><ul class=list-unstyled><li><a class=docs-link href=https://koktlzz.github.io/observability/elasticstack/intro/>Getting Started</a></li><li><a class=docs-link href=https://koktlzz.github.io/observability/elasticstack/%E5%8D%95%E8%8A%82%E7%82%B9%E9%83%A8%E7%BD%B2%E6%B5%81%E7%A8%8B/>单节点部署流程</a></li><li><a class=docs-link href=https://koktlzz.github.io/observability/elasticstack/elasticsearchintro/>ElasticSearch 简介</a></li><li><a class=docs-link href=https://koktlzz.github.io/observability/elasticstack/mapping/>Mapping</a></li><li><a class=docs-link href=https://koktlzz.github.io/observability/elasticstack/textanalysis/>Text analysis</a></li><li><a class=docs-link href=https://koktlzz.github.io/observability/elasticstack/template/>Template</a></li><li><a class=docs-link href=https://koktlzz.github.io/observability/elasticstack/ilm/>ILM</a></li><li><a class=docs-link href=https://koktlzz.github.io/observability/elasticstack/snapshot/>Snapshot</a></li><li><a class=docs-link href=https://koktlzz.github.io/observability/elasticstack/%E6%80%A7%E8%83%BD%E8%B0%83%E4%BC%98/>Elasticsearch 性能调优</a></li><li><a class=docs-link href=https://koktlzz.github.io/observability/elasticstack/kafkaintro/>Kafka 简介</a></li><li><a class=docs-link href=https://koktlzz.github.io/observability/elasticstack/hw/>Kafka 副本备份</a></li><li><a class=docs-link href=https://koktlzz.github.io/observability/elasticstack/transaction/>Kafka 事务</a></li></ul><h3>Prometheus</h3><ul class=list-unstyled><li><a class=docs-link href=https://koktlzz.github.io/observability/prometheus/intro/>Getting Started</a></li><li><a class=docs-link href=https://koktlzz.github.io/observability/prometheus/operator%E8%87%AA%E5%AE%9A%E4%B9%89%E9%85%8D%E7%BD%AE/>Operator 自定义配置</a></li></ul><h3>Opentelemetry</h3><ul class=list-unstyled><li><a class=docs-link href=https://koktlzz.github.io/observability/opentelemetry/intro/>Getting Started</a></li><li><a class=docs-link href=https://koktlzz.github.io/observability/opentelemetry/collectorexample/>Collector Example</a></li></ul></nav></div><main class="docs-content col-lg-12 col-xl-10"><h1>Template</h1><p class=lead></p><h2 id=概述>概述<a href=#概述 class=anchor aria-hidden=true>#</a></h2><ul><li><p>Template（模板）规定了 Elasticsearch 在创建索引时是如何对其进行配置的；</p></li><li><p>如果索引与多个索引模板匹配，则使用优先级最高的索引模板。 模板的<code>priority</code>（旧版本中为<code>order</code>) 字段定义了模板的优先级。</p></li><li><p>索引在创建时显式声明的配置优先级高于其匹配的模板中的配置。</p></li></ul><h2 id=分类>分类<a href=#分类 class=anchor aria-hidden=true>#</a></h2><p>模板有两种类型：Index template（索引模板）和 Component templates（组件模板）。</p><ul><li>组件模板是可以重用的构建组件，用于配置索引的 Mappings、Settings 和 Aliases（别名）。 组件模板还可以用来构造索引模板，但它们不会直接应用于一组索引。</li><li>索引模板既可以是一个包含组件模板的集合，也可以直接指定索引的 Mappings、Settings 和 Aliases。</li></ul><h2 id=应用>应用<a href=#应用 class=anchor aria-hidden=true>#</a></h2><p>首先使用 Elasticsearch API 创建两个组件模板，它们分别对<code>@timestamp</code>和<code>ip_address</code>字段的 Mapping 方式进行了配置：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json>PUT _component_template/component_template<span style=color:#bd93f9>1</span>   
{
  <span style=color:#ff79c6>&#34;template&#34;</span>: {
    <span style=color:#ff79c6>&#34;mappings&#34;</span>: {
      <span style=color:#ff79c6>&#34;properties&#34;</span>: {
        <span style=color:#ff79c6>&#34;@timestamp&#34;</span>: {
          <span style=color:#ff79c6>&#34;type&#34;</span>: <span style=color:#f1fa8c>&#34;date&#34;</span>
        }
      }
    }
  }
}

PUT _component_template/other_component_template
{
  <span style=color:#ff79c6>&#34;template&#34;</span>: {
    <span style=color:#ff79c6>&#34;mappings&#34;</span>: {
      <span style=color:#ff79c6>&#34;properties&#34;</span>: {
        <span style=color:#ff79c6>&#34;ip_address&#34;</span>: {
          <span style=color:#ff79c6>&#34;type&#34;</span>: <span style=color:#f1fa8c>&#34;ip&#34;</span>
        }
      }
    }
  }
}
</code></pre></div><p>然后我们创建一个索引模板，它是上述两个组件模板的集合，同时还对索引的分片数、别名以及<code>host_name</code>字段的 Mapping 方式进行了相关配置：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json>PUT _index_template/template_<span style=color:#bd93f9>1</span>
{
  <span style=color:#ff79c6>&#34;index_patterns&#34;</span>: [<span style=color:#f1fa8c>&#34;te*&#34;</span>, <span style=color:#f1fa8c>&#34;bar*&#34;</span>],       // 索引名称开头为 te 和 bar 的索引将会匹配该模板
  <span style=color:#ff79c6>&#34;template&#34;</span>: {
    <span style=color:#ff79c6>&#34;settings&#34;</span>: {
      <span style=color:#ff79c6>&#34;number_of_shards&#34;</span>: <span style=color:#bd93f9>1</span>
    },
    <span style=color:#ff79c6>&#34;mappings&#34;</span>: {
      <span style=color:#ff79c6>&#34;properties&#34;</span>: {
        <span style=color:#ff79c6>&#34;host_name&#34;</span>: {
          <span style=color:#ff79c6>&#34;type&#34;</span>: <span style=color:#f1fa8c>&#34;keyword&#34;</span>
        }
    },
    <span style=color:#ff79c6>&#34;aliases&#34;</span>: {
      <span style=color:#ff79c6>&#34;mydata&#34;</span>: { }
    }
  },
  <span style=color:#ff79c6>&#34;priority&#34;</span>: <span style=color:#bd93f9>200</span>,
  <span style=color:#ff79c6>&#34;composed_of&#34;</span>: [<span style=color:#f1fa8c>&#34;component_template1&#34;</span>, <span style=color:#f1fa8c>&#34;other_component_template&#34;</span>],
  <span style=color:#ff79c6>&#34;version&#34;</span>: <span style=color:#bd93f9>3</span>,
  <span style=color:#ff79c6>&#34;_meta&#34;</span>: {
    <span style=color:#ff79c6>&#34;description&#34;</span>: <span style=color:#f1fa8c>&#34;my custom&#34;</span>
  }
}
</code></pre></div><h2 id=测试>测试<a href=#测试 class=anchor aria-hidden=true>#</a></h2><p>simulation API 可以帮助我们测试索引模板的应用效果，主要有以下几种方式：</p><p>测试索引模板对某一类样式索引的配置效果。例如我们之前创建的索引模板 template_1 ，其<code>index_patterns</code>参数为<code>["te*", "bar*"]</code>，那么便可以使用这种方式来测试其对名称开头为"te"的索引的配置效果（索引 te-01 并不存在）：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json>POST /_index_template/_simulate_index/te<span style=color:#bd93f9>-000001</span>
</code></pre></div><p>测试一个现有模板（template_1）的配置效果：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json>POST /_index_template/_simulate/template_<span style=color:#bd93f9>1</span>
</code></pre></div><p>为了保证创建的索引模板符合预期，我们还可以模拟定义一个索引模板：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json>POST /_index_template/_simulate
{
  <span style=color:#ff79c6>&#34;index_patterns&#34;</span>: [<span style=color:#f1fa8c>&#34;te*&#34;</span>],
  <span style=color:#ff79c6>&#34;template&#34;</span>: {
    <span style=color:#ff79c6>&#34;settings&#34;</span> : {
        <span style=color:#ff79c6>&#34;index.number_of_shards&#34;</span> : <span style=color:#bd93f9>3</span>
    }
  },
  <span style=color:#ff79c6>&#34;composed_of&#34;</span>: [<span style=color:#f1fa8c>&#34;component_template1&#34;</span>, <span style=color:#f1fa8c>&#34;other_component_template&#34;</span>]
}
</code></pre></div><p>返回结果：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json>{
  <span style=color:#ff79c6>&#34;template&#34;</span> : {
    <span style=color:#ff79c6>&#34;settings&#34;</span> : {
      <span style=color:#ff79c6>&#34;index&#34;</span> : {
        <span style=color:#ff79c6>&#34;number_of_shards&#34;</span> : <span style=color:#f1fa8c>&#34;3&#34;</span>    // 模板创建时显式声明的配置优先级高于组件模板中的配置
      }
    },
    <span style=color:#ff79c6>&#34;mappings&#34;</span> : {                  // 继承自组件模板
      <span style=color:#ff79c6>&#34;properties&#34;</span> : {   
        <span style=color:#ff79c6>&#34;@timestamp&#34;</span> : {
          <span style=color:#ff79c6>&#34;type&#34;</span> : <span style=color:#f1fa8c>&#34;date&#34;</span>
        },
        <span style=color:#ff79c6>&#34;ip_address&#34;</span> : {
          <span style=color:#ff79c6>&#34;type&#34;</span> : <span style=color:#f1fa8c>&#34;ip&#34;</span>
        }
      }
    },
    <span style=color:#ff79c6>&#34;aliases&#34;</span> : { }
  },
  <span style=color:#ff79c6>&#34;overlapping&#34;</span> : [
    {
      <span style=color:#ff79c6>&#34;name&#34;</span> : <span style=color:#f1fa8c>&#34;template_1&#34;</span>,
      <span style=color:#ff79c6>&#34;index_patterns&#34;</span> : [
        <span style=color:#f1fa8c>&#34;bar*&#34;</span>,
        <span style=color:#f1fa8c>&#34;te*&#34;</span>
      ]
    }
  ]
}
</code></pre></div><p>我们预创建的索引模板匹配了名称开头为 te 的索引，而已存在的模板 template_1 也与之匹配，因此返回结果中出现了 overlapping 的相关信息。在模拟中，其他重叠模板的 priority 要低于预创建的索引模板。</p><h2 id=生效>生效<a href=#生效 class=anchor aria-hidden=true>#</a></h2><p>首先创建一个新索引 index-001:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json>POST index<span style=color:#bd93f9>-001</span>/_doc
{
  <span style=color:#ff79c6>&#34;ip&#34;</span>: <span style=color:#f1fa8c>&#34;10.122.70.86&#34;</span>
}
</code></pre></div><p>然后发现该索引的分片数和副本数都为默认值 1，而<code>ip</code>字段被映射为了 text 类型：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json>GET index<span style=color:#bd93f9>-001</span>
// 返回
{
  <span style=color:#ff79c6>&#34;index-001&#34;</span> : {
    <span style=color:#ff79c6>&#34;aliases&#34;</span> : { },
    <span style=color:#ff79c6>&#34;mappings&#34;</span> : {
      <span style=color:#ff79c6>&#34;properties&#34;</span> : {
        <span style=color:#ff79c6>&#34;ip&#34;</span> : {
          <span style=color:#ff79c6>&#34;type&#34;</span> : <span style=color:#f1fa8c>&#34;text&#34;</span>,
          <span style=color:#ff79c6>&#34;fields&#34;</span> : {
            <span style=color:#ff79c6>&#34;keyword&#34;</span> : {
              <span style=color:#ff79c6>&#34;type&#34;</span> : <span style=color:#f1fa8c>&#34;keyword&#34;</span>,
              <span style=color:#ff79c6>&#34;ignore_above&#34;</span> : <span style=color:#bd93f9>256</span>
            }
          }
        }
      }
    },
    <span style=color:#ff79c6>&#34;settings&#34;</span> : {
        <span style=color:#ff79c6>&#34;number_of_shards&#34;</span> : <span style=color:#f1fa8c>&#34;1&#34;</span>,
        <span style=color:#ff79c6>&#34;number_of_replicas&#34;</span> : <span style=color:#f1fa8c>&#34;1&#34;</span>,
        ...
      }
    }
  }
}
</code></pre></div><p>接下来我们创建一个索引模板 my-template，与名称以"index-&ldquo;开头的索引关联：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json>PUT _index_template/my-template
{
  <span style=color:#ff79c6>&#34;index_patterns&#34;</span>: [<span style=color:#f1fa8c>&#34;index-*&#34;</span>],
  <span style=color:#ff79c6>&#34;template&#34;</span>: {
    <span style=color:#ff79c6>&#34;settings&#34;</span>: {
      <span style=color:#ff79c6>&#34;number_of_replicas&#34;</span>: <span style=color:#bd93f9>3</span>
    },
    <span style=color:#ff79c6>&#34;mappings&#34;</span>: {
      <span style=color:#ff79c6>&#34;properties&#34;</span>: {
        <span style=color:#ff79c6>&#34;ip&#34;</span>: {
          <span style=color:#ff79c6>&#34;type&#34;</span>: <span style=color:#f1fa8c>&#34;ip&#34;</span>
        }
      }
    }
  }
}
</code></pre></div><p>再次查看 index-001，发现其副本数和<code>ip</code>字段的类型都没有改变，这说明新创建的索引模板对已存在的索引无效。而如果再创建一个新索引 index-002：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json>POST index<span style=color:#bd93f9>-002</span>/_doc
{
  <span style=color:#ff79c6>&#34;ip&#34;</span>: <span style=color:#f1fa8c>&#34;10.122.70.89&#34;</span>
}
</code></pre></div><p>则会发现该索引自动与模板 my-template 关联，副本数为 3，<code>ip</code>字段也映射为了 ip 类型：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json>GET index<span style=color:#bd93f9>-002</span>
// 返回
{
  <span style=color:#ff79c6>&#34;index-002&#34;</span> : {
    <span style=color:#ff79c6>&#34;mappings&#34;</span> : {
      <span style=color:#ff79c6>&#34;properties&#34;</span> : {
        <span style=color:#ff79c6>&#34;ip&#34;</span> : {
          <span style=color:#ff79c6>&#34;type&#34;</span> : <span style=color:#f1fa8c>&#34;ip&#34;</span>
        }
      }
    },
    <span style=color:#ff79c6>&#34;settings&#34;</span> : {
        <span style=color:#ff79c6>&#34;number_of_shards&#34;</span> : <span style=color:#f1fa8c>&#34;1&#34;</span>,
        <span style=color:#ff79c6>&#34;number_of_replicas&#34;</span> : <span style=color:#f1fa8c>&#34;3&#34;</span>,
        ...
        }
      }
    }
  }
}
</code></pre></div><p>如果想要修改已存在的索引配置，需要通过更新其 settings 的方式：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json>PUT /index-*/_settings
{
  <span style=color:#ff79c6>&#34;index&#34;</span> : {
    <span style=color:#ff79c6>&#34;number_of_replicas&#34;</span> : <span style=color:#bd93f9>2</span>
  }
}
</code></pre></div><p>查看 index-001 和 index-002，可以发现两个索引的副本数都变成了 2。以 index-001 为例：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json>GET index<span style=color:#bd93f9>-001</span>
// 返回
{
  <span style=color:#ff79c6>&#34;index-001&#34;</span> : {
    <span style=color:#ff79c6>&#34;mappings&#34;</span> : {
      <span style=color:#ff79c6>&#34;properties&#34;</span> : {
        <span style=color:#ff79c6>&#34;ip&#34;</span> : {
          <span style=color:#ff79c6>&#34;type&#34;</span> : <span style=color:#f1fa8c>&#34;text&#34;</span>,
          <span style=color:#ff79c6>&#34;fields&#34;</span> : {
            <span style=color:#ff79c6>&#34;keyword&#34;</span> : {
              <span style=color:#ff79c6>&#34;type&#34;</span> : <span style=color:#f1fa8c>&#34;keyword&#34;</span>,
              <span style=color:#ff79c6>&#34;ignore_above&#34;</span> : <span style=color:#bd93f9>256</span>
            }
          }
        }
      }
    },
    <span style=color:#ff79c6>&#34;settings&#34;</span> : {
        <span style=color:#ff79c6>&#34;number_of_shards&#34;</span> : <span style=color:#f1fa8c>&#34;1&#34;</span>,
        <span style=color:#ff79c6>&#34;number_of_replicas&#34;</span> : <span style=color:#f1fa8c>&#34;2&#34;</span>,
        ...
      }
    }
  }
}
</code></pre></div><p class=edit-page><a href=https://github.com/koktlzz/koktlzz.github.io/blob/master/content/Observability/ElasticStack/Template.md><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-edit-2"><path d="M17 3a2.828 2.828.0 114 4L7.5 20.5 2 22l1.5-5.5L17 3z"/></svg>Edit this page on GitHub</a></p><div class="docs-navigation d-flex justify-content-between"><a href=https://koktlzz.github.io/observability/elasticstack/textanalysis/><div class="card my-1"><div class="card-body py-2">&larr; Text analysis</div></div></a><a class=ms-auto href=https://koktlzz.github.io/observability/elasticstack/ilm/><div class="card my-1"><div class="card-body py-2">ILM &rarr;</div></div></a></div><script src=https://utteranc.es/client.js repo=koktlzz/koktlzz.github.io issue-term=pathname theme=photon-dark crossorigin=anonymous async></script></main><nav class="docs-toc d-none d-xl-block col-lg-3 col-xl-2" aria-label="Secondary navigation"><div class=page-links><h3>On this page</h3><nav id=TableOfContents><ul><li><a href=#概述>概述</a></li><li><a href=#分类>分类</a></li><li><a href=#应用>应用</a></li><li><a href=#测试>测试</a></li><li><a href=#生效>生效</a></li></ul></nav></div></nav></div></div></div><script src=https://koktlzz.github.io/js/bootstrap.min.d67050adf5d370668aede4201f82af781b16970934804995a1ca37c1ee9222c2fc530972aa6d5d2b6124caf1fe318f139aac99df2c1e89af65504fc1185c7972.js integrity="sha512-1nBQrfXTcGaK7eQgH4KveBsWlwk0gEmVoco3we6SIsL8Uwlyqm1dK2EkyvH+MY8TmqyZ3yweia9lUE/BGFx5cg==" crossorigin=anonymous defer></script><script src=https://koktlzz.github.io/js/vendor/katex/dist/katex.min.b334e5b00c45f572e7f38a543046f36854bf4cbb543880480c09271a0efedc694d6905f719934f6ede2f26f52e80411c05b90121d722cbf8be2fa8fc51bc6b81.js integrity="sha512-szTlsAxF9XLn84pUMEbzaFS/TLtUOIBIDAknGg7+3GlNaQX3GZNPbt4vJvUugEEcBbkBIdciy/i+L6j8UbxrgQ==" crossorigin=anonymous defer></script><script src=https://koktlzz.github.io/js/vendor/katex/dist/contrib/auto-render.min.916823ec103cf367b71e28a6f01513cb9c3ac6708ccb5229402ec46b8e30a8b25003db694df35d80e9dd666a371f327c6152790617b6256390c164109a90bd4c.js integrity="sha512-kWgj7BA882e3Hiim8BUTy5w6xnCMy1IpQC7Ea44wqLJQA9tpTfNdgOndZmo3HzJ8YVJ5Bhe2JWOQwWQQmpC9TA==" crossorigin=anonymous defer></script><script src=https://koktlzz.github.io/main.min.1febbf2f6fd6a36fc2f57dd50d7935fbb640743329baeb4ef7cefcf2e7630e413371fbba976e103656b82808ee227dc4a84237edb0f8433648bef3a56900661a.js integrity="sha512-H+u/L2/Wo2/C9X3VDXk1+7ZAdDMpuutO98788udjDkEzcfu6l24QNla4KAjuIn3EqEI37bD4QzZIvvOlaQBmGg==" crossorigin=anonymous defer></script></body></html>