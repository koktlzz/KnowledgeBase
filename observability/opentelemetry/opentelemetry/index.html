<!doctype html><html lang=en-us><head><script async src="https://www.googletagmanager.com/gtag/js?id=G-D022F6NT2P"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','G-D022F6NT2P')</script><script>(function(b,d,e,a,g){b[a]=b[a]||[],b[a].push({'gtm.start':(new Date).getTime(),event:'gtm.js'});var f=d.getElementsByTagName(e)[0],c=d.createElement(e),h=a!='dataLayer'?'&l='+a:'';c.async=!0,c.src='https://www.googletagmanager.com/gtm.js?id='+g+h,f.parentNode.insertBefore(c,f)})(window,document,'script','dataLayer','GTM-P72R45W')</script><meta charset=utf-8><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><link rel=preload as=font href=https://koktlzz.github.io/fonts/vendor/jost/jost-v4-latin-regular.woff2 type=font/woff2 crossorigin><link rel=preload as=font href=https://koktlzz.github.io/fonts/vendor/jost/jost-v4-latin-700.woff2 type=font/woff2 crossorigin><link rel=preload as=font href=https://koktlzz.github.io/fonts/KaTeX_Main-Regular.woff2 type=font/woff2 crossorigin><link rel=preload as=font href=https://koktlzz.github.io/fonts/KaTeX_Math-Italic.woff2 type=font/woff2 crossorigin><link rel=stylesheet href=https://koktlzz.github.io/main.0ae7165cfeda76c765ab05aa408a696be65779f1e277afd078efecc543cc00bb72be873f087e148ccf7ac1016b22c2d2586f058c7ee5d92dcca60206eae2dd99.css integrity="sha512-CucWXP7adsdlqwWqQIppa+ZXefHid6/QeO/sxUPMALtyvoc/CH4UjM96wQFrIsLSWG8FjH7l2S3MpgIG6uLdmQ==" crossorigin=anonymous><noscript><style>img.lazyload{display:none}</style></noscript><meta name=robots content="index, follow"><meta name=googlebot content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1"><meta name=bingbot content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1"><title>Collector Example | Inspire Hub</title><meta name=description content><link rel=canonical href=https://koktlzz.github.io/observability/opentelemetry/opentelemetry/><meta property="og:locale" content="en_US"><meta property="og:type" content="article"><meta property="og:title" content="Collector Example"><meta property="og:description" content="环境准备 使用 Sealos 安装 Kubernetes 集群，至少需要三个 Master 节点 和 一个 Node 节点：
   Role Hostname IP     master1 koktlzz-k8s-01 10.122.70.135   master2 koktlzz-k8s-02 10.122.70.84   master3 koktlzz-k8s-03 10.122.70.113   node1 koktlzz-k8s-04 10.122.70.68    在安装前需要保证节点间时间同步，本例中使用 Chronyd 来实现。我们将 master1 作为 Chronyd Server，需要在/etc/chrony.conf文件中添加如下内容：
local stratum 10 ：即使 Server 无法从互联网同步时间，也同步本机时间至 Client allow all ：允许所有主机从 Server 同步时间 其他三台 Client 机器需要在/etc/chrony.conf文件中注释掉默认的 Server 配置，并指定 master1 作为自己的 Chronyd Server："><meta property="og:url" content="https://koktlzz.github.io/observability/opentelemetry/opentelemetry/"><meta property="og:site_name" content="Inspire Hub"><meta property="article:published_time" content="2020-11-04T09:19:42+01:00"><meta property="article:modified_time" content="2020-11-04T09:19:42+01:00"><meta property="og:image" content="https://koktlzz.github.io/doks.png"><meta property="og:image:alt" content="Inspire Hub"><meta name=twitter:card content="summary_large_image"><meta name=twitter:site content="@getdoks"><meta name=twitter:creator content="@henkverlinde"><meta name=twitter:title content="Collector Example"><meta name=twitter:description content><meta name=twitter:image content="https://koktlzz.github.io/doks.png"><meta name=twitter:image:alt content="Collector Example"><script type=application/ld+json>{"@context":"https://schema.org","@graph":[{"@type":"Organization","@id":"https://koktlzz.github.io/#/schema/organization/1","name":"Doks","url":"https://koktlzz.github.io/","sameAs":["https://twitter.com/getdoks","https://github.com/h-enk/doks"],"logo":{"@type":"ImageObject","@id":"https://koktlzz.github.io/#/schema/image/1","url":"https://koktlzz.github.io/logo-doks.png","width":512,"height":512,"caption":"Doks"},"image":{"@id":"https://koktlzz.github.io/#/schema/image/1"}},{"@type":"WebSite","@id":"https://koktlzz.github.io/#/schema/website/1","url":"https://koktlzz.github.io/","name":"Inspire Hub","description":"","publisher":{"@id":"https://koktlzz.github.io/#/schema/organization/1"}},{"@type":"WebPage","@id":"https://koktlzz.github.io/observability/opentelemetry/opentelemetry/","url":"https://koktlzz.github.io/observability/opentelemetry/opentelemetry/","name":"Collector Example","description":"","isPartOf":{"@id":"https://koktlzz.github.io/#/schema/website/1"},"about":{"@id":"https://koktlzz.github.io/#/schema/organization/1"},"datePublished":"2020-11-04T09:19:42CET","dateModified":"2020-11-04T09:19:42CET","breadcrumb":{"@id":"https://koktlzz.github.io/observability/opentelemetry/opentelemetry/#/schema/breadcrumb/1"},"primaryImageOfPage":{"@id":"https://koktlzz.github.io/observability/opentelemetry/opentelemetry/#/schema/image/2"},"inLanguage":"en-US","potentialAction":[{"@type":"ReadAction","target":["https://koktlzz.github.io/observability/opentelemetry/opentelemetry/"]}]},{"@type":"BreadcrumbList","@id":"https://koktlzz.github.io/observability/opentelemetry/opentelemetry/#/schema/breadcrumb/1","name":"Breadcrumbs","itemListElement":[{"@type":"ListItem","position":1,"item":{"@type":"WebPage","@id":"https://koktlzz.github.io/","url":"https://koktlzz.github.io/","name":"Home"}},{"@type":"ListItem","position":2,"item":{"@type":"WebPage","@id":"https://koktlzz.github.io/observability/","url":"https://koktlzz.github.io/observability/","name":"Observability"}},{"@type":"ListItem","position":3,"item":{"@type":"WebPage","@id":"https://koktlzz.github.io/observability/opentelemetry/","url":"https://koktlzz.github.io/observability/opentelemetry/","name":"Opentelemetry"}},{"@type":"ListItem","position":4,"item":{"@id":"https://koktlzz.github.io/observability/opentelemetry/opentelemetry/"}}]},{"@context":"https://schema.org","@graph":[{"@type":"ImageObject","@id":"https://koktlzz.github.io/observability/opentelemetry/opentelemetry/#/schema/image/2","url":"https://koktlzz.github.io/doks.png","contentUrl":"https://koktlzz.github.io/doks.png","caption":"Collector Example"}]}]}</script><meta name=theme-color content="#fff"><link rel=apple-touch-icon sizes=180x180 href=https://koktlzz.github.io/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=https://koktlzz.github.io/favicon-32x32.ico><link rel=icon type=image/png sizes=16x16 href=https://koktlzz.github.io/favicon-16x16.ico><link rel=manifest crossorigin=use-credentials href=https://koktlzz.github.io/site.webmanifest></head><body class="Observability single dark"><noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-P72R45W" height=0 width=0 style=display:none;visibility:hidden></iframe></noscript><div class="header-bar fixed-top"></div><header class="navbar fixed-top navbar-expand-md navbar-light"><div class=container-fluid><input class="menu-btn order-0" type=checkbox id=menu-btn>
<label class="menu-icon d-md-none" for=menu-btn><span class=navicon></span></label><a class="navbar-brand order-1 order-md-0 me-auto" href=https://koktlzz.github.io/>Inspire Hub</a>
<button id=mode class="btn btn-link order-2 order-md-4" type=button aria-label="Toggle mode">
<span class=toggle-dark><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-moon"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg></span><span class=toggle-light><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-sun"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></span></button><ul class="navbar-nav social-nav order-3 order-md-5"><li class=nav-item><a class=nav-link href=https://github.com/koktlzz><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-github"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77 5.44 5.44.0 003.5 8.55c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg><span class="ms-2 visually-hidden">GitHub</span></a></li></ul><div class="collapse navbar-collapse order-4 order-md-1"><ul class="navbar-nav main-nav me-auto order-5 order-md-2"><li class=nav-item><a class=nav-link href=https://koktlzz.github.io/container/docker/intro>Container</a></li><li class=nav-item><a class=nav-link href=https://koktlzz.github.io/observability/elasticstack/intro>Observability</a></li><li class=nav-item><a class=nav-link href=https://koktlzz.github.io/programming/go/intro>Programming</a></li><li class=nav-item><a class=nav-link href=https://koktlzz.github.io/infrastructure/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/tcpip%E7%BD%91%E7%BB%9C%E6%A8%A1%E5%9E%8B>Infrastructure</a></li></ul><div class="break order-6 d-md-none"></div></div></div></header><div class="wrap container-fluid" role=document><div class=content><div class="row flex-xl-nowrap"><div class="col-lg-3 col-xl-2 d-none d-xl-block"><nav class=docs-links aria-label="Main navigation"><h3>ElasticStack</h3><ul class=list-unstyled><li><a class=docs-link href=https://koktlzz.github.io/observability/elasticstack/intro/>Getting Started</a></li><li><a class=docs-link href=https://koktlzz.github.io/observability/elasticstack/%E5%8D%95%E8%8A%82%E7%82%B9%E9%83%A8%E7%BD%B2%E6%B5%81%E7%A8%8B/>单节点部署流程</a></li><li><a class=docs-link href=https://koktlzz.github.io/observability/elasticstack/elasticsearchintro/>ElasticSearch 简介</a></li><li><a class=docs-link href=https://koktlzz.github.io/observability/elasticstack/mapping/>Mapping</a></li><li><a class=docs-link href=https://koktlzz.github.io/observability/elasticstack/textanalysis/>Text analysis</a></li><li><a class=docs-link href=https://koktlzz.github.io/observability/elasticstack/template/>Template</a></li><li><a class=docs-link href=https://koktlzz.github.io/observability/elasticstack/ilm/>ILM</a></li><li><a class=docs-link href=https://koktlzz.github.io/observability/elasticstack/snapshot/>Snapshot</a></li><li><a class=docs-link href=https://koktlzz.github.io/observability/elasticstack/%E6%80%A7%E8%83%BD%E8%B0%83%E4%BC%98/>ES 性能调优</a></li><li><a class=docs-link href=https://koktlzz.github.io/observability/elasticstack/kafkaintro/>Kafka 简介</a></li><li><a class=docs-link href=https://koktlzz.github.io/observability/elasticstack/hw/>Kafka 副本备份</a></li><li><a class=docs-link href=https://koktlzz.github.io/observability/elasticstack/transaction/>Kafka 事务</a></li></ul><h3>Prometheus</h3><ul class=list-unstyled><li><a class=docs-link href=https://koktlzz.github.io/observability/prometheus/intro/>Getting Started</a></li><li><a class=docs-link href=https://koktlzz.github.io/observability/prometheus/operator%E8%87%AA%E5%AE%9A%E4%B9%89%E9%85%8D%E7%BD%AE/>Operator 自定义配置</a></li></ul><h3>Opentelemetry</h3><ul class=list-unstyled><li><a class=docs-link href=https://koktlzz.github.io/observability/opentelemetry/intro/>Getting Started</a></li><li><a class=docs-link href=https://koktlzz.github.io/observability/opentelemetry/opentelemetry/>Collector Example</a></li></ul></nav></div><main class="docs-content col-lg-13 col-xl-11"><h1>Collector Example</h1><p class=lead></p><h2 id=环境准备>环境准备<a href=#环境准备 class=anchor aria-hidden=true>#</a></h2><p>使用 <a href=https://github.com/fanux/sealos>Sealos</a> 安装 Kubernetes 集群，至少需要三个 Master 节点 和 一个 Node 节点：</p><table><thead><tr><th>Role</th><th>Hostname</th><th>IP</th></tr></thead><tbody><tr><td>master1</td><td>koktlzz-k8s-01</td><td>10.122.70.135</td></tr><tr><td>master2</td><td>koktlzz-k8s-02</td><td>10.122.70.84</td></tr><tr><td>master3</td><td>koktlzz-k8s-03</td><td>10.122.70.113</td></tr><tr><td>node1</td><td>koktlzz-k8s-04</td><td>10.122.70.68</td></tr></tbody></table><p>在安装前需要保证节点间时间同步，本例中使用 Chronyd 来实现。我们将 master1 作为 Chronyd Server，需要在<code>/etc/chrony.conf</code>文件中添加如下内容：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=color:#8be9fd;font-style:italic>local</span> stratum <span style=color:#bd93f9>10</span>    ：即使 Server 无法从互联网同步时间，也同步本机时间至 Client
allow all           ：允许所有主机从 Server 同步时间
</code></pre></div><p>其他三台 Client 机器需要在<code>/etc/chrony.conf</code>文件中注释掉默认的 Server 配置，并指定 master1 作为自己的 Chronyd Server：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>server 10.122.70.135 iburst
</code></pre></div><p>重启各台机器的 Chronyd 服务后，我们可以查看节点间的时间同步情况：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=color:#ff79c6>[</span>root@koktlzz-k8s-01 ~<span style=color:#ff79c6>]</span><span style=color:#6272a4># chronyc activity</span>
<span style=color:#bd93f9>200</span> OK
<span style=color:#bd93f9>4</span> sources online
<span style=color:#bd93f9>0</span> sources offline
<span style=color:#bd93f9>0</span> sources doing burst <span style=color:#ff79c6>(</span><span style=color:#ff79c6>return</span> to online<span style=color:#ff79c6>)</span>
<span style=color:#bd93f9>0</span> sources doing burst <span style=color:#ff79c6>(</span><span style=color:#ff79c6>return</span> to offline<span style=color:#ff79c6>)</span>
<span style=color:#bd93f9>0</span> sources with unknown address
<span style=color:#ff79c6>[</span>root@koktlzz-k8s-01 ~<span style=color:#ff79c6>]</span><span style=color:#6272a4># chronyc tracking</span>
Reference ID    : <span style=color:#bd93f9>70414589</span> <span style=color:#ff79c6>(</span>112.65.69.137<span style=color:#ff79c6>)</span>
Stratum         : <span style=color:#bd93f9>3</span>
Ref <span style=color:#8be9fd;font-style:italic>time</span> <span style=color:#ff79c6>(</span>UTC<span style=color:#ff79c6>)</span>  : Fri Sep <span style=color:#bd93f9>17</span> 01:53:34 <span style=color:#bd93f9>2021</span>
System <span style=color:#8be9fd;font-style:italic>time</span>     : 0.000236189 seconds fast of NTP <span style=color:#8be9fd;font-style:italic>time</span>
Last offset     : +0.000164347 seconds
RMS offset      : 0.000131223 seconds
Frequency       : 14.670 ppm slow
Residual freq   : +0.002 ppm
Skew            : 0.053 ppm
Root delay      : 0.008919094 seconds
Root dispersion : 0.028753694 seconds
Update interval : 1028.6 seconds
Leap status     : Normal
</code></pre></div><p>确认安装环境符合 <a href=https://github.com/fanux/sealos#%E8%A6%81%E6%B1%82%E5%92%8C%E5%BB%BA%E8%AE%AE>要求</a> 后，我们便可以开始安装集群：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=color:#6272a4># 下载并安装 sealos, sealos 是个 golang 的二进制工具，直接下载拷贝到 bin 目录即可，release 页面也可下载</span>
$ wget -c https://sealyun.oss-cn-beijing.aliyuncs.com/latest/sealos <span style=color:#ff79c6>&amp;&amp;</span> <span style=color:#f1fa8c>\
</span><span style=color:#f1fa8c></span>    chmod +x sealos <span style=color:#ff79c6>&amp;&amp;</span> mv sealos /usr/bin 

<span style=color:#6272a4># 下载离线资源包</span>
$ wget -c https://sealyun.oss-cn-beijing.aliyuncs.com/05a3db657821277f5f3b92d834bbaf98-v1.22.0/kube1.22.0.tar.gz

<span style=color:#6272a4># 安装一个三 master 的 kubernetes 集群</span>
$ sealos init --passwd <span style=color:#f1fa8c>&#39;******&#39;</span> <span style=color:#f1fa8c>\
</span><span style=color:#f1fa8c></span>    --master 10.122.70.135  --master 10.122.70.84  --master 10.122.70.113  <span style=color:#f1fa8c>\
</span><span style=color:#f1fa8c></span>    --node 10.122.70.68 <span style=color:#f1fa8c>\
</span><span style=color:#f1fa8c></span>    --pkg-url /root/kube1.22.0.tar.gz <span style=color:#f1fa8c>\
</span><span style=color:#f1fa8c></span>    --version v1.22.0
</code></pre></div><p>Sealos 还支持部分组件的自定义安装、Pod CIDR 配置以及增删节点等操作，详见 <a href=https://www.sealyun.com/instructions>官方文档</a>。</p><h2 id=镜像仓库>镜像仓库<a href=#镜像仓库 class=anchor aria-hidden=true>#</a></h2><p>在 Sealos 的离线安装包中已经包含了基础镜像，但缺少 Prometheus、Jaeger 和 Dashboard 等应用镜像。为了方便部署，我们在 node1 上搭建一个镜像仓库，此处使用 Docker Registry：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>docker run -d -p 5000:5000 --name<span style=color:#ff79c6>=</span>registry --restart<span style=color:#ff79c6>=</span>always --privileged<span style=color:#ff79c6>=</span><span style=color:#8be9fd;font-style:italic>true</span> --log-driver<span style=color:#ff79c6>=</span>none -v /data/registry:/tmp/registry registry
</code></pre></div><p>以上传 jaeger-operator 镜像为例，镜像仓库地址为：<a href=http://10.122.70.68:5000/>10.122.70.68:5000</a>：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=color:#6272a4># 导入镜像</span>
docker load &lt; jaeger-operator.tar
<span style=color:#6272a4># 更改镜像 tag</span>
docker tag docker.io/jaegertracing/jaeger-operator:1.25.0 10.122.70.68:5000/jaegertracing/jaeger-operator:1.25.0
<span style=color:#6272a4># 配置 insecure 镜像仓库地址</span>
cat <span style=color:#f1fa8c>&lt;&lt; EOF &gt; /etc/docker/daemon.json
</span><span style=color:#f1fa8c>&gt; {&#34;insecure-registries&#34;:[&#34;10.122.70.68:5000&#34;]}
</span><span style=color:#f1fa8c>&gt; EOF</span>
<span style=color:#6272a4># 上传镜像</span>
docker push 10.122.70.68:5000/jaegertracing/jaeger-operator:1.25.0
</code></pre></div><p>浏览器访问 <a href=http://10.122.70.68:5000/v2/_catalog>10.122.70.68:5000/v2/catalog</a> 即可看到上传成功的所有镜像。如果想要删除已上传的镜像，可以进入 Registry 容器进行操作：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>docker <span style=color:#8be9fd;font-style:italic>exec</span> registry  rm -rf /var/lib/registry/docker/registry/v2/repositories/&lt;镜像名&gt;
docker <span style=color:#8be9fd;font-style:italic>exec</span> registry bin/registry garbage-collect /etc/docker/registry/config.yml
</code></pre></div><p>由于我们搭建的镜像仓库是非安全（insecure）的，因此集群中的应用想要拉取其中的镜像，还需要对默认的容器运行时 Containerd 进行相关配置，否则会触发报错：<code>http: server gave HTTP response to HTTPS client</code>。</p><p>首先生成 containerd 的默认配置文件：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>mkdir /etc/containerd
containerd config default &gt; /etc/containerd/config.toml
</code></pre></div><p>然后修改<code>config.toml</code>文件中的 Registry 部分：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-toml data-lang=toml>[plugins.<span style=color:#f1fa8c>&#34;io.containerd.grpc.v1.cri&#34;</span>.registry]
  [plugins.<span style=color:#f1fa8c>&#34;io.containerd.grpc.v1.cri&#34;</span>.registry.mirrors]
    [plugins.<span style=color:#f1fa8c>&#34;io.containerd.grpc.v1.cri&#34;</span>.registry.mirrors.<span style=color:#f1fa8c>&#34;10.122.70.68:5000&#34;</span>]
      endpoint = [<span style=color:#f1fa8c>&#34;http://10.122.70.68:5000&#34;</span>]
</code></pre></div><p>最后重启 containerd 服务，可使用<code>containerd config dump</code>来确认配置修改是否生效。</p><h2 id=prometheus-no-otel-target>Prometheus no otel target<a href=#prometheus-no-otel-target class=anchor aria-hidden=true>#</a></h2><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=color:#8be9fd;font-style:italic>level</span><span style=color:#ff79c6>=</span>error <span style=color:#8be9fd;font-style:italic>ts</span><span style=color:#ff79c6>=</span>2021-09-08T08:21:41.327Z <span style=color:#8be9fd;font-style:italic>caller</span><span style=color:#ff79c6>=</span>klog.go:116 <span style=color:#8be9fd;font-style:italic>component</span><span style=color:#ff79c6>=</span>k8s_client_runtime <span style=color:#8be9fd;font-style:italic>func</span><span style=color:#ff79c6>=</span>ErrorDepth <span style=color:#8be9fd;font-style:italic>msg</span><span style=color:#ff79c6>=</span><span style=color:#f1fa8c>&#34;pkg/mod/k8s.io/client-go@v0.21.3/tools/cache/reflector.go:167: Failed to watch *v1.Pod: failed to list *v1.Pod: pods is forbidden: User \&#34;system:serviceaccount:monitoring:prometheus-k8s\&#34; cannot list resource \&#34;pods\&#34; in API group \&#34;\&#34; in the namespace \&#34;observability\&#34;&#34;</span>
</code></pre></div><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#ff79c6>kind</span>: ClusterRole
<span style=color:#ff79c6>apiVersion</span>: rbac.authorization.k8s.io/v1
<span style=color:#ff79c6>metadata</span>:
  <span style=color:#ff79c6>name</span>: prometheus-k8s
  <span style=color:#ff79c6>namespace</span>: monitoring
<span style=color:#ff79c6>rules</span>:
- <span style=color:#ff79c6>apiGroups</span>: [<span style=color:#f1fa8c>&#34;&#34;</span>]
  <span style=color:#ff79c6>resources</span>: [<span style=color:#f1fa8c>&#34;services&#34;</span>,<span style=color:#f1fa8c>&#34;pods&#34;</span>,<span style=color:#f1fa8c>&#34;endpoints&#34;</span>,<span style=color:#f1fa8c>&#34;nodes/metrics&#34;</span>]
  <span style=color:#ff79c6>verbs</span>: [<span style=color:#f1fa8c>&#34;get&#34;</span>, <span style=color:#f1fa8c>&#34;watch&#34;</span>, <span style=color:#f1fa8c>&#34;list&#34;</span>]
- <span style=color:#ff79c6>apiGroups</span>: [<span style=color:#f1fa8c>&#34;extensions&#34;</span>]
  <span style=color:#ff79c6>resources</span>: [<span style=color:#f1fa8c>&#34;ingresses&#34;</span>]
  <span style=color:#ff79c6>verbs</span>: [<span style=color:#f1fa8c>&#34;get&#34;</span>, <span style=color:#f1fa8c>&#34;watch&#34;</span>, <span style=color:#f1fa8c>&#34;list&#34;</span>]
- <span style=color:#ff79c6>nonResourceURLs</span>: [<span style=color:#f1fa8c>&#34;/metrics&#34;</span>]
  <span style=color:#ff79c6>verbs</span>: [<span style=color:#f1fa8c>&#34;get&#34;</span>, <span style=color:#f1fa8c>&#34;watch&#34;</span>, <span style=color:#f1fa8c>&#34;list&#34;</span>]
</code></pre></div><h2 id=参考文献>参考文献<a href=#参考文献 class=anchor aria-hidden=true>#</a></h2><p><a href=https://github.com/fanux/sealos>fanux/sealos</a></p><p><a href=https://github.com/containerd/cri/issues/1367>insecure local registry gives &ldquo;http: server gave HTTP response to HTTPS client&rdquo;</a></p><p><a href=https://fuckcloudnative.io/posts/getting-started-with-containerd/>Containerd 使用教程 – 云原生实验室</a></p><p><a href=https://www.cnblogs.com/charlieroro/p/13883602.html>Opentelemetry Collector的配置和使用</a></p><p><a href=https://github.com/open-telemetry/opentelemetry-go/tree/main/example/otel-collector>opentelemetry-go/example/otel-collector</a></p><p class=edit-page><a href=https://github.com/koktlzz/koktlzz.github.io/blob/master/content/Observability/Opentelemetry/Opentelemetry.md><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-edit-2"><path d="M17 3a2.828 2.828.0 114 4L7.5 20.5 2 22l1.5-5.5L17 3z"/></svg>Edit this page on GitHub</a></p><div class="docs-navigation d-flex justify-content-between"><a href=https://koktlzz.github.io/observability/opentelemetry/intro/><div class="card my-1"><div class="card-body py-2">&larr; Getting Started</div></div></a></div><script src=https://utteranc.es/client.js repo=koktlzz/koktlzz.github.io issue-term=pathname theme=photon-dark crossorigin=anonymous async></script></main><nav class="docs-toc d-none d-xl-block col-lg-3 col-xl-2" aria-label="Secondary navigation"><div class=page-links><h3>On this page</h3><nav id=TableOfContents><ul><li><a href=#环境准备>环境准备</a></li><li><a href=#镜像仓库>镜像仓库</a></li><li><a href=#prometheus-no-otel-target>Prometheus no otel target</a></li><li><a href=#参考文献>参考文献</a></li></ul></nav></div></nav></div></div></div><footer class="footer text-muted"><div class=container><div class=row><div class="col-lg-8 order-last order-lg-first"><ul class=list-inline><li class=list-inline-item></li></ul></div><div class="col-lg-8 order-first order-lg-last text-lg-end"><ul class=list-inline></ul></div></div></div></footer><script src=https://koktlzz.github.io/js/bootstrap.min.d67050adf5d370668aede4201f82af781b16970934804995a1ca37c1ee9222c2fc530972aa6d5d2b6124caf1fe318f139aac99df2c1e89af65504fc1185c7972.js integrity="sha512-1nBQrfXTcGaK7eQgH4KveBsWlwk0gEmVoco3we6SIsL8Uwlyqm1dK2EkyvH+MY8TmqyZ3yweia9lUE/BGFx5cg==" crossorigin=anonymous defer></script><script src=https://koktlzz.github.io/js/vendor/katex/dist/katex.min.b334e5b00c45f572e7f38a543046f36854bf4cbb543880480c09271a0efedc694d6905f719934f6ede2f26f52e80411c05b90121d722cbf8be2fa8fc51bc6b81.js integrity="sha512-szTlsAxF9XLn84pUMEbzaFS/TLtUOIBIDAknGg7+3GlNaQX3GZNPbt4vJvUugEEcBbkBIdciy/i+L6j8UbxrgQ==" crossorigin=anonymous defer></script><script src=https://koktlzz.github.io/js/vendor/katex/dist/contrib/auto-render.min.916823ec103cf367b71e28a6f01513cb9c3ac6708ccb5229402ec46b8e30a8b25003db694df35d80e9dd666a371f327c6152790617b6256390c164109a90bd4c.js integrity="sha512-kWgj7BA882e3Hiim8BUTy5w6xnCMy1IpQC7Ea44wqLJQA9tpTfNdgOndZmo3HzJ8YVJ5Bhe2JWOQwWQQmpC9TA==" crossorigin=anonymous defer></script><script src=https://koktlzz.github.io/main.min.1febbf2f6fd6a36fc2f57dd50d7935fbb640743329baeb4ef7cefcf2e7630e413371fbba976e103656b82808ee227dc4a84237edb0f8433648bef3a56900661a.js integrity="sha512-H+u/L2/Wo2/C9X3VDXk1+7ZAdDMpuutO98788udjDkEzcfu6l24QNla4KAjuIn3EqEI37bD4QzZIvvOlaQBmGg==" crossorigin=anonymous defer></script></body></html>