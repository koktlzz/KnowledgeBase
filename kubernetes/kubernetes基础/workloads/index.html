<!doctype html><html lang=en-us><head><script async src="https://www.googletagmanager.com/gtag/js?id=G-D022F6NT2P"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','G-D022F6NT2P')</script><script>(function(b,d,e,a,g){b[a]=b[a]||[],b[a].push({'gtm.start':(new Date).getTime(),event:'gtm.js'});var f=d.getElementsByTagName(e)[0],c=d.createElement(e),h=a!='dataLayer'?'&l='+a:'';c.async=!0,c.src='https://www.googletagmanager.com/gtm.js?id='+g+h,f.parentNode.insertBefore(c,f)})(window,document,'script','dataLayer','GTM-P72R45W')</script><meta charset=utf-8><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><link rel=preload as=font href=https://koktlzz.github.io/fonts/vendor/jost/jost-v4-latin-regular.woff2 type=font/woff2 crossorigin><link rel=preload as=font href=https://koktlzz.github.io/fonts/vendor/jost/jost-v4-latin-700.woff2 type=font/woff2 crossorigin><link rel=preload as=font href=https://koktlzz.github.io/fonts/KaTeX_Main-Regular.woff2 type=font/woff2 crossorigin><link rel=preload as=font href=https://koktlzz.github.io/fonts/KaTeX_Math-Italic.woff2 type=font/woff2 crossorigin><link rel=stylesheet href=https://koktlzz.github.io/main.6fd70af9369bef8ad98be8ac549b09d4cc31a7751f59f66dd296a20fd0fa4ae07ec51aee16a7e125439572da86f49095224d7d27d5f3dab10a0fa43783ecd2e2.css integrity="sha512-b9cK+Tab74rZi+isVJsJ1Mwxp3UfWfZt0paiD9D6SuB+xRruFqfhJUOVctqG9JCVIk19J9Xz2rEKD6Q3g+zS4g==" crossorigin=anonymous><noscript><style>img.lazyload{display:none}</style></noscript><meta name=robots content="index, follow"><meta name=googlebot content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1"><meta name=bingbot content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1"><title>Workloads | Inspire Hub</title><meta name=description content><link rel=canonical href=https://koktlzz.github.io/kubernetes/kubernetes%E5%9F%BA%E7%A1%80/workloads/><meta property="og:locale" content="en_US"><meta property="og:type" content="article"><meta property="og:title" content="Workloads"><meta property="og:description" content="简介 Workloads（工作负载）资源是 Kubernetes 上运行的应用程序，可以用来创建和管理多个 Pod，提供副本管理、健康检查、滚动升级和集群级别的自愈能力。例如，如果一个节点故障，Workloads 配置的 Controller 就能自动将该节点上的 Pod 调度到其他健康的节点上。Workloads Controller 运行在 Kubernetes 集群的主节点上，它们不断控制集群中的资源向期望状态迁移（stauts -> spec）。常用的 Workloads 资源有：
ReplicaSet 决定一个 Pod 有多少同时运行的副本，并保证这些副本的期望状态与当前状态一致。
配置 一个典型的 ReplicaSet 配置如下：
apiVersion: apps/v1 kind: ReplicaSet metadata: name: frontend labels: app: guestbook tier: frontend spec: replicas: 3 # 副本数 selector: matchLabels: tier: frontend template: metadata: labels: tier: frontend spec: containers: - name: php-redis image: docker.io/redis:latest  在上述配置信息中，字段spec.template.metadata.labels的值必须与spec.selector值相匹配，否则创建请求会被 Kubernetes API 拒绝； 被 ReplicaSet 控制的 Pod 在创建或更新后，其metadata.ownerReferences字段会添加该 ReplicaSet 的信息； 一旦删除了原来的 ReplicaSet，就可以创建一个新的来替换它。只要新旧 ReplicaSet 的spec."><meta property="og:url" content="https://koktlzz.github.io/kubernetes/kubernetes%E5%9F%BA%E7%A1%80/workloads/"><meta property="og:site_name" content="Inspire Hub"><meta property="article:published_time" content="2020-11-04T09:19:42+01:00"><meta property="article:modified_time" content="2020-11-04T09:19:42+01:00"><meta property="og:image" content="https://koktlzz.github.io/doks.png"><meta property="og:image:alt" content="Inspire Hub"><meta name=twitter:card content="summary_large_image"><meta name=twitter:site content="@getdoks"><meta name=twitter:creator content="@henkverlinde"><meta name=twitter:title content="Workloads"><meta name=twitter:description content><meta name=twitter:image content="https://koktlzz.github.io/doks.png"><meta name=twitter:image:alt content="Workloads"><script type=application/ld+json>{"@context":"https://schema.org","@graph":[{"@type":"Organization","@id":"https://koktlzz.github.io/#/schema/organization/1","name":"Doks","url":"https://koktlzz.github.io/","sameAs":["https://twitter.com/getdoks","https://github.com/h-enk/doks"],"logo":{"@type":"ImageObject","@id":"https://koktlzz.github.io/#/schema/image/1","url":"https://koktlzz.github.io/logo-doks.png","width":512,"height":512,"caption":"Doks"},"image":{"@id":"https://koktlzz.github.io/#/schema/image/1"}},{"@type":"WebSite","@id":"https://koktlzz.github.io/#/schema/website/1","url":"https://koktlzz.github.io/","name":"Inspire Hub","description":"","publisher":{"@id":"https://koktlzz.github.io/#/schema/organization/1"}},{"@type":"WebPage","@id":"https://koktlzz.github.io/kubernetes/kubernetes%E5%9F%BA%E7%A1%80/workloads/","url":"https://koktlzz.github.io/kubernetes/kubernetes%E5%9F%BA%E7%A1%80/workloads/","name":"Workloads","description":"","isPartOf":{"@id":"https://koktlzz.github.io/#/schema/website/1"},"about":{"@id":"https://koktlzz.github.io/#/schema/organization/1"},"datePublished":"2020-11-04T09:19:42CET","dateModified":"2020-11-04T09:19:42CET","breadcrumb":{"@id":"https://koktlzz.github.io/kubernetes/kubernetes%E5%9F%BA%E7%A1%80/workloads/#/schema/breadcrumb/1"},"primaryImageOfPage":{"@id":"https://koktlzz.github.io/kubernetes/kubernetes%E5%9F%BA%E7%A1%80/workloads/#/schema/image/2"},"inLanguage":"en-US","potentialAction":[{"@type":"ReadAction","target":["https://koktlzz.github.io/kubernetes/kubernetes%E5%9F%BA%E7%A1%80/workloads/"]}]},{"@type":"BreadcrumbList","@id":"https://koktlzz.github.io/kubernetes/kubernetes%E5%9F%BA%E7%A1%80/workloads/#/schema/breadcrumb/1","name":"Breadcrumbs","itemListElement":[{"@type":"ListItem","position":1,"item":{"@type":"WebPage","@id":"https://koktlzz.github.io/","url":"https://koktlzz.github.io/","name":"Home"}},{"@type":"ListItem","position":2,"item":{"@type":"WebPage","@id":"https://koktlzz.github.io/kubernetes/","url":"https://koktlzz.github.io/kubernetes/","name":"Kubernetes"}},{"@type":"ListItem","position":3,"item":{"@type":"WebPage","@id":"https://koktlzz.github.io/kubernetes/kubernetes%E5%9F%BA%E7%A1%80/","url":"https://koktlzz.github.io/kubernetes/kubernetes%E5%9F%BA%E7%A1%80/","name":"Kubernetes% E5%9 F% Ba% E7% A1%80"}},{"@type":"ListItem","position":4,"item":{"@id":"https://koktlzz.github.io/kubernetes/kubernetes%E5%9F%BA%E7%A1%80/workloads/"}}]},{"@context":"https://schema.org","@graph":[{"@type":"ImageObject","@id":"https://koktlzz.github.io/kubernetes/kubernetes%E5%9F%BA%E7%A1%80/workloads/#/schema/image/2","url":"https://koktlzz.github.io/doks.png","contentUrl":"https://koktlzz.github.io/doks.png","caption":"Workloads"}]}]}</script><meta name=theme-color content="#fff"><link rel=apple-touch-icon sizes=180x180 href=https://koktlzz.github.io/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=https://koktlzz.github.io/favicon-32x32.ico><link rel=icon type=image/png sizes=16x16 href=https://koktlzz.github.io/favicon-16x16.ico><link rel=manifest crossorigin=use-credentials href=https://koktlzz.github.io/site.webmanifest></head><body class="Kubernetes single"><noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-P72R45W" height=0 width=0 style=display:none;visibility:hidden></iframe></noscript><div class="header-bar fixed-top"></div><header class="navbar fixed-top navbar-expand-md navbar-light"><div class=container-fluid><input class="menu-btn order-0" type=checkbox id=menu-btn>
<label class="menu-icon d-md-none" for=menu-btn><span class=navicon></span></label><a class="navbar-brand order-1 order-md-0 me-auto" href=https://koktlzz.github.io/>Inspire Hub</a>
<button id=mode class="btn btn-link order-2 order-md-4" type=button aria-label="Toggle mode">
<span class=toggle-dark><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-moon"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg></span><span class=toggle-light><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-sun"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></span></button><ul class="navbar-nav social-nav order-3 order-md-5"><li class=nav-item><a class=nav-link href=https://github.com/koktlzz><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-github"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77 5.44 5.44.0 003.5 8.55c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg><span class="ms-2 visually-hidden">GitHub</span></a></li></ul><div class="collapse navbar-collapse order-4 order-md-1"><ul class="navbar-nav main-nav me-auto order-5 order-md-2"><li class=nav-item><a class=nav-link href=https://koktlzz.github.io/docker/docker%E5%9F%BA%E7%A1%80/intro>Docker</a></li><li class=nav-item><a class=nav-link href=https://koktlzz.github.io/kubernetes/kubernetes%E5%9F%BA%E7%A1%80/intro>Kubernetes</a></li><li class=nav-item><a class=nav-link href=https://koktlzz.github.io/elastic/elasticstack/intro>Elastic</a></li><li class=nav-item><a class=nav-link href=https://koktlzz.github.io/go/go%E5%9F%BA%E7%A1%80/intro>Go</a></li><li class=nav-item><a class=nav-link href=https://koktlzz.github.io/infra/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80/tcpip%E7%BD%91%E7%BB%9C%E6%A8%A1%E5%9E%8B>Infra</a></li></ul><div class="break order-6 d-md-none"></div><form class="navbar-form flex-grow-1 order-7 order-md-3"><input id=userinput class="form-control is-search" type=search placeholder="Search docs..." aria-label="Search docs..." autocomplete=off><div id=suggestions class="shadow bg-white rounded"></div></form></div></div></header><div class="wrap container-fluid" role=document><div class=content><div class="row flex-xl-nowrap"><div class="col-lg-3 col-xl-2 d-none d-xl-block"><nav class=docs-links aria-label="Main navigation"><h3>Kubernetes 基础</h3><ul class=list-unstyled><li><a class=docs-link href=https://koktlzz.github.io/kubernetes/kubernetes%E5%9F%BA%E7%A1%80/intro/>Get Started</a></li><li><a class=docs-link href=https://koktlzz.github.io/kubernetes/kubernetes%E5%9F%BA%E7%A1%80/infrastructure/>Infrastructure</a></li><li><a class=docs-link href=https://koktlzz.github.io/kubernetes/kubernetes%E5%9F%BA%E7%A1%80/pod%E4%B8%8Enamespace/>Pod 与 Namespace</a></li><li><a class=docs-link href=https://koktlzz.github.io/kubernetes/kubernetes%E5%9F%BA%E7%A1%80/service/>Service</a></li><li><a class=docs-link href=https://koktlzz.github.io/kubernetes/kubernetes%E5%9F%BA%E7%A1%80/volume/>Volume</a></li><li><a class=docs-link href=https://koktlzz.github.io/kubernetes/kubernetes%E5%9F%BA%E7%A1%80/workloads/>Workloads</a></li></ul><h3>Kubernetes 进阶</h3><ul class=list-unstyled><li><a class=docs-link href=https://koktlzz.github.io/kubernetes/kubernetes%E8%BF%9B%E9%98%B6/networkpolicy/>Network Policy</a></li><li><a class=docs-link href=https://koktlzz.github.io/kubernetes/kubernetes%E8%BF%9B%E9%98%B6/ingress/>Ingress</a></li><li><a class=docs-link href=https://koktlzz.github.io/kubernetes/kubernetes%E8%BF%9B%E9%98%B6/sdn/>SDN</a></li><li><a class=docs-link href=https://koktlzz.github.io/kubernetes/kubernetes%E8%BF%9B%E9%98%B6/openvswitch/>Open vSwitch</a></li></ul></nav></div><main class="docs-content col-lg-13 col-xl-11"><h1>Workloads</h1><p class=lead></p><h2 id=简介>简介<a href=#简介 class=anchor aria-hidden=true>#</a></h2><p>Workloads（工作负载）资源是 Kubernetes 上运行的应用程序，可以用来创建和管理多个 Pod，提供副本管理、健康检查、滚动升级和集群级别的自愈能力。例如，如果一个节点故障，Workloads 配置的 Controller 就能自动将该节点上的 Pod 调度到其他健康的节点上。Workloads Controller 运行在 Kubernetes 集群的主节点上，它们不断控制集群中的资源向期望状态迁移（stauts -> spec）。常用的 Workloads 资源有：</p><p><img src=https://cdn.jsdelivr.net/gh/koktlzz/ImgBed@master/20210313161059.png alt=20210313161059></p><h2 id=replicaset>ReplicaSet<a href=#replicaset class=anchor aria-hidden=true>#</a></h2><p>决定一个 Pod 有多少同时运行的副本，并保证这些副本的期望状态与当前状态一致。</p><h3 id=配置>配置<a href=#配置 class=anchor aria-hidden=true>#</a></h3><p>一个典型的 ReplicaSet 配置如下：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#ff79c6>apiVersion</span>: apps/v1
<span style=color:#ff79c6>kind</span>: ReplicaSet
<span style=color:#ff79c6>metadata</span>:
  <span style=color:#ff79c6>name</span>: frontend
  <span style=color:#ff79c6>labels</span>:
    <span style=color:#ff79c6>app</span>: guestbook
    <span style=color:#ff79c6>tier</span>: frontend
<span style=color:#ff79c6>spec</span>:
  <span style=color:#ff79c6>replicas</span>: <span style=color:#bd93f9>3</span>            <span style=color:#6272a4># 副本数</span>
  <span style=color:#ff79c6>selector</span>: 
    <span style=color:#ff79c6>matchLabels</span>:
      <span style=color:#ff79c6>tier</span>: frontend
  <span style=color:#ff79c6>template</span>:
    <span style=color:#ff79c6>metadata</span>:
      <span style=color:#ff79c6>labels</span>:
        <span style=color:#ff79c6>tier</span>: frontend
    <span style=color:#ff79c6>spec</span>:
      <span style=color:#ff79c6>containers</span>:
      - <span style=color:#ff79c6>name</span>: php-redis
        <span style=color:#ff79c6>image</span>: docker.io/redis:latest
</code></pre></div><ul><li>在上述配置信息中，字段<code>spec.template.metadata.labels</code>的值必须与<code>spec.selector</code>值相匹配，否则创建请求会被 Kubernetes API 拒绝；</li><li>被 ReplicaSet 控制的 Pod 在创建或更新后，其<code>metadata.ownerReferences</code>字段会添加该 ReplicaSet 的信息；</li><li>一旦删除了原来的 ReplicaSet，就可以创建一个新的来替换它。只要新旧 ReplicaSet 的<code>spec.selector</code>字段是相同的，新的 ReplicaSet 便会接管原有的 Pod。然而，修改 ReplicaSet 中的 template 并不会使其接管的 Pod 的 Spec 更新。</li></ul><h3 id=应用场景>应用场景<a href=#应用场景 class=anchor aria-hidden=true>#</a></h3><ul><li>重调度：保证指定数量的 Pod 正常运行；</li><li>弹性伸缩：修改<code>spec.replicas</code>字段，实现 Pod 数量弹性伸缩；</li><li>应用多版本追踪：修改<code>spec.selector</code>字段，实现对一个 Pod 的多版本管理。</li></ul><p>由于 ReplicaSet 并不支持使用命令 <strong>kubectl roll-update</strong> 对 Pod 进行滚动更新，因此若想要以可控的方式更新 Pod，建议使用 Deployment。</p><h2 id=deployment>Deployment<a href=#deployment class=anchor aria-hidden=true>#</a></h2><p>Deployment 为 Pod 和 ReplicaSet 提供声明式的更新能力，用于管理无状态的应用。</p><h3 id=配置-1>配置<a href=#配置-1 class=anchor aria-hidden=true>#</a></h3><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#ff79c6>apiVersion</span>: apps/v1
<span style=color:#ff79c6>kind</span>: Deployment
<span style=color:#ff79c6>metadata</span>:
  <span style=color:#ff79c6>name</span>: nginx-deployment
  <span style=color:#ff79c6>labels</span>:
    <span style=color:#ff79c6>app</span>: nginx
<span style=color:#ff79c6>spec</span>:
  <span style=color:#ff79c6>replicas</span>: <span style=color:#bd93f9>3</span>
  <span style=color:#ff79c6>selector</span>:
    <span style=color:#ff79c6>matchLabels</span>:
      <span style=color:#ff79c6>app</span>: nginx
  <span style=color:#ff79c6>template</span>:
    <span style=color:#ff79c6>metadata</span>:
      <span style=color:#ff79c6>labels</span>:
        <span style=color:#ff79c6>app</span>: nginx
    <span style=color:#ff79c6>spec</span>:
      <span style=color:#ff79c6>containers</span>:
      - <span style=color:#ff79c6>name</span>: nginx
        <span style=color:#ff79c6>image</span>: docker.io/nginx:latest
        <span style=color:#ff79c6>ports</span>:
        - <span style=color:#ff79c6>containerPort</span>: <span style=color:#bd93f9>80</span>
</code></pre></div><ul><li><code>.spec.selector</code>字段必须匹配<code>.spec.template.metadata.labels</code>，否则请求会被 Kubernetes API 拒绝；</li><li>当 Pod 的标签和 Deployment 的标签选择器匹配，但其模板和<code>.spec.template</code>不同，或者此类 Pod 的总数超过<code>.spec.replicas</code>的设置时，Deployment 会将其终止；</li><li>如果 Pod 的总数未达到期望值，Deployment 会基于<code>.spec.template</code>创建新的 Pod。</li></ul><h3 id=创建>创建<a href=#创建 class=anchor aria-hidden=true>#</a></h3><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#ff79c6>[</span>root@test-master1 ~<span style=color:#ff79c6>]</span><span style=color:#6272a4># kubectl create -f test.yml --record</span>
deployment.apps/nginx-deployment created
<span style=color:#ff79c6>[</span>root@test-master1 ~<span style=color:#ff79c6>]</span><span style=color:#6272a4># kubectl get deployment</span>
NAME               DESIRED   CURRENT   UP-TO-DATE   AVAILABLE   AGE
nginx-deployment   <span style=color:#bd93f9>3</span>         <span style=color:#bd93f9>3</span>         <span style=color:#bd93f9>3</span>            <span style=color:#bd93f9>3</span>           9s
</code></pre></div><p>查看上线状态</p><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#ff79c6>[</span>root@test-master1 ~<span style=color:#ff79c6>]</span><span style=color:#6272a4># kubectl rollout status deployment.v1.apps/nginx-deployment</span>
deployment <span style=color:#f1fa8c>&#34;nginx-deployment&#34;</span> successfully rolled out
<span style=color:#ff79c6>[</span>root@test-master1 ~<span style=color:#ff79c6>]</span><span style=color:#6272a4># kubectl get pods --show-labels</span>
NAME                                READY     STATUS    RESTARTS   AGE       LABELS
nginx-deployment-5cbbd6c556-gj4vp   1/1       Running   <span style=color:#bd93f9>0</span>          4m        <span style=color:#8be9fd;font-style:italic>app</span><span style=color:#ff79c6>=</span>nginx,pod-template-hash<span style=color:#ff79c6>=</span><span style=color:#bd93f9>1766827112</span>
nginx-deployment-5cbbd6c556-vk4vl   1/1       Running   <span style=color:#bd93f9>0</span>          4m        <span style=color:#8be9fd;font-style:italic>app</span><span style=color:#ff79c6>=</span>nginx,pod-template-hash<span style=color:#ff79c6>=</span><span style=color:#bd93f9>1766827112</span>
nginx-deployment-5cbbd6c556-z24z8   1/1       Running   <span style=color:#bd93f9>0</span>          4m        <span style=color:#8be9fd;font-style:italic>app</span><span style=color:#ff79c6>=</span>nginx,pod-template-hash<span style=color:#ff79c6>=</span><span style=color:#bd93f9>1766827112</span>
<span style=color:#ff79c6>[</span>root@test-master1 ~<span style=color:#ff79c6>]</span><span style=color:#6272a4># kubectl get rs</span>
NAME                          DESIRED   CURRENT   READY     AGE
nginx-deployment-5cbbd6c556   <span style=color:#bd93f9>3</span>         <span style=color:#bd93f9>3</span>         <span style=color:#bd93f9>3</span>         2d
</code></pre></div><p>查看详细信息</p><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#ff79c6>[</span>root@test-master1 ~<span style=color:#ff79c6>]</span><span style=color:#6272a4># kubectl describe rs nginx-deployment-5cbbd6c556</span>
Name:           nginx-deployment-5cbbd6c556
Namespace:      gwr
Selector:       <span style=color:#8be9fd;font-style:italic>app</span><span style=color:#ff79c6>=</span>nginx,pod-template-hash<span style=color:#ff79c6>=</span><span style=color:#bd93f9>1766827112</span>
Labels:         <span style=color:#8be9fd;font-style:italic>app</span><span style=color:#ff79c6>=</span>nginx
                pod-template-hash<span style=color:#ff79c6>=</span><span style=color:#bd93f9>1766827112</span>
...
</code></pre></div><p>其中一些参数的含义：</p><ul><li>NAME：列出了集群中 Deployment 的名称；</li><li>READY：应用程序的可用的副本数，显示的格式是“就绪个数/期望个数”；</li><li>UP-TO-DATE：为了达到期望状态已经更新的副本数；</li><li>AVAILABLE：显示应用可供用户使用的副本数；</li><li>AGE：显示应用程序运行的时间。</li></ul><p>我们可以发现 ReplicaSet 被命名为 Deployment 名称加一个数字的格式（nginx-deployment-5cbbd6c556），这个数字是使用 Pod 标签中<code>pod-template-hash</code>字段作为种子随机生成的。而此标签字段是通过对 Pod 的 template 进行哈希处理得到的，可确保 Deployment 管理的 ReplicaSet 不重叠。</p><h3 id=更新>更新<a href=#更新 class=anchor aria-hidden=true>#</a></h3><p>使用 <strong>kubectl edit deployment &lt;deployment-name></strong> 命令，可直接对 Deployment 管理的 Pod 进行更新。当使用 <strong>kubectl describe deployments</strong> 命令查看更新信息时，可以在 Events 下看到更新的过程：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>Events:
    Type    Reason             Age   From                   Message
    ----    ------             ----  ----                   -------
    Normal  ScalingReplicaSet  2m    deployment-controller  Scaled up replica <span style=color:#8be9fd;font-style:italic>set</span> nginx-deployment-2035384211 to <span style=color:#bd93f9>3</span>
    Normal  ScalingReplicaSet  24s   deployment-controller  Scaled up replica <span style=color:#8be9fd;font-style:italic>set</span> nginx-deployment-1564180365 to <span style=color:#bd93f9>1</span>
    Normal  ScalingReplicaSet  22s   deployment-controller  Scaled down replica <span style=color:#8be9fd;font-style:italic>set</span> nginx-deployment-2035384211 to <span style=color:#bd93f9>2</span>
    Normal  ScalingReplicaSet  22s   deployment-controller  Scaled up replica <span style=color:#8be9fd;font-style:italic>set</span> nginx-deployment-1564180365 to <span style=color:#bd93f9>2</span>
    Normal  ScalingReplicaSet  19s   deployment-controller  Scaled down replica <span style=color:#8be9fd;font-style:italic>set</span> nginx-deployment-2035384211 to <span style=color:#bd93f9>1</span>
    Normal  ScalingReplicaSet  19s   deployment-controller  Scaled up replica <span style=color:#8be9fd;font-style:italic>set</span> nginx-deployment-1564180365 to <span style=color:#bd93f9>3</span>
    Normal  ScalingReplicaSet  14s   deployment-controller  Scaled down replica <span style=color:#8be9fd;font-style:italic>set</span> nginx-deployment-2035384211 to <span style=color:#bd93f9>0</span>
</code></pre></div><ul><li>当第一次创建 Deployment 时，它自动创建了一个 ReplicaSet（nginx-deployment-2035384211）并将其管理的 Pod 扩容至 3 个副本；</li><li>更新 Deployment 时，它又创建了一个新的 ReplicaSet（nginx-deployment-1564180365），并将其管理的 Pod 数量设置为 1，然后将旧 ReplicaSet 管理的 Pod 缩容到 2，以便至少有 2 个 Pod 可用且最多创建 4 个 Pod；</li><li>然后，它使用相同的滚动更新策略继续对新的 ReplicaSet 扩容并对旧的 ReplicaSet 缩容；</li><li>最终，新 ReplicaSet 管理的 Pod 副本数扩容至 3 个，旧 ReplicaSet 管理的 Pod 全部终止，更新完成；</li><li>在整个更新过程中，最多只有一个 Pod 副本不提供服务，且同一时刻不会有过多的 Pod 副本同时运行（默认最多比预期值多一个）。</li></ul><h3 id=回滚>回滚<a href=#回滚 class=anchor aria-hidden=true>#</a></h3><p>当 Deployment 不稳定时（例如进入反复崩溃状态），我们需要对其进行回滚操作。默认情况下，Deployment 的所有上线记录都保留在系统中，以便可以随时回滚。</p><ul><li>查看历史版本：<strong>kubectl rollout history deployment &lt;deployment-name></strong></li><li>回滚至历史版本：<strong>kubectl rollout undo deployment &lt;deployment-name> &ndash;to-revision=&lt;deployment-version></strong></li></ul><h2 id=statefulset>StatefulSet<a href=#statefulset class=anchor aria-hidden=true>#</a></h2><p>StatefulSet 用于管理有状态的应用程序，被其管理的 Pod 有一个按顺序增长的 ID。它与 Deployment 最大的不同在于，StatefulSet 始终将一系列不变的名字分配给 Pod，这些 Pod 从同一个模板创建但并不能相互替换且每个 Pod 都对应一个特有的持久化存储标识。</p><h3 id=应用场景-1>应用场景<a href=#应用场景-1 class=anchor aria-hidden=true>#</a></h3><ul><li>每个 Pod 拥有稳定的、唯一的网络标识符（DNS Name）</li><li>每个 Pod 拥有稳定的、持久的存储（PersistentVolume）</li><li>有序的、优雅的部署和缩放</li><li>有序的、自动的滚动更新</li></ul><h3 id=配置-2>配置<a href=#配置-2 class=anchor aria-hidden=true>#</a></h3><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#ff79c6>apiVersion</span>: v1
<span style=color:#ff79c6>kind</span>: Service
<span style=color:#ff79c6>metadata</span>:
  <span style=color:#ff79c6>name</span>: nginx
  <span style=color:#ff79c6>labels</span>:
    <span style=color:#ff79c6>app</span>: nginx
<span style=color:#ff79c6>spec</span>:
  <span style=color:#ff79c6>ports</span>:
  - <span style=color:#ff79c6>port</span>: <span style=color:#bd93f9>80</span>
    <span style=color:#ff79c6>name</span>: web
  <span style=color:#ff79c6>clusterIP</span>: None
  <span style=color:#ff79c6>selector</span>:
    <span style=color:#ff79c6>app</span>: nginx
---
<span style=color:#ff79c6>apiVersion</span>: apps/v1
<span style=color:#ff79c6>kind</span>: StatefulSet
<span style=color:#ff79c6>metadata</span>:
  <span style=color:#ff79c6>name</span>: web
<span style=color:#ff79c6>spec</span>:
  <span style=color:#ff79c6>selector</span>:
    <span style=color:#ff79c6>matchLabels</span>:
      <span style=color:#ff79c6>app</span>: nginx <span style=color:#6272a4># has to match .spec.template.metadata.labels</span>
  <span style=color:#ff79c6>serviceName</span>: <span style=color:#f1fa8c>&#34;nginx&#34;</span>
  <span style=color:#ff79c6>replicas</span>: <span style=color:#bd93f9>3</span> <span style=color:#6272a4># by default is 1</span>
  <span style=color:#ff79c6>template</span>:
    <span style=color:#ff79c6>metadata</span>:
      <span style=color:#ff79c6>labels</span>:
        <span style=color:#ff79c6>app</span>: nginx <span style=color:#6272a4># has to match .spec.selector.matchLabels</span>
    <span style=color:#ff79c6>spec</span>:
      <span style=color:#ff79c6>terminationGracePeriodSeconds</span>: <span style=color:#bd93f9>10</span> <span style=color:#6272a4># not 0</span>
      <span style=color:#ff79c6>containers</span>:
      - <span style=color:#ff79c6>name</span>: nginx
        <span style=color:#ff79c6>image</span>: k8s.gcr.io/nginx-slim:0.8
        <span style=color:#ff79c6>ports</span>:
        - <span style=color:#ff79c6>containerPort</span>: <span style=color:#bd93f9>80</span>
          <span style=color:#ff79c6>name</span>: web
        <span style=color:#ff79c6>volumeMounts</span>:
        - <span style=color:#ff79c6>name</span>: www
          <span style=color:#ff79c6>mountPath</span>: /usr/share/nginx/html
  <span style=color:#ff79c6>volumeClaimTemplates</span>:
  - <span style=color:#ff79c6>metadata</span>:
      <span style=color:#ff79c6>name</span>: www
    <span style=color:#ff79c6>spec</span>:
      <span style=color:#ff79c6>accessModes</span>: [ <span style=color:#f1fa8c>&#34;ReadWriteOnce&#34;</span> ]
      <span style=color:#ff79c6>storageClassName</span>: <span style=color:#f1fa8c>&#34;my-storage-class&#34;</span>
      <span style=color:#ff79c6>resources</span>:
        <span style=color:#ff79c6>requests</span>:
          <span style=color:#ff79c6>storage</span>: 1Gi
</code></pre></div><ul><li>名为 nginx 的 Headless Service 用来给每个 Pod 配置 DNS Name；</li><li>名为 web 的 StatefulSet 中的字段<code>spec.replicas</code>和<code>spec.template.spec</code>字段表明将在独立的 3 个 Pod 副本中启动 nginx 容器；</li><li><code>volumeClaimTemplates</code>字段表明将通过 PersistentVolumes（PV）来为 Pod 提供持久化存储。在这种配置下，每个 StatefulSet 管理的 Pod 将分别挂载不同的 PV。而对于 Deployment 中的 Pod 来说，它们则将共享同一个 PV。</li></ul><h3 id=pod-标识>Pod 标识<a href=#pod-标识 class=anchor aria-hidden=true>#</a></h3><p>StatefulSet 管理的 Pod 具备一个唯一标识，该标识由以下几部分组成：</p><ul><li>序号：假设一个 StatefulSet 的副本数为 N，其中的每一个 Pod 都会被分配一个序号，序号的取值范围从 0 到 N-1，并且该序号在 StatefulSet 内部是唯一的。</li><li>稳定的网络标识：<ul><li>StatefulSet 中每个 Pod 根据 StatefulSet 的名称和 Pod 的序号派生出它的主机名 hostname：&lt;StatefulSet name>-&lt;Pod 序号、>；</li><li>StatefulSet 可以使用 Headless Service 来控制其 Pod 所在的域，该域（domain）的格式为：&lt;Service name>.&lt;namespace>.svc.cluster.local（&ldquo;cluster.local"是集群的域名）；</li><li>StatefulSet 中每一个 Pod 将被分配一个 DNS Name，格式为：&lt;Pod name>.&lt;所在域名、>，因此可以直接通过该 Pod 的 DNS Name 访问到 Pod。</li></ul></li><li>稳定的存储：Kubernetes 为每个 VolumeClaimTemplate 创建一个 PersistentVolume。</li></ul><h3 id=部署和扩缩容>部署和扩缩容<a href=#部署和扩缩容 class=anchor aria-hidden=true>#</a></h3><p>在默认情况下<code>.spec.podManagementPolicy</code>字段值为 OrderedReady，它代表依次进行 Pod 的部署和扩缩容：</p><ul><li>在创建一个副本数为 N 的 StatefulSet 时，其 Pod 将被按{0&mldr;N-1}的顺序逐个创建；</li><li>在删除一个副本数为 N 的 StatefulSet（或其中所有的 Pod）时，其 Pod 将按照相反的顺序（即 {N-1&mldr;0}）终止和删除；</li><li>在对 StatefulSet 执行扩容操作时，新增 Pod 所有的前序 Pod 必须处于 Running（运行）和 Ready（就绪）的状态；</li><li>终止和删除 StatefulSet 中的某一个 Pod 时，该 Pod 所有的后序 Pod 必须全部已终止。</li></ul><p>若要并行管理 Pod，需要设置<code>.spec.podManagementPolicy</code>字段值为 Parallel，此时 StatefulSet 将同时并行地创建或终止其所有的 Pod。</p><h3 id=更新-1>更新<a href=#更新-1 class=anchor aria-hidden=true>#</a></h3><p>StatefulSet 的更新策略有两种，它是通过定义<code>spec.updateStrategy.type</code>字段的方式进行选择的。</p><ul><li>On Delete：Controller 将不会自动更新 StatefulSet 中的 Pod, 用户必须手动删除 Pod 以便让 StatefulSet 创建新的 Pod，以此来对<code>spec.template</code>的变动作出反应。</li><li>Rolling Updates
StatefulSet 会删除和重建 StatefulSet 中的每个 Pod, 它将按照与 Pod 终止相同的顺序（从最大序号到最小序号）进行，每次更新一个 Pod。它会等到被更新的 Pod 进入 Running 和 Ready 状态，然后再更新其前序 Pod。</li></ul><p>若 Pod 的 template 出错，导致 Pod 始终不能进入 Running 和 Ready 的状态，StatefulSet 将停止滚动更新并一直等待（OrderedReady）。在修复 template 以后，StatefulSet 将继续等待出错的 Pod 进入就绪状态，而该状态将永远无法出现。因此还必须删除所有已经尝试使用错误 template 的 Pod，随后 StatefulSet 才会使用修复后的 template 重建 Pod。</p><h2 id=daemonset>DaemonSet<a href=#daemonset class=anchor aria-hidden=true>#</a></h2><p>DaemonSet 确保全部（或者某些）节点上运行一个 Pod 的副本，且当有节点加入集群时，也会为他们新增一个 Pod。当有节点从集群移除时，这些 Pod 同样会被回收。删除 DaemonSet 将会删除它所创建的所有 Pod。</p><h3 id=使用场景>使用场景<a href=#使用场景 class=anchor aria-hidden=true>#</a></h3><ul><li>在每个节点上运行集群守护进程 glusterd、ceph 等</li><li>在每个节点上运行日志收集守护进程 fluentd、logstash 等</li><li>在每个节点上运行监控守护进程 Prometheus 等</li></ul><h3 id=spec-配置>Spec 配置<a href=#spec-配置 class=anchor aria-hidden=true>#</a></h3><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#ff79c6>apiVersion</span>: apps/v1
<span style=color:#ff79c6>kind</span>: DaemonSet
<span style=color:#ff79c6>metadata</span>:
  <span style=color:#ff79c6>name</span>: fluentd-elasticsearch
  <span style=color:#ff79c6>namespace</span>: kube-system
  <span style=color:#ff79c6>labels</span>:
    <span style=color:#ff79c6>k8s-app</span>: fluentd-logging
<span style=color:#ff79c6>spec</span>:
  <span style=color:#ff79c6>selector</span>:
    <span style=color:#ff79c6>matchLabels</span>:
      <span style=color:#ff79c6>name</span>: fluentd-elasticsearch
  <span style=color:#ff79c6>template</span>:
    <span style=color:#ff79c6>metadata</span>:
      <span style=color:#ff79c6>labels</span>:
        <span style=color:#ff79c6>name</span>: fluentd-elasticsearch
    <span style=color:#ff79c6>spec</span>:
      <span style=color:#ff79c6>tolerations</span>:
      <span style=color:#6272a4># this toleration is to have the daemonset runnable on master nodes</span>
      <span style=color:#6272a4># remove it if your masters can&#39;t run pods</span>
      - <span style=color:#ff79c6>key</span>: node-role.kubernetes.io/master
        <span style=color:#ff79c6>effect</span>: NoSchedule
      <span style=color:#ff79c6>containers</span>:
      - <span style=color:#ff79c6>name</span>: fluentd-elasticsearch
        <span style=color:#ff79c6>image</span>: quay.io/fluentd_elasticsearch/fluentd:v2.5.2
        <span style=color:#ff79c6>resources</span>:
          <span style=color:#ff79c6>limits</span>:
            <span style=color:#ff79c6>memory</span>: 200Mi
          <span style=color:#ff79c6>requests</span>:
            <span style=color:#ff79c6>cpu</span>: 100m
            <span style=color:#ff79c6>memory</span>: 200Mi
        <span style=color:#ff79c6>volumeMounts</span>:
        - <span style=color:#ff79c6>name</span>: varlog
          <span style=color:#ff79c6>mountPath</span>: /var/log
        - <span style=color:#ff79c6>name</span>: varlibdockercontainers
          <span style=color:#ff79c6>mountPath</span>: /var/lib/docker/containers
          <span style=color:#ff79c6>readOnly</span>: <span style=color:#ff79c6>true</span>
      <span style=color:#ff79c6>terminationGracePeriodSeconds</span>: <span style=color:#bd93f9>30</span>
      <span style=color:#ff79c6>volumes</span>:
      - <span style=color:#ff79c6>name</span>: varlog
        <span style=color:#ff79c6>hostPath</span>:
          <span style=color:#ff79c6>path</span>: /var/log
      - <span style=color:#ff79c6>name</span>: varlibdockercontainers
        <span style=color:#ff79c6>hostPath</span>:
          <span style=color:#ff79c6>path</span>: /var/lib/docker/containers
</code></pre></div><ul><li><code>spec.template.spec.nodeSelector</code>字段指定运行 Pod 的节点，若不设置则默认在全部节点上运行；</li><li><code>spec.template.spec.restartPolicy</code>字段的值默认是 always，也必须是 always。</li></ul><h3 id=调度策略>调度策略<a href=#调度策略 class=anchor aria-hidden=true>#</a></h3><p>DaemonSet Controller 将会向 DaemonSet 管理的的 Pod 添加<code>spec.nodeAffinity</code>字段，并进一步由 Kubernetes Scheduler 将 Pod 绑定到目标节点。</p><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#ff79c6>nodeAffinity</span>:
  <span style=color:#ff79c6>requiredDuringSchedulingIgnoredDuringExecution</span>:
    <span style=color:#ff79c6>nodeSelectorTerms</span>:
    - <span style=color:#ff79c6>matchFields</span>:
      - <span style=color:#ff79c6>key</span>: metadata.name
        <span style=color:#ff79c6>operator</span>: In
        <span style=color:#ff79c6>values</span>:
        - target-host-name
</code></pre></div><p>此外，容忍度（toleration）<code>node.kubernetes.io/unschedulable:NoSchedule</code>将被系统自动添加到 DaemonSet 的 Pod 中。由此，默认调度器在调度 DaemonSet 的 Pod 时可以忽略节点的 unschedulable 属性。</p><h3 id=通信>通信<a href=#通信 class=anchor aria-hidden=true>#</a></h3><p>与 DaemonSet 中的 Pod 进行通信的几种可能模式如下：</p><ul><li><p>Push：配置 DaemonSet 中的 Pod，将更新发送到另一个服务，例如统计数据库；</p></li><li><p>节点 IP 和已知端口：DaemonSet 中的 Pod 可以使用节点的端口，从而可以通过节点 IP 访问到 Pod。客户端能通过某种方法获取节点 IP 列表，并且基于此也可以获取到相应的端口；</p></li><li><p>DNS：创建 Headless Service 并通过设置标签选择器选取 Pod，通过使用 Endpoints 对象或从 DNS 服务中检索到多个 A 记录来发现 DaemonSet；</p></li><li><p>Service：创建 Service 并通过设置标签选择器选取 Pod，使用该 Service 随机访问到某个节点上的 DaemonSet。由于 Service 的负载均衡机制，因此没有办法访问到特定节点。</p></li></ul><h2 id=jobs>Jobs<a href=#jobs class=anchor aria-hidden=true>#</a></h2><p>Job 会创建一个或者多个 Pods，并确保指定数量的 Pod 可以执行到 Succeeded 状态。随着 Pods 成功结束，Job 跟踪记录成功完成的 Pods 个数。当数量达到指定的成功个数阈值时，Job 结束。删除 Job 的操作会清除其创建的全部 Pod。</p><h3 id=配置-3>配置<a href=#配置-3 class=anchor aria-hidden=true>#</a></h3><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#ff79c6>apiVersion</span>: batch/v1
<span style=color:#ff79c6>kind</span>: Job
<span style=color:#ff79c6>metadata</span>:
  <span style=color:#ff79c6>name</span>: pi
<span style=color:#ff79c6>spec</span>:
  <span style=color:#ff79c6>template</span>:
    <span style=color:#ff79c6>spec</span>:
      <span style=color:#ff79c6>containers</span>:
      - <span style=color:#ff79c6>name</span>: pi
        <span style=color:#ff79c6>image</span>: perl
        <span style=color:#ff79c6>command</span>: [<span style=color:#f1fa8c>&#34;perl&#34;</span>,  <span style=color:#f1fa8c>&#34;-Mbignum=bpi&#34;</span>, <span style=color:#f1fa8c>&#34;-wle&#34;</span>, <span style=color:#f1fa8c>&#34;print bpi(2000)&#34;</span>]
      <span style=color:#ff79c6>restartPolicy</span>: Never
  <span style=color:#ff79c6>backoffLimit</span>: <span style=color:#bd93f9>4</span> <span style=color:#6272a4># Job 最大的重试次数</span>
</code></pre></div><ul><li><code>spec.template.spec.restartPolicy</code>字段定义了 Pod 的重启策略，此处只允许使用 Never 和 OnFailure 两个取值；</li><li><code>spec.completions</code>和<code>spec.parallelism</code>字段值默认为 1，代表 Job 只启动一个 Pod;</li><li><code>spec.completions</code>表示 Job 期望成功运行至结束的 Pod 数量。当该字段值大于 1 时，Job 将创建至相应数量的 Pod，编号为 1-<code>spec.completions</code>；</li><li><code>spec.parallelism</code>表示并行运行的 Pod 数量。当该字段值大于 1 时，Job 会依次创建相应数量的 Pod 并行运行，直到<code>spec.completions</code>个 Pod 成功运行至结束；</li><li><code>spec.activeDeadlineSeconds</code>字段指定 Job 的存活时长，该字段的优先级高于<code>spec.backoffLimit</code>；</li><li>Job 终止后 Pod 不会被删除，可以通过定义<code>spec.ttlSecondsAfterFinished</code> 字段实现自动清理 Job 以及 Job 管理的 Pod。若字段值为 100，则代表 100 秒后清理。若字段值为 0，则代表 Job 完成后立即清理。</li></ul><h2 id=garbage-collectiongc>Garbage Collection(GC)<a href=#garbage-collectiongc class=anchor aria-hidden=true>#</a></h2><p>在 Kubernetes 中，每一个从属对象都有一个<code>metadata.ownerReferences</code>字段，标识其拥有者是哪一个对象。GC Controller 会删除那些曾经有 owner，后来又不再有 owner 的对象。</p><p class=edit-page><a href=https://github.com/koktlzz/koktlzz.github.io/blob/master/content/Kubernetes/Kubernetes%e5%9f%ba%e7%a1%80/Workloads.md><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-edit-2"><path d="M17 3a2.828 2.828.0 114 4L7.5 20.5 2 22l1.5-5.5L17 3z"/></svg>Edit this page on GitHub</a></p><div class="docs-navigation d-flex justify-content-between"><a href=https://koktlzz.github.io/kubernetes/kubernetes%E8%BF%9B%E9%98%B6/networkpolicy/><div class="card my-1"><div class="card-body py-2">&larr; Network Policy</div></div></a><a class=ms-auto href=https://koktlzz.github.io/kubernetes/kubernetes%E8%BF%9B%E9%98%B6/ingress/><div class="card my-1"><div class="card-body py-2">Ingress &rarr;</div></div></a></div><script src=https://utteranc.es/client.js repo=koktlzz/koktlzz.github.io issue-term=pathname theme=photon-dark crossorigin=anonymous async></script></main><nav class="docs-toc d-none d-xl-block col-lg-3 col-xl-2" aria-label="Secondary navigation"><div class=page-links><h3>On this page</h3><nav id=TableOfContents><ul><li><a href=#简介>简介</a></li><li><a href=#replicaset>ReplicaSet</a><ul><li><a href=#配置>配置</a></li><li><a href=#应用场景>应用场景</a></li></ul></li><li><a href=#deployment>Deployment</a><ul><li><a href=#配置-1>配置</a></li><li><a href=#创建>创建</a></li><li><a href=#更新>更新</a></li><li><a href=#回滚>回滚</a></li></ul></li><li><a href=#statefulset>StatefulSet</a><ul><li><a href=#应用场景-1>应用场景</a></li><li><a href=#配置-2>配置</a></li><li><a href=#pod-标识>Pod 标识</a></li><li><a href=#部署和扩缩容>部署和扩缩容</a></li><li><a href=#更新-1>更新</a></li></ul></li><li><a href=#daemonset>DaemonSet</a><ul><li><a href=#使用场景>使用场景</a></li><li><a href=#spec-配置>Spec 配置</a></li><li><a href=#调度策略>调度策略</a></li><li><a href=#通信>通信</a></li></ul></li><li><a href=#jobs>Jobs</a><ul><li><a href=#配置-3>配置</a></li></ul></li><li><a href=#garbage-collectiongc>Garbage Collection(GC)</a></li></ul></nav></div></nav></div></div></div><footer class="footer text-muted"><div class=container><div class=row><div class="col-lg-8 order-last order-lg-first"><ul class=list-inline><li class=list-inline-item></li></ul></div><div class="col-lg-8 order-first order-lg-last text-lg-end"><ul class=list-inline></ul></div></div></div></footer><script src=https://koktlzz.github.io/js/bootstrap.min.d67050adf5d370668aede4201f82af781b16970934804995a1ca37c1ee9222c2fc530972aa6d5d2b6124caf1fe318f139aac99df2c1e89af65504fc1185c7972.js integrity="sha512-1nBQrfXTcGaK7eQgH4KveBsWlwk0gEmVoco3we6SIsL8Uwlyqm1dK2EkyvH+MY8TmqyZ3yweia9lUE/BGFx5cg==" crossorigin=anonymous defer></script><script src=https://koktlzz.github.io/js/vendor/katex/dist/katex.min.b334e5b00c45f572e7f38a543046f36854bf4cbb543880480c09271a0efedc694d6905f719934f6ede2f26f52e80411c05b90121d722cbf8be2fa8fc51bc6b81.js integrity="sha512-szTlsAxF9XLn84pUMEbzaFS/TLtUOIBIDAknGg7+3GlNaQX3GZNPbt4vJvUugEEcBbkBIdciy/i+L6j8UbxrgQ==" crossorigin=anonymous defer></script><script src=https://koktlzz.github.io/js/vendor/katex/dist/contrib/auto-render.min.916823ec103cf367b71e28a6f01513cb9c3ac6708ccb5229402ec46b8e30a8b25003db694df35d80e9dd666a371f327c6152790617b6256390c164109a90bd4c.js integrity="sha512-kWgj7BA882e3Hiim8BUTy5w6xnCMy1IpQC7Ea44wqLJQA9tpTfNdgOndZmo3HzJ8YVJ5Bhe2JWOQwWQQmpC9TA==" crossorigin=anonymous defer></script><script src=https://koktlzz.github.io/main.min.f6e8faaea2ce6bb257f34da94268a7e539d1da8094519ef5a226be2646792c13b4b992b9c31c3f9ce3d3e4a39acbd7e88d9a46666014e9371baa755131320bca.js integrity="sha512-9uj6rqLOa7JX802pQmin5TnR2oCUUZ71oia+JkZ5LBO0uZK5wxw/nOPT5KOay9fojZpGZmAU6TcbqnVRMTILyg==" crossorigin=anonymous defer></script><script src=https://koktlzz.github.io/index.min.bc9d0cdd7fc7b444e89eeabd4981596119f6edd9f1d94c19eb112cbe44a272a177dffa9c9820a54e7eca47e67e3d3377a9a030c0569085f92565b915fcd317a0.js integrity="sha512-vJ0M3X/HtETonuq9SYFZYRn27dnx2UwZ6xEsvkSicqF33/qcmCClTn7KR+Z+PTN3qaAwwFaQhfklZbkV/NMXoA==" crossorigin=anonymous defer></script></body></html>